import{t as fe,c as Q,s as j,i as me,e as ee,b as R,a as ve}from"./YV4JVR4I-I4X5ERHE.js";import{C as h,B as q,R as Ie,D as M,q as Se,s as ge,F as pe,z as xe,c as Ee,_ as se,h as ye,S as be,T as te,U as z,V as we,m as H,v as W,l as Pe,t as ie,y as Ce,g as he,u as Fe,b as ne,d as _e,e as Ae,W as ke}from"./~utils-ChHMGsjo.js";import{C as Re,a as ae,e as Be,g as D,s as Ke,i as J,h as Le,j as Te}from"./P2CTZE2T-DAWgHJTO.js";import{P as De,a as Me}from"./MTZPJQMC-JL08V7FT.js";import{a as K,n as Oe}from"./chunk-K6AXKMTT-BHCV6zel.js";import{f as ze,a as We,u as Ue}from"./LVA2YJMS-BjFMiyma.js";function Ve(e){var s;const n=e.find(c=>!!c.element),t=[...e].reverse().find(c=>!!c.element);let i=(s=n==null?void 0:n.element)==null?void 0:s.parentElement;for(;i&&(t!=null&&t.element);){if(t&&i.contains(t.element))return i;i=i.parentElement}return Se(i).body}function He(e){return e==null?void 0:e.__unstablePrivateStore}function $e(e={}){var s;fe(e,e.store);const n=(s=e.store)==null?void 0:s.getState(),t=h(e.items,n==null?void 0:n.items,e.defaultItems,[]),i=new Map(t.map(a=>[a.id,a])),c={items:t,renderedItems:h(n==null?void 0:n.renderedItems,[])},l=He(e.store),u=Q({items:t,renderedItems:c.renderedItems},l),r=Q(c,e.store),P=a=>{const f=ge(a,m=>m.element);u.setState("renderedItems",f),r.setState("renderedItems",f)};j(r,()=>me(u)),j(u,()=>ee(u,["items"],a=>{r.setState("items",a.items)})),j(u,()=>ee(u,["renderedItems"],a=>{let f=!0,m=requestAnimationFrame(()=>{const{renderedItems:g}=r.getState();a.renderedItems!==g&&P(a.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(m);const y=()=>{if(f){f=!1;return}cancelAnimationFrame(m),m=requestAnimationFrame(()=>P(a.renderedItems))},L=Ve(a.renderedItems),S=new IntersectionObserver(y,{root:L});for(const g of a.renderedItems)g.element&&S.observe(g.element);return()=>{cancelAnimationFrame(m),S.disconnect()}}));const I=(a,f,m=!1)=>{let y;return f(S=>{const g=S.findIndex(({id:b})=>b===a.id),F=S.slice();if(g!==-1){y=S[g];const b=M(M({},y),a);F[g]=b,i.set(a.id,b)}else F.push(a),i.set(a.id,a);return F}),()=>{f(S=>{if(!y)return m&&i.delete(a.id),S.filter(({id:b})=>b!==a.id);const g=S.findIndex(({id:b})=>b===a.id);if(g===-1)return S;const F=S.slice();return F[g]=y,i.set(a.id,y),F})}},T=a=>I(a,f=>u.setState("items",f),!0);return q(M({},r),{registerItem:T,renderItem:a=>Ie(T(a),I(a,f=>u.setState("renderedItems",f))),item:a=>{if(!a)return null;let f=i.get(a);if(!f){const{items:m}=u.getState();f=m.find(y=>y.id===a),f&&i.set(a,f)}return f||null},__unstablePrivateStore:u})}function Ne(e,s,n){return pe(s,[n.store]),R(e,n,"items","setItems"),e}function ue(e){const s=[];for(const n of e)s.push(...n);return s}function X(e){return e.slice().reverse()}var je={id:null};function B(e,s){return e.find(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function qe(e,s){return e.filter(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function re(e,s){return e.filter(n=>n.rowId===s)}function Ge(e,s,n=!1){const t=e.findIndex(i=>i.id===s);return[...e.slice(t+1),...n?[je]:[],...e.slice(0,t)]}function ce(e){const s=[];for(const n of e){const t=s.find(i=>{var c;return((c=i[0])==null?void 0:c.rowId)===n.rowId});t?t.push(n):s.push([n])}return s}function le(e){let s=0;for(const{length:n}of e)n>s&&(s=n);return s}function Ye(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function Je(e,s,n){const t=le(e);for(const i of e)for(let c=0;c<t;c+=1){const l=i[c];if(!l||n&&l.disabled){const r=c===0&&n?B(i):i[c-1];i[c]=r&&s!==r.id&&n?r:Ye(r==null?void 0:r.rowId)}}return e}function Qe(e){const s=ce(e),n=le(s),t=[];for(let i=0;i<n;i+=1)for(const c of s){const l=c[i];l&&t.push(q(M({},l),{rowId:l.rowId?`${i}`:void 0}))}return t}function vt(e={}){var s;const n=(s=e.store)==null?void 0:s.getState(),t=$e(e),i=h(e.activeId,n==null?void 0:n.activeId,e.defaultActiveId),c=q(M({},t.getState()),{id:h(e.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:i,baseElement:h(n==null?void 0:n.baseElement,null),includesBaseElement:h(e.includesBaseElement,n==null?void 0:n.includesBaseElement,i===null),moves:h(n==null?void 0:n.moves,0),orientation:h(e.orientation,n==null?void 0:n.orientation,"both"),rtl:h(e.rtl,n==null?void 0:n.rtl,!1),virtualFocus:h(e.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:h(e.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:h(e.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:h(e.focusShift,n==null?void 0:n.focusShift,!1)}),l=Q(c,t,e.store);j(l,()=>ve(l,["renderedItems","activeId"],r=>{l.setState("activeId",P=>{var I;return P!==void 0?P:(I=B(r.renderedItems))==null?void 0:I.id})}));const u=(r="next",P={})=>{var I,T;const a=l.getState(),{skip:f=0,activeId:m=a.activeId,focusShift:y=a.focusShift,focusLoop:L=a.focusLoop,focusWrap:S=a.focusWrap,includesBaseElement:g=a.includesBaseElement,renderedItems:F=a.renderedItems,rtl:b=a.rtl}=P,_=r==="up"||r==="down",U=r==="next"||r==="down",G=U?b&&!_:!b||_,$=y&&!f;let p=_?ue(Je(ce(F),m,$)):F;if(p=G?X(p):p,p=_?Qe(p):p,m==null)return(I=B(p))==null?void 0:I.id;const O=p.find(v=>v.id===m);if(!O)return(T=B(p))==null?void 0:T.id;const N=p.some(v=>v.rowId),Y=p.indexOf(O),o=p.slice(Y+1),d=re(o,O.rowId);if(f){const v=qe(d,m),w=v.slice(f)[0]||v[v.length-1];return w==null?void 0:w.id}const x=L&&(_?L!=="horizontal":L!=="vertical"),E=N&&S&&(_?S!=="horizontal":S!=="vertical"),C=U?(!N||_)&&x&&g:_?g:!1;if(x){const v=E&&!C?p:re(p,O.rowId),w=Ge(v,m,C),k=B(w,m);return k==null?void 0:k.id}if(E){const v=B(C?d:o,m);return C?(v==null?void 0:v.id)||null:v==null?void 0:v.id}const A=B(d,m);return!A&&C?null:A==null?void 0:A.id};return q(M(M({},t),l),{setBaseElement:r=>l.setState("baseElement",r),setActiveId:r=>l.setState("activeId",r),move:r=>{r!==void 0&&(l.setState("activeId",r),l.setState("moves",P=>P+1))},first:()=>{var r;return(r=B(l.getState().renderedItems))==null?void 0:r.id},last:()=>{var r;return(r=B(X(l.getState().renderedItems)))==null?void 0:r.id},next:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("next",r)),previous:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("previous",r)),down:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("down",r)),up:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("up",r))})}function It(e,s,n){return e=Ne(e,s,n),R(e,n,"activeId","setActiveId"),R(e,n,"includesBaseElement"),R(e,n,"virtualFocus"),R(e,n,"orientation"),R(e,n,"rtl"),R(e,n,"focusLoop"),R(e,n,"focusWrap"),R(e,n,"focusShift"),e}K.createContext(void 0);var de=xe([Me,ae],[De,Re]),St=de.useContext,gt=de.useProviderContext;K.createContext(void 0);K.createContext(!1);var Xe="div";function Ze(e){return e.some(s=>!!s.rowId)}function et(e){const s=e.target;return s&&!ie(s)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function tt(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function oe(e,s,n){return H(t=>{var i;if(s==null||s(t),t.defaultPrevented||t.isPropagationStopped()||!W(t)||tt(t)||et(t))return;const c=e.getState(),l=(i=D(e,c.activeId))==null?void 0:i.element;if(!l)return;const u=t,r=se(u,["view"]),P=n==null?void 0:n.current;l!==P&&l.focus(),ke(l,t.type,r)||t.preventDefault(),t.currentTarget.contains(l)&&t.stopPropagation()})}function nt(e){return Le(ue(X(Te(e))))}function rt(e){const[s,n]=K.useState(!1),t=K.useCallback(()=>n(!0),[]),i=e.useState(c=>D(e,c.activeId));return K.useEffect(()=>{const c=i==null?void 0:i.element;s&&c&&(n(!1),c.focus({preventScroll:!0}))},[i,s]),t}var ot=Ee(function(s){var n=s,{store:t,composite:i=!0,focusOnMove:c=i,moveOnKeyPress:l=!0}=n,u=se(n,["store","composite","focusOnMove","moveOnKeyPress"]);const r=Be();t=t||r,ye(t,!1);const P=K.useRef(null),I=K.useRef(null),T=rt(t),a=t.useState("moves"),[,f]=be(i?t.setBaseElement:null);K.useEffect(()=>{var o;if(!t||!a||!i||!c)return;const{activeId:d}=t.getState(),x=(o=D(t,d))==null?void 0:o.element;x&&ze(x)},[t,a,i,c]),te(()=>{if(!t||!a||!i)return;const{baseElement:o,activeId:d}=t.getState();if(!(d===null)||!o)return;const E=I.current;I.current=null,E&&z(E,{relatedTarget:o}),We(o)||o.focus()},[t,a,i]);const m=t.useState("activeId"),y=t.useState("virtualFocus");te(()=>{var o;if(!t||!i||!y)return;const d=I.current;if(I.current=null,!d)return;const E=((o=D(t,m))==null?void 0:o.element)||we(d);E!==d&&z(d,{relatedTarget:E})},[t,m,y,i]);const L=oe(t,u.onKeyDownCapture,I),S=oe(t,u.onKeyUpCapture,I),g=u.onFocusCapture,F=H(o=>{if(g==null||g(o),o.defaultPrevented||!t)return;const{virtualFocus:d}=t.getState();if(!d)return;const x=o.relatedTarget,E=Ke(o.currentTarget);W(o)&&E&&(o.stopPropagation(),I.current=x)}),b=u.onFocus,_=H(o=>{if(b==null||b(o),o.defaultPrevented||!i||!t)return;const{relatedTarget:d}=o,{virtualFocus:x}=t.getState();x?W(o)&&!J(t,d)&&queueMicrotask(T):W(o)&&t.setActiveId(null)}),U=u.onBlurCapture,G=H(o=>{var d;if(U==null||U(o),o.defaultPrevented||!t)return;const{virtualFocus:x,activeId:E}=t.getState();if(!x)return;const C=(d=D(t,E))==null?void 0:d.element,A=o.relatedTarget,v=J(t,A),w=I.current;I.current=null,W(o)&&v?(A===C?w&&w!==A&&z(w,o):C?z(C,o):w&&z(w,o),o.stopPropagation()):!J(t,o.target)&&C&&z(C,o)}),$=u.onKeyDown,p=Pe(l),O=H(o=>{var d;if($==null||$(o),o.defaultPrevented||!t||!W(o))return;const{orientation:x,renderedItems:E,activeId:C}=t.getState(),A=D(t,C);if((d=A==null?void 0:A.element)!=null&&d.isConnected)return;const v=x!=="horizontal",w=x!=="vertical",k=Ze(E);if((o.key==="ArrowLeft"||o.key==="ArrowRight"||o.key==="Home"||o.key==="End")&&ie(o.currentTarget))return;const Z={ArrowUp:(k||v)&&(()=>{if(k){const V=nt(E);return V==null?void 0:V.id}return t==null?void 0:t.last()}),ArrowRight:(k||w)&&t.first,ArrowDown:(k||v)&&t.first,ArrowLeft:(k||w)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[o.key];if(Z){const V=Z();if(V!==void 0){if(!p(o))return;o.preventDefault(),t.move(V)}}});u=Ce(u,o=>Oe.jsx(ae,{value:t,children:o}),[t]);const N=t.useState(o=>{var d;if(t&&i&&o.virtualFocus)return(d=D(t,o.activeId))==null?void 0:d.id});u=he(ne({"aria-activedescendant":N},u),{ref:Fe(P,f,u.ref),onKeyDownCapture:L,onKeyUpCapture:S,onFocusCapture:F,onFocus:_,onBlurCapture:G,onKeyDown:O});const Y=t.useState(o=>i&&(o.virtualFocus||o.activeId===null));return u=Ue(ne({focusable:Y},u)),u});_e(function(s){const n=ot(s);return Ae(Xe,n)});export{It as a,ot as b,vt as c,$e as d,St as e,gt as u};

import{t as le,c as Q,s as j,i as de,e as te,b as R,a as fe,u as me}from"./YV4JVR4I-I4X5ERHE.js";import{C as _,B as q,R as ve,D,q as Ie,s as Se,F as ge,G as Ee,b as X,d as pe,c as ye,_ as oe,h as we,S as be,T as ne,U as O,V as he,m as H,l as xe,y as Fe,g as _e,u as Pe,e as Ce,v as z,W as Ae,t as ie}from"./~utils-ChHMGsjo.js";import{e as ke,g as T,s as Re,i as J,a as Be,h as Ke,j as Le}from"./P2CTZE2T-6JquUpf1.js";import{f as Te,a as De,u as Me}from"./LVA2YJMS-DZZaADyj.js";import{a as W,n as Oe}from"./chunk-K6AXKMTT-BHCV6zel.js";function ze(e){var s;const n=e.find(c=>!!c.element),t=[...e].reverse().find(c=>!!c.element);let i=(s=n==null?void 0:n.element)==null?void 0:s.parentElement;for(;i&&(t!=null&&t.element);){if(t&&i.contains(t.element))return i;i=i.parentElement}return Ie(i).body}function We(e){return e==null?void 0:e.__unstablePrivateStore}function Ue(e={}){var s;le(e,e.store);const n=(s=e.store)==null?void 0:s.getState(),t=_(e.items,n==null?void 0:n.items,e.defaultItems,[]),i=new Map(t.map(u=>[u.id,u])),c={items:t,renderedItems:_(n==null?void 0:n.renderedItems,[])},l=We(e.store),a=Q({items:t,renderedItems:c.renderedItems},l),r=Q(c,e.store),x=u=>{const f=Se(u,m=>m.element);a.setState("renderedItems",f),r.setState("renderedItems",f)};j(r,()=>de(a)),j(a,()=>te(a,["items"],u=>{r.setState("items",u.items)})),j(a,()=>te(a,["renderedItems"],u=>{let f=!0,m=requestAnimationFrame(()=>{const{renderedItems:g}=r.getState();u.renderedItems!==g&&x(u.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(m);const w=()=>{if(f){f=!1;return}cancelAnimationFrame(m),m=requestAnimationFrame(()=>x(u.renderedItems))},K=ze(u.renderedItems),S=new IntersectionObserver(w,{root:K});for(const g of u.renderedItems)g.element&&S.observe(g.element);return()=>{cancelAnimationFrame(m),S.disconnect()}}));const I=(u,f,m=!1)=>{let w;return f(S=>{const g=S.findIndex(({id:b})=>b===u.id),P=S.slice();if(g!==-1){w=S[g];const b=D(D({},w),u);P[g]=b,i.set(u.id,b)}else P.push(u),i.set(u.id,u);return P}),()=>{f(S=>{if(!w)return m&&i.delete(u.id),S.filter(({id:b})=>b!==u.id);const g=S.findIndex(({id:b})=>b===u.id);if(g===-1)return S;const P=S.slice();return P[g]=w,i.set(u.id,w),P})}},L=u=>I(u,f=>a.setState("items",f),!0);return q(D({},r),{registerItem:L,renderItem:u=>ve(L(u),I(u,f=>a.setState("renderedItems",f))),item:u=>{if(!u)return null;let f=i.get(u);if(!f){const{items:m}=a.getState();f=m.find(w=>w.id===u),f&&i.set(u,f)}return f||null},__unstablePrivateStore:a})}function Ve(e,s,n){return ge(s,[n.store]),R(e,n,"items","setItems"),e}function ue(e){const s=[];for(const n of e)s.push(...n);return s}function Z(e){return e.slice().reverse()}var He={id:null};function B(e,s){return e.find(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function $e(e,s){return e.filter(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function re(e,s){return e.filter(n=>n.rowId===s)}function Ne(e,s,n=!1){const t=e.findIndex(i=>i.id===s);return[...e.slice(t+1),...n?[He]:[],...e.slice(0,t)]}function ae(e){const s=[];for(const n of e){const t=s.find(i=>{var c;return((c=i[0])==null?void 0:c.rowId)===n.rowId});t?t.push(n):s.push([n])}return s}function ce(e){let s=0;for(const{length:n}of e)n>s&&(s=n);return s}function je(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function qe(e,s,n){const t=ce(e);for(const i of e)for(let c=0;c<t;c+=1){const l=i[c];if(!l||n&&l.disabled){const r=c===0&&n?B(i):i[c-1];i[c]=r&&s!==r.id&&n?r:je(r==null?void 0:r.rowId)}}return e}function Ge(e){const s=ae(e),n=ce(s),t=[];for(let i=0;i<n;i+=1)for(const c of s){const l=c[i];l&&t.push(q(D({},l),{rowId:l.rowId?`${i}`:void 0}))}return t}function Ye(e={}){var s;const n=(s=e.store)==null?void 0:s.getState(),t=Ue(e),i=_(e.activeId,n==null?void 0:n.activeId,e.defaultActiveId),c=q(D({},t.getState()),{id:_(e.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:i,baseElement:_(n==null?void 0:n.baseElement,null),includesBaseElement:_(e.includesBaseElement,n==null?void 0:n.includesBaseElement,i===null),moves:_(n==null?void 0:n.moves,0),orientation:_(e.orientation,n==null?void 0:n.orientation,"both"),rtl:_(e.rtl,n==null?void 0:n.rtl,!1),virtualFocus:_(e.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:_(e.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:_(e.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:_(e.focusShift,n==null?void 0:n.focusShift,!1)}),l=Q(c,t,e.store);j(l,()=>fe(l,["renderedItems","activeId"],r=>{l.setState("activeId",x=>{var I;return x!==void 0?x:(I=B(r.renderedItems))==null?void 0:I.id})}));const a=(r="next",x={})=>{var I,L;const u=l.getState(),{skip:f=0,activeId:m=u.activeId,focusShift:w=u.focusShift,focusLoop:K=u.focusLoop,focusWrap:S=u.focusWrap,includesBaseElement:g=u.includesBaseElement,renderedItems:P=u.renderedItems,rtl:b=u.rtl}=x,C=r==="up"||r==="down",U=r==="next"||r==="down",G=U?b&&!C:!b||C,$=w&&!f;let E=C?ue(qe(ae(P),m,$)):P;if(E=G?Z(E):E,E=C?Ge(E):E,m==null)return(I=B(E))==null?void 0:I.id;const M=E.find(v=>v.id===m);if(!M)return(L=B(E))==null?void 0:L.id;const N=E.some(v=>v.rowId),Y=E.indexOf(M),o=E.slice(Y+1),d=re(o,M.rowId);if(f){const v=$e(d,m),h=v.slice(f)[0]||v[v.length-1];return h==null?void 0:h.id}const p=K&&(C?K!=="horizontal":K!=="vertical"),y=N&&S&&(C?S!=="horizontal":S!=="vertical"),F=U?(!N||C)&&p&&g:C?g:!1;if(p){const v=y&&!F?E:re(E,M.rowId),h=Ne(v,m,F),k=B(h,m);return k==null?void 0:k.id}if(y){const v=B(F?d:o,m);return F?(v==null?void 0:v.id)||null:v==null?void 0:v.id}const A=B(d,m);return!A&&F?null:A==null?void 0:A.id};return q(D(D({},t),l),{setBaseElement:r=>l.setState("baseElement",r),setActiveId:r=>l.setState("activeId",r),move:r=>{r!==void 0&&(l.setState("activeId",r),l.setState("moves",x=>x+1))},first:()=>{var r;return(r=B(l.getState().renderedItems))==null?void 0:r.id},last:()=>{var r;return(r=B(Z(l.getState().renderedItems)))==null?void 0:r.id},next:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("next",r)),previous:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("previous",r)),down:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("down",r)),up:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("up",r))})}function Je(e){const s=Ee(e.id);return X({id:s},e)}function Qe(e,s,n){return e=Ve(e,s,n),R(e,n,"activeId","setActiveId"),R(e,n,"includesBaseElement"),R(e,n,"virtualFocus"),R(e,n,"orientation"),R(e,n,"rtl"),R(e,n,"focusLoop"),R(e,n,"focusWrap"),R(e,n,"focusShift"),e}function mt(e={}){e=Je(e);const[s,n]=me(Ye,e);return Qe(s,n,e)}var Xe="div";function Ze(e){return e.some(s=>!!s.rowId)}function et(e){const s=e.target;return s&&!ie(s)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function tt(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function se(e,s,n){return H(t=>{var i;if(s==null||s(t),t.defaultPrevented||t.isPropagationStopped()||!z(t)||tt(t)||et(t))return;const c=e.getState(),l=(i=T(e,c.activeId))==null?void 0:i.element;if(!l)return;const a=t,r=oe(a,["view"]),x=n==null?void 0:n.current;l!==x&&l.focus(),Ae(l,t.type,r)||t.preventDefault(),t.currentTarget.contains(l)&&t.stopPropagation()})}function nt(e){return Ke(ue(Z(Le(e))))}function rt(e){const[s,n]=W.useState(!1),t=W.useCallback(()=>n(!0),[]),i=e.useState(c=>T(e,c.activeId));return W.useEffect(()=>{const c=i==null?void 0:i.element;s&&c&&(n(!1),c.focus({preventScroll:!0}))},[i,s]),t}var st=ye(function(s){var n=s,{store:t,composite:i=!0,focusOnMove:c=i,moveOnKeyPress:l=!0}=n,a=oe(n,["store","composite","focusOnMove","moveOnKeyPress"]);const r=ke();t=t||r,we(t,!1);const x=W.useRef(null),I=W.useRef(null),L=rt(t),u=t.useState("moves"),[,f]=be(i?t.setBaseElement:null);W.useEffect(()=>{var o;if(!t||!u||!i||!c)return;const{activeId:d}=t.getState(),p=(o=T(t,d))==null?void 0:o.element;p&&Te(p)},[t,u,i,c]),ne(()=>{if(!t||!u||!i)return;const{baseElement:o,activeId:d}=t.getState();if(!(d===null)||!o)return;const y=I.current;I.current=null,y&&O(y,{relatedTarget:o}),De(o)||o.focus()},[t,u,i]);const m=t.useState("activeId"),w=t.useState("virtualFocus");ne(()=>{var o;if(!t||!i||!w)return;const d=I.current;if(I.current=null,!d)return;const y=((o=T(t,m))==null?void 0:o.element)||he(d);y!==d&&O(d,{relatedTarget:y})},[t,m,w,i]);const K=se(t,a.onKeyDownCapture,I),S=se(t,a.onKeyUpCapture,I),g=a.onFocusCapture,P=H(o=>{if(g==null||g(o),o.defaultPrevented||!t)return;const{virtualFocus:d}=t.getState();if(!d)return;const p=o.relatedTarget,y=Re(o.currentTarget);z(o)&&y&&(o.stopPropagation(),I.current=p)}),b=a.onFocus,C=H(o=>{if(b==null||b(o),o.defaultPrevented||!i||!t)return;const{relatedTarget:d}=o,{virtualFocus:p}=t.getState();p?z(o)&&!J(t,d)&&queueMicrotask(L):z(o)&&t.setActiveId(null)}),U=a.onBlurCapture,G=H(o=>{var d;if(U==null||U(o),o.defaultPrevented||!t)return;const{virtualFocus:p,activeId:y}=t.getState();if(!p)return;const F=(d=T(t,y))==null?void 0:d.element,A=o.relatedTarget,v=J(t,A),h=I.current;I.current=null,z(o)&&v?(A===F?h&&h!==A&&O(h,o):F?O(F,o):h&&O(h,o),o.stopPropagation()):!J(t,o.target)&&F&&O(F,o)}),$=a.onKeyDown,E=xe(l),M=H(o=>{var d;if($==null||$(o),o.defaultPrevented||!t||!z(o))return;const{orientation:p,renderedItems:y,activeId:F}=t.getState(),A=T(t,F);if((d=A==null?void 0:A.element)!=null&&d.isConnected)return;const v=p!=="horizontal",h=p!=="vertical",k=Ze(y);if((o.key==="ArrowLeft"||o.key==="ArrowRight"||o.key==="Home"||o.key==="End")&&ie(o.currentTarget))return;const ee={ArrowUp:(k||v)&&(()=>{if(k){const V=nt(y);return V==null?void 0:V.id}return t==null?void 0:t.last()}),ArrowRight:(k||h)&&t.first,ArrowDown:(k||v)&&t.first,ArrowLeft:(k||h)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[o.key];if(ee){const V=ee();if(V!==void 0){if(!E(o))return;o.preventDefault(),t.move(V)}}});a=Fe(a,o=>Oe.jsx(Be,{value:t,children:o}),[t]);const N=t.useState(o=>{var d;if(t&&i&&o.virtualFocus)return(d=T(t,o.activeId))==null?void 0:d.id});a=_e(X({"aria-activedescendant":N},a),{ref:Pe(x,f,a.ref),onKeyDownCapture:K,onKeyUpCapture:S,onFocusCapture:P,onFocus:C,onBlurCapture:G,onKeyDown:M});const Y=t.useState(o=>i&&(o.virtualFocus||o.activeId===null));return a=Me(X({focusable:Y},a)),a}),vt=pe(function(s){const n=st(s);return Ce(Xe,n)});export{vt as C,st as a,Ue as b,Ye as c,mt as d,Qe as u};

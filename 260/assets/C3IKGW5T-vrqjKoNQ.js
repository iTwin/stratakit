import{t as A,c as p,s as v,i as F,e as C,u as O,a as w}from"./YV4JVR4I-B6wCGKZo.js";import{q as h,s as E,t as g,T as q,x as M,y as D,v as V}from"./~utils-CxpNXQT1.js";function k(t){var u;const s=t.find(f=>!!f.element),l=[...t].reverse().find(f=>!!f.element);let r=(u=s==null?void 0:s.element)==null?void 0:u.parentElement;for(;r&&(l!=null&&l.element);){if(l&&r.contains(l.element))return r;r=r.parentElement}return M(r).body}function B(t){return t==null?void 0:t.__unstablePrivateStore}function R(t={}){var u;A(t,t.store);const s=(u=t.store)==null?void 0:u.getState(),l=h(t.items,s==null?void 0:s.items,t.defaultItems,[]),r=new Map(l.map(e=>[e.id,e])),f={items:l,renderedItems:h(s==null?void 0:s.renderedItems,[])},y=B(t.store),a=p({items:l,renderedItems:f.renderedItems},y),S=p(f,t.store),P=e=>{const n=D(e,d=>d.element);a.setState("renderedItems",n),S.setState("renderedItems",n)};v(S,()=>F(a)),v(a,()=>C(a,["items"],e=>{S.setState("items",e.items)})),v(a,()=>C(a,["renderedItems"],e=>{let n=!0,d=requestAnimationFrame(()=>{const{renderedItems:i}=S.getState();e.renderedItems!==i&&P(e.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(d);const c=()=>{if(n){n=!1;return}cancelAnimationFrame(d),d=requestAnimationFrame(()=>P(e.renderedItems))},x=k(e.renderedItems),o=new IntersectionObserver(c,{root:x});for(const i of e.renderedItems)i.element&&o.observe(i.element);return()=>{cancelAnimationFrame(d),o.disconnect()}}));const _=(e,n,d=!1)=>{let c;return n(o=>{const i=o.findIndex(({id:m})=>m===e.id),I=o.slice();if(i!==-1){c=o[i];const m=g(g({},c),e);I[i]=m,r.set(e.id,m)}else I.push(e),r.set(e.id,e);return I}),()=>{n(o=>{if(!c)return d&&r.delete(e.id),o.filter(({id:m})=>m!==e.id);const i=o.findIndex(({id:m})=>m===e.id);if(i===-1)return o;const I=o.slice();return I[i]=c,r.set(e.id,c),I})}},b=e=>_(e,n=>a.setState("items",n),!0);return E(g({},S),{registerItem:b,renderItem:e=>q(b(e),_(e,n=>a.setState("renderedItems",n))),item:e=>{if(!e)return null;let n=r.get(e);if(!n){const{items:d}=a.getState();n=d.find(c=>c.id===e),n&&r.set(e,n)}return n||null},__unstablePrivateStore:a})}function T(t,u,s){return V(u,[s.store]),w(t,s,"items","setItems"),t}function z(t={}){const[u,s]=O(R,t);return T(u,s,t)}export{T as a,R as c,z as u};

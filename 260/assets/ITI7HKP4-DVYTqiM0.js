import{c as oe,a as ae}from"./C3IKGW5T-DUgJBMee.js";import{c as le,s as ce,b as de,a as _}from"./YV4JVR4I-B6wCGKZo.js";import{q as y,s as Y,t as N,c as fe,_ as ne,h as me,U as Ie,V as Q,W as k,X as ve,m as W,A,l as pe,z as re,C as ge,g as Ee,u as Se,b as Z,d as ye,e as we,Y as he}from"./~utils-CxpNXQT1.js";import{d as xe,g as P,s as be,i as G,a as Fe,e as _e,h as Pe}from"./P2CTZE2T-Cy7x662A.js";import{f as Ce,a as ke,u as Ae}from"./LVA2YJMS-DdOFa397.js";import{a as K,n as Ke}from"./chunk-K6AXKMTT-B_QCnNdX.js";function ue(t){const s=[];for(const n of t)s.push(...n);return s}function X(t){return t.slice().reverse()}var Le={id:null};function F(t,s){return t.find(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function Re(t,s){return t.filter(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function ee(t,s){return t.filter(n=>n.rowId===s)}function Be(t,s,n=!1){const e=t.findIndex(i=>i.id===s);return[...t.slice(e+1),...n?[Le]:[],...t.slice(0,e)]}function se(t){const s=[];for(const n of t){const e=s.find(i=>{var l;return((l=i[0])==null?void 0:l.rowId)===n.rowId});e?e.push(n):s.push([n])}return s}function ie(t){let s=0;for(const{length:n}of t)n>s&&(s=n);return s}function Te(t){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:t}}function De(t,s,n){const e=ie(t);for(const i of t)for(let l=0;l<e;l+=1){const o=i[l];if(!o||n&&o.disabled){const u=l===0&&n?F(i):i[l-1];i[l]=u&&s!==u.id&&n?u:Te(u==null?void 0:u.rowId)}}return t}function Me(t){const s=se(t),n=ie(s),e=[];for(let i=0;i<n;i+=1)for(const l of s){const o=l[i];o&&e.push(Y(N({},o),{rowId:o.rowId?`${i}`:void 0}))}return e}function et(t={}){var s;const n=(s=t.store)==null?void 0:s.getState(),e=oe(t),i=y(t.activeId,n==null?void 0:n.activeId,t.defaultActiveId),l=Y(N({},e.getState()),{id:y(t.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:i,baseElement:y(n==null?void 0:n.baseElement,null),includesBaseElement:y(t.includesBaseElement,n==null?void 0:n.includesBaseElement,i===null),moves:y(n==null?void 0:n.moves,0),orientation:y(t.orientation,n==null?void 0:n.orientation,"both"),rtl:y(t.rtl,n==null?void 0:n.rtl,!1),virtualFocus:y(t.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:y(t.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:y(t.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:y(t.focusShift,n==null?void 0:n.focusShift,!1)}),o=le(l,e,t.store);ce(o,()=>de(o,["renderedItems","activeId"],u=>{o.setState("activeId",w=>{var I;return w!==void 0?w:(I=F(u.renderedItems))==null?void 0:I.id})}));const c=(u="next",w={})=>{var I,V;const E=o.getState(),{skip:L=0,activeId:S=E.activeId,focusShift:H=E.focusShift,focusLoop:R=E.focusLoop,focusWrap:B=E.focusWrap,includesBaseElement:T=E.includesBaseElement,renderedItems:O=E.renderedItems,rtl:D=E.rtl}=w,h=u==="up"||u==="down",M=u==="next"||u==="down",j=M?D&&!h:!D||h,U=H&&!L;let f=h?ue(De(se(O),S,U)):O;if(f=j?X(f):f,f=h?Me(f):f,S==null)return(I=F(f))==null?void 0:I.id;const C=f.find(d=>d.id===S);if(!C)return(V=F(f))==null?void 0:V.id;const $=f.some(d=>d.rowId),q=f.indexOf(C),r=f.slice(q+1),a=ee(r,C.rowId);if(L){const d=Re(a,S),p=d.slice(L)[0]||d[d.length-1];return p==null?void 0:p.id}const m=R&&(h?R!=="horizontal":R!=="vertical"),v=$&&B&&(h?B!=="horizontal":B!=="vertical"),g=M?(!$||h)&&m&&T:h?T:!1;if(m){const d=v&&!g?f:ee(f,C.rowId),p=Be(d,S,g),b=F(p,S);return b==null?void 0:b.id}if(v){const d=F(g?a:r,S);return g?(d==null?void 0:d.id)||null:d==null?void 0:d.id}const x=F(a,S);return!x&&g?null:x==null?void 0:x.id};return Y(N(N({},e),o),{setBaseElement:u=>o.setState("baseElement",u),setActiveId:u=>o.setState("activeId",u),move:u=>{u!==void 0&&(o.setState("activeId",u),o.setState("moves",w=>w+1))},first:()=>{var u;return(u=F(o.getState().renderedItems))==null?void 0:u.id},last:()=>{var u;return(u=F(X(o.getState().renderedItems)))==null?void 0:u.id},next:u=>(u!==void 0&&typeof u=="number"&&(u={skip:u}),c("next",u)),previous:u=>(u!==void 0&&typeof u=="number"&&(u={skip:u}),c("previous",u)),down:u=>(u!==void 0&&typeof u=="number"&&(u={skip:u}),c("down",u)),up:u=>(u!==void 0&&typeof u=="number"&&(u={skip:u}),c("up",u))})}function tt(t,s,n){return t=ae(t,s,n),_(t,n,"activeId","setActiveId"),_(t,n,"includesBaseElement"),_(t,n,"virtualFocus"),_(t,n,"orientation"),_(t,n,"rtl"),_(t,n,"focusLoop"),_(t,n,"focusWrap"),_(t,n,"focusShift"),t}var ze="div";function We(t){return t.some(s=>!!s.rowId)}function Ve(t){const s=t.target;return s&&!re(s)?!1:t.key.length===1&&!t.ctrlKey&&!t.metaKey}function He(t){return t.key==="Shift"||t.key==="Control"||t.key==="Alt"||t.key==="Meta"}function te(t,s,n){return W(e=>{var i;if(s==null||s(e),e.defaultPrevented||e.isPropagationStopped()||!A(e)||He(e)||Ve(e))return;const l=t.getState(),o=(i=P(t,l.activeId))==null?void 0:i.element;if(!o)return;const c=e,u=ne(c,["view"]),w=n==null?void 0:n.current;o!==w&&o.focus(),he(o,e.type,u)||e.preventDefault(),e.currentTarget.contains(o)&&e.stopPropagation()})}function Oe(t){return _e(ue(X(Pe(t))))}function Ue(t){const[s,n]=K.useState(!1),e=K.useCallback(()=>n(!0),[]),i=t.useState(l=>P(t,l.activeId));return K.useEffect(()=>{const l=i==null?void 0:i.element;s&&l&&(n(!1),l.focus({preventScroll:!0}))},[i,s]),e}var $e=fe(function(s){var n=s,{store:e,composite:i=!0,focusOnMove:l=i,moveOnKeyPress:o=!0}=n,c=ne(n,["store","composite","focusOnMove","moveOnKeyPress"]);const u=xe();e=e||u,me(e,!1);const w=K.useRef(null),I=K.useRef(null),V=Ue(e),E=e.useState("moves"),[,L]=Ie(i?e.setBaseElement:null);K.useEffect(()=>{var r;if(!e||!E||!i||!l)return;const{activeId:a}=e.getState(),m=(r=P(e,a))==null?void 0:r.element;m&&Ce(m)},[e,E,i,l]),Q(()=>{if(!e||!E||!i)return;const{baseElement:r,activeId:a}=e.getState();if(!(a===null)||!r)return;const v=I.current;I.current=null,v&&k(v,{relatedTarget:r}),ke(r)||r.focus()},[e,E,i]);const S=e.useState("activeId"),H=e.useState("virtualFocus");Q(()=>{var r;if(!e||!i||!H)return;const a=I.current;if(I.current=null,!a)return;const v=((r=P(e,S))==null?void 0:r.element)||ve(a);v!==a&&k(a,{relatedTarget:v})},[e,S,H,i]);const R=te(e,c.onKeyDownCapture,I),B=te(e,c.onKeyUpCapture,I),T=c.onFocusCapture,O=W(r=>{if(T==null||T(r),r.defaultPrevented||!e)return;const{virtualFocus:a}=e.getState();if(!a)return;const m=r.relatedTarget,v=be(r.currentTarget);A(r)&&v&&(r.stopPropagation(),I.current=m)}),D=c.onFocus,h=W(r=>{if(D==null||D(r),r.defaultPrevented||!i||!e)return;const{relatedTarget:a}=r,{virtualFocus:m}=e.getState();m?A(r)&&!G(e,a)&&queueMicrotask(V):A(r)&&e.setActiveId(null)}),M=c.onBlurCapture,j=W(r=>{var a;if(M==null||M(r),r.defaultPrevented||!e)return;const{virtualFocus:m,activeId:v}=e.getState();if(!m)return;const g=(a=P(e,v))==null?void 0:a.element,x=r.relatedTarget,d=G(e,x),p=I.current;I.current=null,A(r)&&d?(x===g?p&&p!==x&&k(p,r):g?k(g,r):p&&k(p,r),r.stopPropagation()):!G(e,r.target)&&g&&k(g,r)}),U=c.onKeyDown,f=pe(o),C=W(r=>{var a;if(U==null||U(r),r.defaultPrevented||!e||!A(r))return;const{orientation:m,renderedItems:v,activeId:g}=e.getState(),x=P(e,g);if((a=x==null?void 0:x.element)!=null&&a.isConnected)return;const d=m!=="horizontal",p=m!=="vertical",b=We(v);if((r.key==="ArrowLeft"||r.key==="ArrowRight"||r.key==="Home"||r.key==="End")&&re(r.currentTarget))return;const J={ArrowUp:(b||d)&&(()=>{if(b){const z=Oe(v);return z==null?void 0:z.id}return e==null?void 0:e.last()}),ArrowRight:(b||p)&&e.first,ArrowDown:(b||d)&&e.first,ArrowLeft:(b||p)&&e.last,Home:e.first,End:e.last,PageUp:e.first,PageDown:e.last}[r.key];if(J){const z=J();if(z!==void 0){if(!f(r))return;r.preventDefault(),e.move(z)}}});c=ge(c,r=>Ke.jsx(Fe,{value:e,children:r}),[e]);const $=e.useState(r=>{var a;if(e&&i&&r.virtualFocus)return(a=P(e,r.activeId))==null?void 0:a.id});c=Ee(Z({"aria-activedescendant":$},c),{ref:Se(w,L,c.ref),onKeyDownCapture:R,onKeyUpCapture:B,onFocusCapture:O,onFocus:h,onBlurCapture:j,onKeyDown:C});const q=e.useState(r=>i&&(r.virtualFocus||r.activeId===null));return c=Ae(Z({focusable:q},c)),c});ye(function(s){const n=$e(s);return we(ze,n)});export{$e as a,et as c,tt as u};

/*---------------------------------------------------------------------------------------------
 * Copyright (c) Bentley Systems, Incorporated. All rights reserved.
 * See LICENSE.md in the project root for license terms and full copyright notice.
 *--------------------------------------------------------------------------------------------*/
.ü•ùSelectRoot {
	@layer base {
		&:where(:has(select.ü•ùSelect), [data-_sk-has-select="true"]) {
			display: inline-grid;
			align-items: center;
			isolation: isolate;

			> * {
				grid-area: 1 / 1 / -1 / -1;
			}
		}
	}
}

.ü•ùSelect {
	--‚ú®color--default: var(--stratakit-color-text-neutral-primary);
	--‚ú®color--placeholder: var(--stratakit-color-text-neutral-tertiary);
	--‚ú®color--disabled: var(--stratakit-color-text-neutral-disabled);

	--‚ú®height: 1.5rem;
	--‚ú®gap: calc(var(--stratakit-space-x1) + var(--stratakit-space-x05));
	--‚ú®padding-inline-start: var(--stratakit-space-x2);
	--‚ú®padding-inline-end: calc(
		var(--‚ú®gap) +
		var(--stratakit-space-x4) /* Arrow size */ +
		var(--stratakit-space-x1) /* Arrow padding */
	);

	--‚ú®shadow-border: 0px 0px 0px 1px var(--ü•ùSelect-border-color) inset;

	/* #region Variant: solid */
	--‚ú®bg--solid-default: var(--stratakit-color-bg-neutral-base);
	--‚ú®bg--solid-hover: color-mix(
		in oklch,
		var(--‚ú®bg--solid-default) 100%,
		var(--stratakit-color-glow-hue) var(--stratakit-color-bg-glow-base-hover-\%)
	);
	--‚ú®bg--solid-pressed: color-mix(
		in oklch,
		var(--‚ú®bg--solid-default) 100%,
		var(--stratakit-color-glow-hue) var(--stratakit-color-bg-glow-base-pressed-\%)
	);
	--‚ú®bg--solid-disabled: var(--stratakit-color-bg-glow-on-surface-disabled);

	--‚ú®shadow--solid:
		var(--stratakit-shadow-control-button-base-inset), var(--‚ú®shadow-border),
		var(--stratakit-shadow-control-button-base-drop);

	--‚ú®border--solid-default: var(--stratakit-color-border-shadow-base);
	--‚ú®border--solid-hover: color-mix(
		in oklch,
		var(--‚ú®border--solid-default) 100%,
		var(--stratakit-color-glow-hue) var(--stratakit-color-border-glow-base-hover-\%)
	);
	--‚ú®border--solid-pressed: color-mix(
		in oklch,
		var(--‚ú®border--solid-default) 100%,
		var(--stratakit-color-glow-hue) var(--stratakit-color-border-glow-base-pressed-\%)
	);
	--‚ú®border--solid-disabled: transparent;
	/* #endregion */

	/* #region Variant: outline */
	--‚ú®bg--outline-default: var(--stratakit-color-bg-control-select);
	--‚ú®bg--outline-hover: color-mix(
		in oklch,
		var(--‚ú®bg--outline-default) 100%,
		var(--stratakit-color-glow-hue) var(--stratakit-color-bg-glow-base-hover-\%)
	);
	--‚ú®bg--outline-pressed: color-mix(
		in oklch,
		var(--‚ú®bg--outline-default) 100%,
		var(--stratakit-color-glow-hue) var(--stratakit-color-bg-glow-base-pressed-\%)
	);
	--‚ú®bg--outline-disabled: var(--stratakit-color-bg-control-select);

	--‚ú®border--outline-default: var(--stratakit-color-border-neutral-base);
	--‚ú®border--outline-hover: color-mix(
		in oklch,
		var(--‚ú®border--outline-default) 100%,
		var(--stratakit-color-glow-hue) var(--stratakit-color-border-glow-base-hover-\%)
	);
	--‚ú®border--outline-pressed: color-mix(
		in oklch,
		var(--‚ú®border--outline-default) 100%,
		var(--stratakit-color-glow-hue) var(--stratakit-color-border-glow-base-pressed-\%)
	);
	--‚ú®border--outline-disabled: var(--stratakit-color-border-glow-on-surface-disabled);
	/* #endregion */

	/* #region Variant: ghost */
	--‚ú®bg--ghost-default: transparent;
	--‚ú®bg--ghost-hover: var(--stratakit-color-bg-glow-on-surface-neutral-hover);
	--‚ú®bg--ghost-pressed: var(--stratakit-color-bg-glow-on-surface-neutral-pressed);
	--‚ú®bg--ghost-disabled: transparent;
	/* #endregion */

	@layer base {
		border: none;
		appearance: none;
		user-select: none;
		line-height: 1.2;
		cursor: pointer;

		min-inline-size: calc(var(--‚ú®padding-inline-start) + 1ch + var(--‚ú®padding-inline-end));
		text-overflow: ellipsis;
		font-size: var(--stratakit-font-size-12);
		border-radius: 4px;
		background-color: var(--ü•ùSelect-background-color);
		box-shadow: var(--‚ú®shadow-border);
		color: var(--‚ú®color--default);
		transition: background-color 150ms ease-out;

		&:where(select:not([multiple])) {
			min-block-size: var(--‚ú®height);
			padding-inline-start: var(--‚ú®padding-inline-start);
			padding-inline-end: var(--‚ú®padding-inline-end);

			-webkit-tap-highlight-color: var(--stratakit-color-bg-glow-on-surface-neutral-pressed);
			--ü•ùIcon-color: var(--üåÄSelect-state--default, var(--stratakit-color-icon-neutral-base))
				var(--üåÄSelect-state--hover, var(--stratakit-color-icon-neutral-primary))
				var(--üåÄSelect-state--pressed, var(--stratakit-color-icon-neutral-primary))
				var(--üåÄSelect-state--disabled, var(--stratakit-color-icon-neutral-disabled));

			&:where(:has(> option[disabled]:checked)) {
				color: var(--‚ú®color--placeholder);
			}
		}

		@supports (appearance: base-select) {
			&:where(select) {
				appearance: base-select;

				&::picker-icon {
					display: none;
				}
			}
		}

		@supports not (appearance: base-select) {
			> option {
				background-color: var(--stratakit-color-bg-neutral-base);
			}
		}
	}

	@layer modifiers {
		&:where([data-_sk-variant="solid"]) {
			--ü•ùSelect-background-color: var(--üåÄSelect-state--default, var(--‚ú®bg--solid-default))
				var(--üåÄSelect-state--hover, var(--‚ú®bg--solid-hover))
				var(--üåÄSelect-state--pressed, var(--‚ú®bg--solid-pressed))
				var(--üåÄSelect-state--disabled, var(--‚ú®bg--solid-disabled));
			--ü•ùSelect-border-color: var(--üåÄSelect-state--default, var(--‚ú®border--solid-default))
				var(--üåÄSelect-state--hover, var(--‚ú®border--solid-hover))
				var(--üåÄSelect-state--pressed, var(--‚ú®border--solid-pressed))
				var(--üåÄSelect-state--disabled, var(--‚ú®border--solid-disabled));
			box-shadow: var(--üåÄSelect-state--default, var(--‚ú®shadow--solid))
				var(--üåÄSelect-state--hover, var(--‚ú®shadow--solid))
				var(--üåÄSelect-state--pressed, var(--‚ú®shadow-border)) var(--üåÄSelect-state--disabled, none);
		}

		&:where([data-_sk-variant="outline"]) {
			--ü•ùSelect-background-color: var(--üåÄSelect-state--default, var(--‚ú®bg--outline-default))
				var(--üåÄSelect-state--hover, var(--‚ú®bg--outline-hover))
				var(--üåÄSelect-state--pressed, var(--‚ú®bg--outline-pressed))
				var(--üåÄSelect-state--disabled, var(--‚ú®bg--outline-disabled));
			--ü•ùSelect-border-color: var(--üåÄSelect-state--default, var(--‚ú®border--outline-default))
				var(--üåÄSelect-state--hover, var(--‚ú®border--outline-hover))
				var(--üåÄSelect-state--pressed, var(--‚ú®border--outline-pressed))
				var(--üåÄSelect-state--disabled, var(--‚ú®border--outline-disabled));
		}

		&:where([data-_sk-variant="ghost"]) {
			--ü•ùSelect-background-color: var(--üåÄSelect-state--default, var(--‚ú®bg--ghost-default))
				var(--üåÄSelect-state--hover, var(--‚ú®bg--ghost-hover))
				var(--üåÄSelect-state--pressed, var(--‚ú®bg--ghost-pressed))
				var(--üåÄSelect-state--disabled, var(--‚ú®bg--ghost-disabled));
			--ü•ùSelect-border-color: transparent;
		}
	}

	@layer states {
		@media (any-hover: hover) {
			&:where(:hover) {
				--üåÄSelect-state: var(--üåÄSelect-state--hover);
			}
		}

		/* Reuse hover state when an associated popover is open. */
		&:where([data-has-popover-open]) {
			--üåÄSelect-state: var(--üåÄSelect-state--hover);
		}

		&:where(:active) {
			--üåÄSelect-state: var(--üåÄSelect-state--pressed);
		}

		&:where(:disabled, [aria-disabled="true"]) {
			--üåÄSelect-state: var(--üåÄSelect-state--disabled);
			color: var(--‚ú®color--disabled);
			cursor: not-allowed;
			-webkit-tap-highlight-color: transparent;
		}
	}

	@layer base.üåÄ {
		/* See https://kizu.dev/cyclic-toggles/ */
		--üåÄSelect-state: var(--üåÄSelect-state--default);
		--üåÄSelect-state--default: var(--üåÄSelect-state,);
		--üåÄSelect-state--hover: var(--üåÄSelect-state,);
		--üåÄSelect-state--pressed: var(--üåÄSelect-state,);
		--üåÄSelect-state--disabled: var(--üåÄSelect-state,);
	}
}

.ü•ùSelectArrow {
	@layer base {
		justify-self: end;
		margin-inline-end: var(--stratakit-space-x1);
		pointer-events: none;
		z-index: 1; /* should be above the button */

		--ü•ùIcon-color: var(--üåÄSelectArrow-state--default, var(--stratakit-color-icon-neutral-base))
			var(--üåÄSelectArrow-state--hover, var(--stratakit-color-icon-neutral-primary))
			var(--üåÄSelectArrow-state--disabled, var(--stratakit-color-icon-neutral-disabled));
	}

	@layer states {
		@media (any-hover: hover) {
			:where(.ü•ùSelect:hover) + & {
				--üåÄSelectArrow-state: var(--üåÄSelectArrow-state--hover);
			}
		}

		:where(.ü•ùSelect:disabled) + & {
			--üåÄSelectArrow-state: var(--üåÄSelectArrow-state--disabled);
		}
	}

	@layer base.üåÄ {
		--üåÄSelectArrow-state: var(--üåÄSelectArrow-state--default);
		--üåÄSelectArrow-state--default: var(--üåÄSelectArrow-state,);
		--üåÄSelectArrow-state--hover: var(--üåÄSelectArrow-state,);
		--üåÄSelectArrow-state--disabled: var(--üåÄSelectArrow-state,);
	}
}

@supports (appearance: base-select) {
	selectedcontent {
		@layer base {
			display: inline-flex;
			align-items: center;
			flex-shrink: 0;
			gap: var(--stratakit-space-x1);
		}
	}

	option {
		--‚ú®bg--default: transparent;
		--‚ú®bg--hover: var(--stratakit-color-bg-glow-on-surface-neutral-hover);
		--‚ú®bg--pressed: var(--stratakit-color-bg-glow-on-surface-neutral-pressed);
		--‚ú®bg--disabled: transparent;

		--‚ú®color--default: var(--stratakit-color-text-neutral-primary);
		--‚ú®color--active: var(--stratakit-color-text-accent-strong);
		--‚ú®color--disabled: var(--‚ú®bg--disabled);

		@layer base {
			border-radius: 4px;
			padding-inline: 4px;

			background-color: var(--ü•ùSelect-option-background-color);

			--ü•ùSelect-option-background-color: var(
					--üåÄselect-option-state--default,
					var(--‚ú®bg--default)
				)
				var(--üåÄselect-option-state--hover, var(--‚ú®bg--hover))
				var(--üåÄselect-option-state--pressed, var(--‚ú®bg--pressed))
				var(--üåÄselect-option-state--disabled, var(--‚ú®bg--default));

			color: var(--stratakit-color-text-neutral-primary);

			--ü•ùIcon-color: var(
					--üåÄselect-option-state--default,
					var(--stratakit-color-icon-neutral-base)
				)
				var(--üåÄselect-option-state--hover, var(--stratakit-color-icon-neutral-hover))
				var(--üåÄselect-option-state--pressed, var(--stratakit-color-icon-neutral-hover))
				var(--üåÄselect-option-state--active, var(--stratakit-color-icon-accent-strong))
				var(--üåÄselect-option-state--active-hover, var(--stratakit-color-icon-accent-strong))
				var(--üåÄselect-option-state--disabled, var(--stratakit-color-icon-neutral-disabled));

			&::checkmark {
				order: 1;
				margin-left: auto;
				content: "‚úì";
				color: var(--stratakit-color-icon-neutral-base);
			}
		}

		@layer states {
			@media (any-hover: hover) {
				&:where(:hover) {
					--üåÄselect-option-state: var(--üåÄselect-option-state--hover);
				}
			}

			&:where(:active) {
				--üåÄselect-option-state: var(--üåÄselect-option-state--pressed);
			}

			&:where(:disabled, [aria-disabled="true"]) {
				--üåÄselect-option-state: var(--üåÄselect-option-state--disabled);
				cursor: not-allowed;
				color: var(--stratakit-color-text-neutral-disabled);
			}
		}

		@layer base.üåÄ {
			/* See https://kizu.dev/cyclic-toggles/ */
			--üåÄselect-option-state: var(--üåÄselect-option-state--default);
			--üåÄselect-option-state--default: var(--üåÄselect-option-state,);
			--üåÄselect-option-state--hover: var(--üåÄselect-option-state,);
			--üåÄselect-option-state--pressed: var(--üåÄselect-option-state,);
			--üåÄselect-option-state--active: var(--üåÄselect-option-state,);
			--üåÄselect-option-state--active-hover: var(--üåÄselect-option-state,);
			--üåÄselect-option-state--disabled: var(--üåÄselect-option-state,);
		}
	}
}

@media (forced-colors: active) {
	.ü•ùSelect {
		background-color: ButtonFace;
		border: 1px solid ButtonBorder;
		color: ButtonText;

		&:where(:has(> option[disabled]:checked)) {
			color: GrayText;
		}

		&:where(:disabled, [aria-disabled="true"]) {
			border-color: GrayText;
			color: GrayText;

			+ .ü•ùSelectArrow {
				--ü•ùIcon-color: GrayText;
			}
		}
	}

	@supports (appearance: base-select) {
		option {
			&::checkmark {
				color: SelectedItemText;
			}

			&:where(:checked) {
				forced-color-adjust: none;
				background-color: SelectedItem;
				color: SelectedItemText;
			}

			&:where(:disabled, [aria-disabled="true"]) {
				color: GrayText;
			}
		}
	}
}

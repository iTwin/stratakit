---
// This simply registers the `<example-embed>` element, which renders a React component.
---

<script>
	import { createElement } from "react";
	import { ExampleEmbed } from "./ExamplePreview.tsx";
	import { mountPortal } from "./StrataKitRoot.tsx";

	customElements.define(
		"example-embed",
		class extends HTMLElement {
			#controller: AbortController | undefined;

			connectedCallback() {
				this.#controller = new AbortController();

				const src = this.dataset.src;
				if (!src) return;

				const unmount = mountPortal({
					element: createElement(ExampleEmbed, { src }),
					target: this,
				});

				this.#controller.signal.onabort = () => unmount?.();
			}

			disconnectedCallback() {
				this.#controller?.abort();
			}
		},
	);
</script>

<style is:global>
	@layer page {
		example-embed {
			display: block;

			&,
			> * {
				min-block-size: 125px; /* Reduce layout shift */
			}

			border-radius: 8px;
			outline: 1px solid var(--stratakit-color-border-neutral-muted);
			background-color: var(--stratakit-color-bg-page-base);
		}
	}
</style>

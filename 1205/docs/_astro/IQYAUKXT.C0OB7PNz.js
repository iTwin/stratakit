import{u as ie,g as k,s as re,i as O,a as ue,f as ae,c as oe}from"./WZWDIE3S.CG_H7g2N.js";import{f as se,h as le,u as ce}from"./U6HHPQDW.C_64gtph.js";import{f as de,a as fe,z as ve,aC as me,aD as J,aE as R,ae as Ie,h as H,k as T,A as ge,l as Z,s as Se,j as Ee,b as ye,d as we,aF as he,an as I,o as xe}from"./ExamplePreview.xteD-z5s.js";import{r as D}from"./index.DIfZGIpv.js";import{d as Fe,e as Ce}from"./GVAFFF2B.GxcgIE4B.js";import{c as be,s as Pe,f as ke,a as Ae,d as P}from"./Q5W46E73.CLL9w1oL.js";function ee(t){const e=[];for(const n of t)e.push(...n);return e}function q(t){return t.slice().reverse()}var _e="div";function Le(t){return t.some(e=>!!e.rowId)}function Be(t){const e=t.target;return e&&!Z(e)?!1:t.key.length===1&&!t.ctrlKey&&!t.metaKey}function Re(t){return t.key==="Shift"||t.key==="Control"||t.key==="Alt"||t.key==="Meta"}function Q(t,e,n){return H(a=>{var s;if(e?.(a),a.defaultPrevented||a.isPropagationStopped()||!T(a)||Re(a)||Be(a))return;const u=t.getState(),o=(s=k(t,u.activeId))==null?void 0:s.element;if(!o)return;const{view:b,...i}=a,g=n?.current;o!==g&&o.focus(),he(o,a.type,i)||a.preventDefault(),a.currentTarget.contains(o)&&a.stopPropagation()})}function Te(t){return ae(ee(q(oe(t))))}function De(t){const[e,n]=D.useState(!1),a=D.useCallback(()=>n(!0),[]),s=t.useState(u=>k(t,u.activeId));return D.useEffect(()=>{const u=s?.element;e&&u&&(n(!1),u.focus({preventScroll:!0}))},[s,e]),a}var Ke=fe(function({store:e,composite:n=!0,focusOnMove:a=n,moveOnKeyPress:s=!0,...u}){const o=ie();e=e||o,ve(e,!1);const b=D.useRef(null),i=D.useRef(null),g=De(e),S=e.useState("moves"),[,N]=me(n?e.setBaseElement:null);D.useEffect(()=>{var r;if(!e||!S||!n||!a)return;const{activeId:l}=e.getState(),d=(r=k(e,l))==null?void 0:r.element;d&&se(d)},[e,S,n,a]),J(()=>{if(!e||!S||!n)return;const{baseElement:r,activeId:l}=e.getState();if(!(l===null)||!r)return;const f=i.current;i.current=null,f&&R(f,{relatedTarget:r}),le(r)||r.focus()},[e,S,n]);const E=e.useState("activeId"),A=e.useState("virtualFocus");J(()=>{var r;if(!e||!n||!A)return;const l=i.current;if(i.current=null,!l)return;const f=((r=k(e,E))==null?void 0:r.element)||Ie(l);f!==l&&R(l,{relatedTarget:f})},[e,E,A,n]);const y=Q(e,u.onKeyDownCapture,i),V=Q(e,u.onKeyUpCapture,i),_=u.onFocusCapture,K=H(r=>{if(_?.(r),r.defaultPrevented||!e)return;const{virtualFocus:l}=e.getState();if(!l)return;const d=r.relatedTarget,f=re(r.currentTarget);T(r)&&f&&(r.stopPropagation(),i.current=d)}),z=u.onFocus,U=H(r=>{if(z?.(r),r.defaultPrevented||!n||!e)return;const{relatedTarget:l}=r,{virtualFocus:d}=e.getState();d?T(r)&&!O(e,l)&&queueMicrotask(g):T(r)&&e.setActiveId(null)}),M=u.onBlurCapture,w=H(r=>{var l;if(M?.(r),r.defaultPrevented||!e)return;const{virtualFocus:d,activeId:f}=e.getState();if(!d)return;const h=(l=k(e,f))==null?void 0:l.element,F=r.relatedTarget,x=O(e,F),m=i.current;i.current=null,T(r)&&x?(F===h?m&&m!==F&&R(m,r):h?R(h,r):m&&R(m,r),r.stopPropagation()):!O(e,r.target)&&h&&R(h,r)}),p=u.onKeyDown,$=ge(s),j=H(r=>{var l;if(p?.(r),r.nativeEvent.isComposing||r.defaultPrevented||!e||!T(r))return;const{orientation:d,renderedItems:f,activeId:h}=e.getState(),F=k(e,h);if((l=F?.element)!=null&&l.isConnected)return;const x=d!=="horizontal",m=d!=="vertical",c=Le(f);if((r.key==="ArrowLeft"||r.key==="ArrowRight"||r.key==="Home"||r.key==="End")&&Z(r.currentTarget))return;const Y={ArrowUp:(c||x)&&(()=>{if(c){const W=Te(f);return W?.id}return e?.last()}),ArrowRight:(c||m)&&e.first,ArrowDown:(c||x)&&e.first,ArrowLeft:(c||m)&&e.last,Home:e.first,End:e.last,PageUp:e.first,PageDown:e.last}[r.key];if(Y){const W=Y();if(W!==void 0){if(!$(r))return;r.preventDefault(),e.move(W)}}});u=Se(u,r=>Ee.jsx(ue,{value:e,children:r}),[e]),u={"aria-activedescendant":e.useState(r=>{var l;if(e&&n&&r.virtualFocus)return(l=k(e,r.activeId))==null?void 0:l.id}),...u,ref:ye(b,N,u.ref),onKeyDownCapture:y,onKeyUpCapture:V,onFocusCapture:K,onFocus:U,onBlurCapture:w,onKeyDown:j};const L=e.useState(r=>n&&(r.virtualFocus||r.activeId===null));return u=ce({focusable:L,...u}),u}),Xe=de(function(e){const n=Ke(e);return we(_e,n)}),ze={id:null};function C(t,e){return t.find(n=>e?!n.disabled&&n.id!==e:!n.disabled)}function Me(t,e){return t.filter(n=>e?!n.disabled&&n.id!==e:!n.disabled)}function X(t,e){return t.filter(n=>n.rowId===e)}function pe(t,e,n=!1){const a=t.findIndex(s=>s.id===e);return[...t.slice(a+1),...n?[ze]:[],...t.slice(0,a)]}function te(t){const e=[];for(const n of t){const a=e.find(s=>{var u;return((u=s[0])==null?void 0:u.rowId)===n.rowId});a?a.push(n):e.push([n])}return e}function ne(t){let e=0;for(const{length:n}of t)n>e&&(e=n);return e}function We(t){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:t}}function He(t,e,n){const a=ne(t);for(const s of t)for(let u=0;u<a;u+=1){const o=s[u];if(!o||n&&o.disabled){const i=u===0&&n?C(s):s[u-1];s[u]=i&&e!==i.id&&n?i:We(i?.rowId)}}return t}function Ne(t){const e=te(t),n=ne(e),a=[];for(let s=0;s<n;s+=1)for(const u of e){const o=u[s];o&&a.push({...o,rowId:o.rowId?`${s}`:void 0})}return a}function Ue(t={}){var e;const n=(e=t.store)==null?void 0:e.getState(),a=Fe(t),s=I(t.activeId,n?.activeId,t.defaultActiveId),u={...a.getState(),id:I(t.id,n?.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:s,baseElement:I(n?.baseElement,null),includesBaseElement:I(t.includesBaseElement,n?.includesBaseElement,s===null),moves:I(n?.moves,0),orientation:I(t.orientation,n?.orientation,"both"),rtl:I(t.rtl,n?.rtl,!1),virtualFocus:I(t.virtualFocus,n?.virtualFocus,!1),focusLoop:I(t.focusLoop,n?.focusLoop,!1),focusWrap:I(t.focusWrap,n?.focusWrap,!1),focusShift:I(t.focusShift,n?.focusShift,!1)},o=be(u,a,t.store);Pe(o,()=>ke(o,["renderedItems","activeId"],i=>{o.setState("activeId",g=>{var S;return g!==void 0?g:(S=C(i.renderedItems))==null?void 0:S.id})}));const b=(i="next",g={})=>{var S,N;const E=o.getState(),{skip:A=0,activeId:y=E.activeId,focusShift:V=E.focusShift,focusLoop:_=E.focusLoop,focusWrap:K=E.focusWrap,includesBaseElement:z=E.includesBaseElement,renderedItems:U=E.renderedItems,rtl:M=E.rtl}=g,w=i==="up"||i==="down",p=i==="next"||i==="down",$=p?M&&!w:!M||w,j=V&&!A;let v=w?ee(He(te(U),y,j)):U;if(v=$?q(v):v,v=w?Ne(v):v,y==null)return(S=C(v))==null?void 0:S.id;const L=v.find(c=>c.id===y);if(!L)return(N=C(v))==null?void 0:N.id;const r=v.some(c=>c.rowId),l=v.indexOf(L),d=v.slice(l+1),f=X(d,L.rowId);if(A){const c=Me(f,y),B=c.slice(A)[0]||c[c.length-1];return B?.id}const h=_&&(w?_!=="horizontal":_!=="vertical"),F=r&&K&&(w?K!=="horizontal":K!=="vertical"),x=p?(!r||w)&&h&&z:w?z:!1;if(h){const c=F&&!x?v:X(v,L.rowId),B=pe(c,y,x),G=C(B,y);return G?.id}if(F){const c=C(x?f:d,y);return x?c?.id||null:c?.id}const m=C(f,y);return!m&&x?null:m?.id};return{...a,...o,setBaseElement:i=>o.setState("baseElement",i),setActiveId:i=>o.setState("activeId",i),move:i=>{i!==void 0&&(o.setState("activeId",i),o.setState("moves",g=>g+1))},first:()=>{var i;return(i=C(o.getState().renderedItems))==null?void 0:i.id},last:()=>{var i;return(i=C(q(o.getState().renderedItems)))==null?void 0:i.id},next:i=>(i!==void 0&&typeof i=="number"&&(i={skip:i}),b("next",i)),previous:i=>(i!==void 0&&typeof i=="number"&&(i={skip:i}),b("previous",i)),down:i=>(i!==void 0&&typeof i=="number"&&(i={skip:i}),b("down",i)),up:i=>(i!==void 0&&typeof i=="number"&&(i={skip:i}),b("up",i))}}function Ve(t){return{id:xe(t.id),...t}}function $e(t,e,n){return t=Ce(t,e,n),P(t,n,"activeId","setActiveId"),P(t,n,"includesBaseElement"),P(t,n,"virtualFocus"),P(t,n,"orientation"),P(t,n,"rtl"),P(t,n,"focusLoop"),P(t,n,"focusWrap"),P(t,n,"focusShift"),t}function Ze(t={}){t=Ve(t);const[e,n]=Ae(Ue,t);return $e(e,n,t)}export{Xe as C,$e as a,Ke as b,Ue as c,Ze as u};

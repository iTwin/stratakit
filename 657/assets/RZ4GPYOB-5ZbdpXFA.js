import{a9 as w,Z as h,$ as P,au as y,a1 as E,a2 as A,a3 as O}from"./~utils-BhWr2mUa.js";import{p as R,o as M,s as V,q as _,a5 as k,F as q,t as $,c as j,f as D,b as N,d as U,N as B,_ as H,u as T,j as Z,k as z,l as G,r as J}from"./XX67R432-Dq5NLWWu.js";import{a as F}from"./chunk-BAXFHI7N-CFnR9__p.js";function K(t){var i;const r=t.find(d=>!!d.element),a=[...t].reverse().find(d=>!!d.element);let s=(i=r==null?void 0:r.element)==null?void 0:i.parentElement;for(;s&&(a!=null&&a.element);){if(a&&s.contains(a.element))return s;s=s.parentElement}return q(s).body}function L(t){return t==null?void 0:t.__unstablePrivateStore}function Q(t={}){var i;w(t,t.store);const r=(i=t.store)==null?void 0:i.getState(),a=R(t.items,r==null?void 0:r.items,t.defaultItems,[]),s=new Map(a.map(e=>[e.id,e])),d={items:a,renderedItems:R(r==null?void 0:r.renderedItems,[])},p=L(t.store),o=h({items:a,renderedItems:d.renderedItems},p),I=h(d,t.store),v=e=>{const n=k(e,u=>u.element);o.setState("renderedItems",n),I.setState("renderedItems",n)};P(I,()=>y(o)),P(o,()=>E(o,["items"],e=>{I.setState("items",e.items)})),P(o,()=>E(o,["renderedItems"],e=>{let n=!0,u=requestAnimationFrame(()=>{const{renderedItems:c}=I.getState();e.renderedItems!==c&&v(e.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(u);const m=()=>{if(n){n=!1;return}cancelAnimationFrame(u),u=requestAnimationFrame(()=>v(e.renderedItems))},b=K(e.renderedItems),l=new IntersectionObserver(m,{root:b});for(const c of e.renderedItems)c.element&&l.observe(c.element);return()=>{cancelAnimationFrame(u),l.disconnect()}}));const S=(e,n,u=!1)=>{let m;return n(l=>{const c=l.findIndex(({id:f})=>f===e.id),C=l.slice();if(c!==-1){m=l[c];const f=_(_({},m),e);C[c]=f,s.set(e.id,f)}else C.push(e),s.set(e.id,e);return C}),()=>{n(l=>{if(!m)return u&&s.delete(e.id),l.filter(({id:f})=>f!==e.id);const c=l.findIndex(({id:f})=>f===e.id);if(c===-1)return l;const C=l.slice();return C[c]=m,s.set(e.id,m),C})}},x=e=>S(e,n=>o.setState("items",n),!0);return M(_({},I),{registerItem:x,renderItem:e=>V(x(e),S(e,n=>o.setState("renderedItems",n))),item:e=>{if(!e)return null;let n=s.get(e);if(!n){const{items:u}=o.getState();n=u.find(m=>m.id===e),n&&s.set(e,n)}return n||null},__unstablePrivateStore:o})}function W(t,i,r){return $(i,[r.store]),O(t,r,"items","setItems"),t}function se(t={}){const[i,r]=A(Q,t);return W(i,r,t)}var g=j(),X=g.useContext,oe=g.useProviderContext,ae=g.ContextProvider,ie=g.ScopedContextProvider,Y="div",ee=N(function(i){var r=i,{store:a,shouldRegisterItem:s=!0,getItem:d=B,element:p}=r,o=H(r,["store","shouldRegisterItem","getItem","element"]);const I=X();a=a||I;const v=T(o.id),S=F.useRef(p);return F.useEffect(()=>{const x=S.current;if(!v||!x||!s)return;const e=d({id:v,element:x});return a==null?void 0:a.renderItem(e)},[v,s,d,a]),o=Z(G({},o),{ref:z(S,o.ref)}),J(o)}),le=D(function(i){const r=ee(i);return U(Y,r)});export{le as C,ee as a,X as b,Q as c,oe as d,ie as e,W as f,ae as g,se as u};

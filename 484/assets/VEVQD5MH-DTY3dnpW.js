import{c as ce,a as le}from"./C3IKGW5T-B-jVwmst.js";import{ah as b,ag as G,ai as U,aj as de,ak as fe,al as ve,ao as me,$ as Ie,N as J,aq as F,J as pe,K as Se,L as ge,M as ne,bk as Ee,ar as be,bl as xe,bm as _,bn as ye,bo as Q,bp as A,aZ as we,bq as Ce,a4 as W,br as Pe,aJ as K,bs as Y,aY as he,aI as re,at as Fe,Y as oe,a5 as _e,a6 as ke,av as Ae,bt as Ke,bu as Le,bv as Re,W as Be,ab as Te,X as Me,ac as De}from"./~utils-MhdR7PcF.js";import{b as h,p as ze}from"./index-DDCMeoDP.js";function se(e){const s=[];for(const n of e)s.push(...n);return s}function X(e){return e.slice().reverse()}var We={id:null};function P(e,s){return e.find(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function Oe(e,s){return e.filter(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function ee(e,s){return e.filter(n=>n.rowId===s)}function $e(e,s,n=!1){const t=e.findIndex(i=>i.id===s);return[...e.slice(t+1),...n?[We]:[],...e.slice(0,t)]}function ie(e){const s=[];for(const n of e){const t=s.find(i=>{var c;return((c=i[0])==null?void 0:c.rowId)===n.rowId});t?t.push(n):s.push([n])}return s}function ae(e){let s=0;for(const{length:n}of e)n>s&&(s=n);return s}function He(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function Ne(e,s,n){const t=ae(e);for(const i of e)for(let c=0;c<t;c+=1){const a=i[c];if(!a||n&&a.disabled){const o=c===0&&n?P(i):i[c-1];i[c]=o&&s!==o.id&&n?o:He(o==null?void 0:o.rowId)}}return e}function Ve(e){const s=ie(e),n=ae(s),t=[];for(let i=0;i<n;i+=1)for(const c of s){const a=c[i];a&&t.push(G(U({},a),{rowId:a.rowId?`${i}`:void 0}))}return t}function Ue(e={}){var s;const n=(s=e.store)==null?void 0:s.getState(),t=ce(e),i=b(e.activeId,n==null?void 0:n.activeId,e.defaultActiveId),c=G(U({},t.getState()),{id:b(e.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:i,baseElement:b(n==null?void 0:n.baseElement,null),includesBaseElement:b(e.includesBaseElement,n==null?void 0:n.includesBaseElement,i===null),moves:b(n==null?void 0:n.moves,0),orientation:b(e.orientation,n==null?void 0:n.orientation,"both"),rtl:b(e.rtl,n==null?void 0:n.rtl,!1),virtualFocus:b(e.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:b(e.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:b(e.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:b(e.focusShift,n==null?void 0:n.focusShift,!1)}),a=de(c,t,e.store);fe(a,()=>ve(a,["renderedItems","activeId"],o=>{a.setState("activeId",x=>{var f;return x!==void 0?x:(f=P(o.renderedItems))==null?void 0:f.id})}));const l=(o="next",x={})=>{var f,O;const g=a.getState(),{skip:L=0,activeId:E=g.activeId,focusShift:$=g.focusShift,focusLoop:R=g.focusLoop,focusWrap:B=g.focusWrap,includesBaseElement:T=g.includesBaseElement,renderedItems:H=g.renderedItems,rtl:M=g.rtl}=x,y=o==="up"||o==="down",D=o==="next"||o==="down",j=D?M&&!y:!M||y,N=$&&!L;let v=y?se(Ne(ie(H),E,N)):H;if(v=j?X(v):v,v=y?Ve(v):v,E==null)return(f=P(v))==null?void 0:f.id;const k=v.find(d=>d.id===E);if(!k)return(O=P(v))==null?void 0:O.id;const V=v.some(d=>d.rowId),q=v.indexOf(k),r=v.slice(q+1),u=ee(r,k.rowId);if(L){const d=Oe(u,E),p=d.slice(L)[0]||d[d.length-1];return p==null?void 0:p.id}const m=R&&(y?R!=="horizontal":R!=="vertical"),I=V&&B&&(y?B!=="horizontal":B!=="vertical"),S=D?(!V||y)&&m&&T:y?T:!1;if(m){const d=I&&!S?v:ee(v,k.rowId),p=$e(d,E,S),C=P(p,E);return C==null?void 0:C.id}if(I){const d=P(S?u:r,E);return S?(d==null?void 0:d.id)||null:d==null?void 0:d.id}const w=P(u,E);return!w&&S?null:w==null?void 0:w.id};return G(U(U({},t),a),{setBaseElement:o=>a.setState("baseElement",o),setActiveId:o=>a.setState("activeId",o),move:o=>{o!==void 0&&(a.setState("activeId",o),a.setState("moves",x=>x+1))},first:()=>{var o;return(o=P(a.getState().renderedItems))==null?void 0:o.id},last:()=>{var o;return(o=P(X(a.getState().renderedItems)))==null?void 0:o.id},next:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("next",o)),previous:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("previous",o)),down:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("down",o)),up:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("up",o))})}function je(e){const s=Ie(e.id);return J({id:s},e)}function qe(e,s,n){return e=le(e,s,n),F(e,n,"activeId","setActiveId"),F(e,n,"includesBaseElement"),F(e,n,"virtualFocus"),F(e,n,"orientation"),F(e,n,"rtl"),F(e,n,"focusLoop"),F(e,n,"focusWrap"),F(e,n,"focusShift"),e}function at(e={}){e=je(e);const[s,n]=me(Ue,e);return qe(s,n,e)}var Ye="div";function Ge(e){return e.some(s=>!!s.rowId)}function Je(e){const s=e.target;return s&&!re(s)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function Xe(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function te(e,s,n){return W(t=>{var i;if(s==null||s(t),t.defaultPrevented||t.isPropagationStopped()||!K(t)||Xe(t)||Je(t))return;const c=e.getState(),a=(i=_(e,c.activeId))==null?void 0:i.element;if(!a)return;const l=t,{view:o}=l,x=ne(l,["view"]),f=n==null?void 0:n.current;a!==f&&a.focus(),Ke(a,t.type,x)||t.preventDefault(),t.currentTarget.contains(a)&&t.stopPropagation()})}function Ze(e){return Le(se(X(Re(e))))}function Qe(e){const[s,n]=h.useState(!1),t=h.useCallback(()=>n(!0),[]),i=e.useState(c=>_(e,c.activeId));return h.useEffect(()=>{const c=i==null?void 0:i.element;s&&c&&(n(!1),c.focus({preventScroll:!0}))},[i,s]),t}var et=Se(function(s){var n=s,{store:t,composite:i=!0,focusOnMove:c=i,moveOnKeyPress:a=!0}=n,l=ne(n,["store","composite","focusOnMove","moveOnKeyPress"]);const o=Ee();t=t||o,be(t,!1);const x=h.useRef(null),f=h.useRef(null),O=Qe(t),g=t.useState("moves"),[,L]=xe(i?t.setBaseElement:null);h.useEffect(()=>{var r;if(!t||!g||!i||!c)return;const{activeId:u}=t.getState(),m=(r=_(t,u))==null?void 0:r.element;m&&ye(m)},[t,g,i,c]),Q(()=>{if(!t||!g||!i)return;const{baseElement:r,activeId:u}=t.getState();if(!(u===null)||!r)return;const I=f.current;f.current=null,I&&A(I,{relatedTarget:r}),we(r)||r.focus()},[t,g,i]);const E=t.useState("activeId"),$=t.useState("virtualFocus");Q(()=>{var r;if(!t||!i||!$)return;const u=f.current;if(f.current=null,!u)return;const I=((r=_(t,E))==null?void 0:r.element)||Ce(u);I!==u&&A(u,{relatedTarget:I})},[t,E,$,i]);const R=te(t,l.onKeyDownCapture,f),B=te(t,l.onKeyUpCapture,f),T=l.onFocusCapture,H=W(r=>{if(T==null||T(r),r.defaultPrevented||!t)return;const{virtualFocus:u}=t.getState();if(!u)return;const m=r.relatedTarget,I=Pe(r.currentTarget);K(r)&&I&&(r.stopPropagation(),f.current=m)}),M=l.onFocus,y=W(r=>{if(M==null||M(r),r.defaultPrevented||!i||!t)return;const{relatedTarget:u}=r,{virtualFocus:m}=t.getState();m?K(r)&&!Y(t,u)&&queueMicrotask(O):K(r)&&t.setActiveId(null)}),D=l.onBlurCapture,j=W(r=>{var u;if(D==null||D(r),r.defaultPrevented||!t)return;const{virtualFocus:m,activeId:I}=t.getState();if(!m)return;const S=(u=_(t,I))==null?void 0:u.element,w=r.relatedTarget,d=Y(t,w),p=f.current;f.current=null,K(r)&&d?(w===S?p&&p!==w&&A(p,r):S?A(S,r):p&&A(p,r),r.stopPropagation()):!Y(t,r.target)&&S&&A(S,r)}),N=l.onKeyDown,v=he(a),k=W(r=>{var u;if(N==null||N(r),r.defaultPrevented||!t||!K(r))return;const{orientation:m,renderedItems:I,activeId:S}=t.getState(),w=_(t,S);if((u=w==null?void 0:w.element)!=null&&u.isConnected)return;const d=m!=="horizontal",p=m!=="vertical",C=Ge(I);if((r.key==="ArrowLeft"||r.key==="ArrowRight"||r.key==="Home"||r.key==="End")&&re(r.currentTarget))return;const Z={ArrowUp:(C||d)&&(()=>{if(C){const z=Ze(I);return z==null?void 0:z.id}return t==null?void 0:t.last()}),ArrowRight:(C||p)&&t.first,ArrowDown:(C||d)&&t.first,ArrowLeft:(C||p)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[r.key];if(Z){const z=Z();if(z!==void 0){if(!v(r))return;r.preventDefault(),t.move(z)}}});l=Fe(l,r=>ze.jsx(oe,{value:t,children:r}),[t]);const V=t.useState(r=>{var u;if(t&&i&&r.virtualFocus)return(u=_(t,r.activeId))==null?void 0:u.id});l=_e(J({"aria-activedescendant":V},l),{ref:ke(x,L,l.ref),onKeyDownCapture:R,onKeyUpCapture:B,onFocusCapture:H,onFocus:y,onBlurCapture:j,onKeyDown:k});const q=t.useState(r=>i&&(r.virtualFocus||r.activeId===null));return l=Ae(J({focusable:q},l)),l}),ut=pe(function(s){const n=et(s);return ge(Ye,n)});h.createContext(void 0);var ue=Be([De,oe],[Te,Me]),ct=ue.useContext,lt=ue.useProviderContext;h.createContext(void 0);h.createContext(!1);export{ut as C,qe as a,et as b,Ue as c,lt as d,at as e,ct as u};

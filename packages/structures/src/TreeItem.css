/*---------------------------------------------------------------------------------------------
 * Copyright (c) Bentley Systems, Incorporated. All rights reserved.
 * See LICENSE.md in the project root for license terms and full copyright notice.
 *--------------------------------------------------------------------------------------------*/
.ğŸ¥TreeItem {
	@layer base {
		position: relative;
		min-inline-size: max-content;
	}

	@layer states {
		&:focus-visible {
			outline: none !important;
			isolation: isolate;

			&::before {
				content: "";
				position: absolute;
				inset: 0;
				z-index: 1; /* Ensure the outline appears above the actions */
				pointer-events: none;
				outline: var(--ğŸ¥focus-outline);
				outline-offset: -1px;
			}
		}

		@media (any-hover: hover) {
			&:where(:not(:hover, :focus-visible, :has(:focus-visible), :has([data-has-popover-open]))) {
				/** Hide every action unless one of these conditions match. */
				--ğŸ¥TreeItem-action-visibility: hidden;
			}

			/* Without :has, we can't easily detect complex conditions, so unconditionally show actions. */
			@supports not selector(:has(+ *)) {
				--ğŸ¥TreeItem-action-visibility: visible;
			}
		}
	}
}

.ğŸ¥TreeItemNode:is(.ğŸ¥ListItem) {
	--âœ¨first-level-indent: var(--stratakit-space-x2);
	--âœ¨subsequent-level-indent: calc(var(--stratakit-space-x1) + var(--stratakit-space-x05));

	@layer base {
		position: relative;
		isolation: isolate;

		padding-inline-start: calc(
			var(--âœ¨first-level-indent) +
			var(--âœ¨subsequent-level-indent) *
			(var(--ğŸ¥TreeItem-level) - 1)
		);
		padding-inline-end: 0;

		--ğŸ¥ListItem-color: var(--ğŸ¥TreeItem-color);
	}

	@layer modifiers {
		&:where([data-_sk-error="true"]) {
			--ğŸ¥Icon-color: var(--stratakit-color-icon-attention-base);
			--ğŸ¥TreeItem-color: var(--stratakit-color-text-attention-base);
		}
	}

	@layer states {
		&:where([data-_sk-selected="true"]) {
			--ğŸŒ€ListItem-state: var(--ğŸŒ€ListItem-state--active);
		}

		@media (any-hover: hover) {
			&:where(:hover[data-_sk-selected="true"]) {
				--ğŸŒ€ListItem-state: var(--ğŸŒ€ListItem-state--active-hover);
			}
		}

		&:where([data-_sk-expanded="false"]) {
			--ğŸ¥ChevronDown-rotate: -0.25turn;
		}

		&:where(:not([data-_sk-expanded])) {
			--ğŸ¥TreeItem-expander-visibility: hidden;
		}
	}
}

.ğŸ¥TreeItemContent:is(.ğŸ¥ListItemContent) {
	@layer base {
		white-space: nowrap;
	}
}

.ğŸ¥TreeItemDescription:is(.ğŸ¥ListItemContent) {
	@layer base {
		color: var(
			--ğŸ¥TreeItem-color,
			var(--ğŸŒ€ListItem-state--default, var(--stratakit-color-text-neutral-secondary))
		);
	}
}

.ğŸ¥TreeItemActionsContainer:is(.ğŸ¥ListItemDecoration) {
	@layer base {
		align-self: stretch;
		position: sticky;
		inset-inline-end: 0;
		padding-inline-end: var(--stratakit-space-x1);
		background-color: var(--stratakit-color-bg-page-base);
		display: inline-flex;
		/** If actions are made visible (by a parent), the actions container should also become visible. */
		visibility: var(--ğŸ¥TreeItem-actions-container-visibility, var(--ğŸ¥TreeItem-action-visibility));

		&::before {
			position: absolute;
			content: "";
			inset: 0;
			background-color: var(--ğŸ¥ListItem-background-color);
			z-index: -1;
		}
	}

	@layer modifiers {
		/* Actions container should be additionally made visible when any individual action is forcibly visible. */
		&:where(:has(.ğŸ¥TreeItemAction[data-_sk-visible="true"])) {
			--ğŸ¥TreeItem-actions-container-visibility: visible;
		}
	}
}

.ğŸ¥TreeItemAction:is(.ğŸ¥IconButton) {
	@layer base {
		visibility: var(--ğŸ¥TreeItem-action-visibility);
		transition: visibility 16ms; /* This allows some time focus to "settle" before determining final visibility. */
	}

	@layer modifiers {
		&:where([data-_sk-visible="false"]) {
			--ğŸ¥TreeItem-action-visibility: hidden;
		}

		&:where([data-_sk-visible="true"]) {
			--ğŸ¥TreeItem-action-visibility: visible;
		}
	}
}

.ğŸ¥TreeItemExpander:is(.ğŸ¥IconButton) {
	@layer base {
		visibility: var(--ğŸ¥TreeItem-expander-visibility);
		z-index: 1; /* Ensure the expander is above the invisible content button */
	}
}

.ğŸ¥TreeItemDecoration {
	@layer base {
		display: flex;
		align-items: center;
		gap: var(--stratakit-space-x1);
	}
}

@media (forced-colors: active) {
	.ğŸ¥TreeItemNode:is(.ğŸ¥ListItem) {
		--ğŸ¥ListItem-background-color: Canvas;
		--ğŸ¥TreeItem-color: CanvasText;

		&:where([data-_sk-error="true"], [data-_sk-selected="true"]) {
			forced-color-adjust: none;
		}

		&:where([data-_sk-error="true"]) {
			.ğŸ¥TreeItemContent,
			.ğŸ¥TreeItemDecoration {
				background-color: Mark;
				color: MarkText;
			}
		}

		&:where([data-_sk-selected="true"]) {
			--ğŸ¥ListItem-background-color: SelectedItem;
			--ğŸ¥TreeItem-color: SelectedItemText;
		}
	}
}

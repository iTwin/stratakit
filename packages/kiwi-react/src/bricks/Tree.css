/*---------------------------------------------------------------------------------------------
 * Copyright (c) Bentley Systems, Incorporated. All rights reserved.
 * See LICENSE.md in the project root for license terms and full copyright notice.
 *--------------------------------------------------------------------------------------------*/
.ğŸ¥-tree {
	@layer base {
		display: grid;
		overflow: auto;
		background-color: var(--kiwi-color-bg-surface-primary);
	}
}

.ğŸ¥-tree-item {
	@layer base {
		position: relative;
		min-inline-size: max-content;
	}

	@layer states {
		&:focus-visible {
			outline: none;
			isolation: isolate;

			&::before {
				content: "";
				position: absolute;
				inset: 0;
				z-index: 1; /* Ensure the outline appears above the actions */
				pointer-events: none;
				outline: 2px solid var(--kiwi-color-border-accent-strong);
				outline-offset: -1px;
			}
		}

		@media (any-hover: hover) {
			&:where(:not(:hover, :focus-within)) {
				--ğŸ¥tree-item-action-visibility: hidden;
			}
		}
	}
}

.ğŸ¥-tree-item-node:is(.ğŸ¥-list-item) {
	--âœ¨first-level-indent: 8px;
	--âœ¨subsequent-level-indent: 6px;

	@layer base {
		position: relative;
		isolation: isolate;

		display: grid;
		grid-template-areas: "expander icon label actions";
		grid-template-rows: auto;
		grid-template-columns: auto auto 1fr auto;

		padding-inline-start: calc(
			var(--âœ¨first-level-indent) +
			var(--âœ¨subsequent-level-indent) *
			(var(--ğŸ¥tree-item-level) - 1)
		);
		padding-inline-end: 0;
	}

	@layer states {
		&:where([data-kiwi-sublabel="true"]) {
			grid-template-areas:
				"expander icon label actions"
				". . sublabel actions";
			grid-template-rows: auto auto;
			row-gap: 0;

			min-block-size: 2.75rem;
		}

		&:where([data-kiwi-selected="true"]) {
			--ğŸŒ€list-item-state: var(--ğŸŒ€list-item-state--active);
		}

		&:where([data-kiwi-expanded="false"]) {
			--ğŸ¥tree-chevron-rotate: -0.25turn;
		}

		&:where(:not([data-kiwi-expanded])) {
			--ğŸ¥tree-item-expander-visibility: hidden;
		}
	}
}

.ğŸ¥-tree-item-content:is(.ğŸ¥-list-item-content) {
	@layer base {
		@apply --typography("body-sm");

		grid-area: label;
		white-space: nowrap;
	}
}

.ğŸ¥-tree-item-actions {
	@layer base {
		grid-area: actions;
		height: 100%;

		position: sticky;
		inset-inline-end: 0;
		padding-inline-end: 4px;
		background-color: var(--kiwi-color-bg-surface-primary);
		display: inline-flex;
		align-items: center;
		visibility: var(--ğŸ¥tree-item-actions-visibility, var(--ğŸ¥tree-item-action-visibility));

		&::before {
			position: absolute;
			content: "";
			inset: 0;
			background-color: var(--ğŸ¥list-item-background-color);
			z-index: -1;
		}
	}

	@layer modifiers {
		&:where(:has(.ğŸ¥-tree-item-action[data-kiwi-visible="true"])) {
			--ğŸ¥tree-item-actions-visibility: visible;
		}

		/* Without :has, we can't easily detect if there are any forcibily-visible actions, so unconditionally show this. */
		@supports not selector(:has(+ *)) {
			--ğŸ¥tree-item-actions-visibility: visible;
		}
	}
}

.ğŸ¥-tree-item-action:is(.ğŸ¥-icon-button) {
	@layer base {
		visibility: var(--ğŸ¥tree-item-action-visibility);
	}

	@layer modifiers {
		&:where([data-kiwi-visible="false"]) {
			--ğŸ¥tree-item-action-visibility: hidden;
		}

		&:where([data-kiwi-visible="true"]) {
			--ğŸ¥tree-item-action-visibility: visible;
		}
	}
}

.ğŸ¥-tree-item-expander:is(.ğŸ¥-icon-button) {
	@layer base {
		grid-area: expander;

		visibility: var(--ğŸ¥tree-item-expander-visibility);
		z-index: 1; /* Ensure the expander is above the invisible content button */
	}
}

.ğŸ¥-tree-chevron {
	@layer base {
		rotate: var(--ğŸ¥tree-chevron-rotate);

		@media (prefers-reduced-motion: no-preference) {
			transition: rotate 150ms ease-in-out;
		}
	}
}

.ğŸ¥-tree-item-sublabel {
	@layer base {
		grid-area: sublabel;
		color: var(--ğŸŒ€list-item-state--default, var(--kiwi-color-text-neutral-secondary));
	}
}

.ğŸ¥-tree-item-icon {
	@layer base {
		grid-area: icon;

		display: inline-flex;
		align-items: center;
	}
}

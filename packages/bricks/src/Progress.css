/*---------------------------------------------------------------------------------------------
 * Copyright (c) Bentley Systems, Incorporated. All rights reserved.
 * See LICENSE.md in the project root for license terms and full copyright notice.
 *--------------------------------------------------------------------------------------------*/

.ProgressBar {
	--牢ount: 4;
	--牡uration: 1.5s;
	--牠asing: cubic-bezier(0.5, 0, 0.5, 1);
	--究teps: 4;

	--災nimation--indeterminate-steps: calc(var(--究teps) * var(--牡uration) * 2)
		--ProgressBar-animation-indeterminate steps(var(--究teps), end) infinite;
	--災nimation--indeterminate: var(--牡uration) --ProgressBar-animation-indeterminate
		var(--牠asing) var(--牢ount);
	--災nimation--indeterminate-slow: calc(var(--牡uration) * 2)
		--ProgressBar-animation-indeterminate-slow var(--牠asing)
		calc(var(--牢ount) * var(--牡uration)) infinite;

	@layer base {
		block-size: var(--ProgressBar-size);
		inline-size: 100%;
		border-radius: 9999px;
		contain: strict;
		display: grid;
		background-color: var(--ProgressBar-track-color);

		&::before {
			content: "";
			block-size: inherit;
			inline-size: var(--ProgressBar-fill-size);
			transform: translateX(calc(-100% + var(--ProgressBar-fill-portion-shown)));
			border-radius: inherit;
			background-color: var(--ProgressBar-fill-color);
			animation: var(--ProgressBar-animation);
		}

		&:where([data-_sk-variant="determinate"])::before {
			@media (prefers-reduced-motion: no-preference) {
				transition: transform 150ms ease-in-out;
			}
		}
	}

	@layer modifiers {
		&:where([data-_sk-tone="neutral"]) {
			--ProgressBar-fill-color: var(--stratakit-color-icon-neutral-base);
			--ProgressBar-track-color: var(--stratakit-color-border-page-base);
		}

		&:where([data-_sk-tone="accent"]) {
			--ProgressBar-fill-color: var(--stratakit-color-icon-accent-strong);
			--ProgressBar-track-color: var(--stratakit-color-bg-accent-muted);
		}

		&:where([data-_sk-size="medium"]) {
			--ProgressBar-size: 0.125rem;
		}

		&:where([data-_sk-size="large"]) {
			--ProgressBar-size: 0.25rem;
		}

		&:where([data-_sk-variant="indeterminate"]) {
			--ProgressBar-animation: var(--災nimation--indeterminate-steps);
			--ProgressBar-fill-size: 25%;
			--ProgressBar-fill-start-point: 0%; /* 0% keeps the fill in view. */

			@media (prefers-reduced-motion: no-preference) {
				--ProgressBar-animation:
					var(--災nimation--indeterminate), var(--災nimation--indeterminate-slow);
				--ProgressBar-fill-start-point: -100%; /* -100% moves the fill out of view on the left side. */
			}
		}

		&:where([data-_sk-variant="determinate"]) {
			--ProgressBar-fill-size: 100%;
		}
	}
}

@keyframes --ProgressBar-animation-indeterminate {
	from {
		transform: translateX(var(--ProgressBar-fill-start-point));
	}

	to {
		transform: translateX(
			400%
		); /* The fill is 25% width of the container, multiplied by 4 moves the fill out of view on the right side. */
	}
}

@keyframes --ProgressBar-animation-indeterminate-slow {
	0% {
		transform: translateX(-100%); /* -100% moves the fill out of view on the left side. */
	}
	50% {
		transform: translateX(
			-95%
		); /* Simulate a short slowdown between each cycle to help with WCAG SC 2.2.2. */
	}
	100% {
		transform: translateX(
			400%
		); /* The fill is 25% width of the container, multiplied by 4 moves the fill out of view on the right side. */
	}
}

@media (forced-colors: active) {
	.ProgressBar {
		--ProgressBar-fill-color: CanvasText;
		--ProgressBar-track-color: Canvas;
		outline: 1px solid;
		outline-color: oklch(from CanvasText l c h / 50%);
		forced-color-adjust: none;
	}
}

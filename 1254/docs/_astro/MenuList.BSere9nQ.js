import{r as f}from"./index.DIfZGIpv.js";import{E as H,F as j,C as T,j as A,G as P}from"./~utils.MbFyw0cp.js";import{g as z}from"./getScrollbarSize.CaCM53D3.js";import{L as O}from"./List.B3PCCPgg.js";import{a as W}from"./getActiveElement.BQgAPKnO.js";function E(s,t,r){return s===t?s.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r?null:s.firstChild}function M(s,t,r){return s===t?r?s.firstChild:s.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r?null:s.lastChild}function D(s,t){if(t===void 0)return!0;let r=s.innerText;return r===void 0&&(r=s.textContent),r=r.trim().toLowerCase(),r.length===0?!1:t.repeating?r[0]===t.keys[0]:r.startsWith(t.keys.join(""))}function m(s,t,r,b,d,w){let c=!1,u=d(s,t,t?r:!1);for(;u;){if(u===s.firstChild){if(c)return!1;c=!0}const p=b?!1:u.disabled||u.getAttribute("aria-disabled")==="true";if(!u.hasAttribute("tabindex")||!D(u,w)||p)u=d(s,u,r);else return u.focus(),!0}return!1}const q=f.forwardRef(function(t,r){const{actions:b,autoFocus:d=!1,autoFocusItem:w=!1,children:c,className:u,disabledItemsFocusable:p=!1,disableListWrap:g=!1,onKeyDown:y,variant:k="selectedMenu",...S}=t,a=f.useRef(null),I=f.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});H(()=>{d&&a.current.focus()},[d]),f.useImperativeHandle(b,()=>({adjustStyleForScrollbar:(e,{direction:n})=>{const l=!a.current.style.width;if(e.clientHeight<a.current.clientHeight&&l){const x=`${z(j(e))}px`;a.current.style[n==="rtl"?"paddingLeft":"paddingRight"]=x,a.current.style.width=`calc(100% + ${x})`}return a.current}}),[]);const v=e=>{const n=a.current,l=e.key;if(e.ctrlKey||e.metaKey||e.altKey){y&&y(e);return}const h=W(P(n));if(l==="ArrowDown")e.preventDefault(),m(n,h,g,p,E);else if(l==="ArrowUp")e.preventDefault(),m(n,h,g,p,M);else if(l==="Home")e.preventDefault(),m(n,null,g,p,E);else if(l==="End")e.preventDefault(),m(n,null,g,p,M);else if(l.length===1){const i=I.current,C=l.toLowerCase(),K=performance.now();i.keys.length>0&&(K-i.lastTime>500?(i.keys=[],i.repeating=!0,i.previousKeyMatched=!0):i.repeating&&C!==i.keys[0]&&(i.repeating=!1)),i.lastTime=K,i.keys.push(C);const L=h&&!i.repeating&&D(h,i);i.previousKeyMatched&&(L||m(n,h,!1,p,E,i))?e.preventDefault():i.previousKeyMatched=!1}y&&y(e)},F=T(a,r);let o=-1;f.Children.forEach(c,(e,n)=>{if(!f.isValidElement(e)){o===n&&(o+=1,o>=c.length&&(o=-1));return}e.props.disabled||(k==="selectedMenu"&&e.props.selected||o===-1)&&(o=n),o===n&&(e.props.disabled||e.props.muiSkipListHighlight||e.type.muiSkipListHighlight)&&(o+=1,o>=c.length&&(o=-1))});const R=f.Children.map(c,(e,n)=>{if(n===o){const l={};return w&&(l.autoFocus=!0),e.props.tabIndex===void 0&&k==="selectedMenu"&&(l.tabIndex=0),f.cloneElement(e,l)}return e});return A.jsx(O,{role:"menu",ref:F,className:u,onKeyDown:v,tabIndex:d?0:-1,...S,children:R})});export{q as M};

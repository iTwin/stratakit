import{t as F,c as x,s as v,i as O,e as C,u as w,a as y}from"./YV4JVR4I-DzguEf2c.js";import{d as h,_ as E,b as g,Q as M,s as q,m as D,u as V}from"./LMDWO4NN-DUubhdkr.js";function k(t){var l;const s=t.find(f=>!!f.element),u=[...t].reverse().find(f=>!!f.element);let r=(l=s==null?void 0:s.element)==null?void 0:l.parentElement;for(;r&&(u!=null&&u.element);){if(u&&r.contains(u.element))return r;r=r.parentElement}return D(r).body}function B(t){return t==null?void 0:t.__unstablePrivateStore}function Q(t={}){var l;F(t,t.store);const s=(l=t.store)==null?void 0:l.getState(),u=h(t.items,s==null?void 0:s.items,t.defaultItems,[]),r=new Map(u.map(e=>[e.id,e])),f={items:u,renderedItems:h(s==null?void 0:s.renderedItems,[])},A=B(t.store),a=x({items:u,renderedItems:f.renderedItems},A),S=x(f,t.store),_=e=>{const n=q(e,c=>c.element);a.setState("renderedItems",n),S.setState("renderedItems",n)};v(S,()=>O(a)),v(a,()=>C(a,["items"],e=>{S.setState("items",e.items)})),v(a,()=>C(a,["renderedItems"],e=>{let n=!0,c=requestAnimationFrame(()=>{const{renderedItems:i}=S.getState();e.renderedItems!==i&&_(e.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(c);const d=()=>{if(n){n=!1;return}cancelAnimationFrame(c),c=requestAnimationFrame(()=>_(e.renderedItems))},p=k(e.renderedItems),o=new IntersectionObserver(d,{root:p});for(const i of e.renderedItems)i.element&&o.observe(i.element);return()=>{cancelAnimationFrame(c),o.disconnect()}}));const b=(e,n,c=!1)=>{let d;return n(o=>{const i=o.findIndex(({id:m})=>m===e.id),I=o.slice();if(i!==-1){d=o[i];const m=g(g({},d),e);I[i]=m,r.set(e.id,m)}else I.push(e),r.set(e.id,e);return I}),()=>{n(o=>{if(!d)return c&&r.delete(e.id),o.filter(({id:m})=>m!==e.id);const i=o.findIndex(({id:m})=>m===e.id);if(i===-1)return o;const I=o.slice();return I[i]=d,r.set(e.id,d),I})}},P=e=>b(e,n=>a.setState("items",n),!0);return E(g({},S),{registerItem:P,renderItem:e=>M(P(e),b(e,n=>a.setState("renderedItems",n))),item:e=>{if(!e)return null;let n=r.get(e);if(!n){const{items:c}=a.getState();n=c.find(d=>d.id===e),n&&r.set(e,n)}return n||null},__unstablePrivateStore:a})}function R(t,l,s){return V(l,[s.store]),y(t,s,"items","setItems"),t}function z(t={}){const[l,s]=w(Q,t);return R(l,s,t)}export{R as a,Q as c,z as u};

import{d as ae,g as A,s as ue,i as q,a as X,e as oe,h as se,C as le}from"./WZWDIE3S-CVozTwGK.js";import{ad as ce,a3 as de,z as fe,N as ve,O as me,Q as Ie,W as k,U as Se,J as ge,K as Ee}from"./~utils-BY8bYaps.js";import{r as xe,a1 as Ce,aB as ye,D as Q,aC as K,J as we,z as U,U as R,ah as he,Z as ee,O as Pe,A as be,aD as Fe,q as ke,t as Ae,ae as I,v as _e,o as Be}from"./sun-C9qkbvRf.js";import{a as b,p as Le}from"./chunk-EPOLDU6W-CvAF3MIU.js";import{c as De,e as Ke}from"./GVAFFF2B-BXzoA8ls.js";function te(t){const e=[];for(const n of t)e.push(...n);return e}function G(t){return t.slice().reverse()}var Re="div";function Te(t){return t.some(e=>!!e.rowId)}function pe(t){const e=t.target;return e&&!ee(e)?!1:t.key.length===1&&!t.ctrlKey&&!t.metaKey}function ze(t){return t.key==="Shift"||t.key==="Control"||t.key==="Alt"||t.key==="Meta"}function Y(t,e,n){return U(u=>{var s;if(e?.(u),u.defaultPrevented||u.isPropagationStopped()||!R(u)||ze(u)||pe(u))return;const a=t.getState(),o=(s=A(t,a.activeId))==null?void 0:s.element;if(!o)return;const{view:F,...r}=u,S=n?.current;o!==S&&o.focus(),Fe(o,u.type,r)||u.preventDefault(),u.currentTarget.contains(o)&&u.stopPropagation()})}function Me(t){return oe(te(G(se(t))))}function We(t){const[e,n]=b.useState(!1),u=b.useCallback(()=>n(!0),[]),s=t.useState(a=>A(t,a.activeId));return b.useEffect(()=>{const a=s?.element;e&&a&&(n(!1),a.focus({preventScroll:!0}))},[s,e]),u}var Ue=xe(function({store:e,composite:n=!0,focusOnMove:u=n,moveOnKeyPress:s=!0,...a}){const o=ae();e=e||o,Ce(e,!1);const F=b.useRef(null),r=b.useRef(null),S=We(e),g=e.useState("moves"),[,H]=ye(n?e.setBaseElement:null);b.useEffect(()=>{var i;if(!e||!g||!n||!u)return;const{activeId:l}=e.getState(),d=(i=A(e,l))==null?void 0:i.element;d&&ce(d)},[e,g,n,u]),Q(()=>{if(!e||!g||!n)return;const{baseElement:i,activeId:l}=e.getState();if(!(l===null)||!i)return;const f=r.current;r.current=null,f&&K(f,{relatedTarget:i}),de(i)||i.focus()},[e,g,n]);const E=e.useState("activeId"),_=e.useState("virtualFocus");Q(()=>{var i;if(!e||!n||!_)return;const l=r.current;if(r.current=null,!l)return;const f=((i=A(e,E))==null?void 0:i.element)||we(l);f!==l&&K(l,{relatedTarget:f})},[e,E,_,n]);const x=Y(e,a.onKeyDownCapture,r),O=Y(e,a.onKeyUpCapture,r),B=a.onFocusCapture,T=U(i=>{if(B?.(i),i.defaultPrevented||!e)return;const{virtualFocus:l}=e.getState();if(!l)return;const d=i.relatedTarget,f=ue(i.currentTarget);R(i)&&f&&(i.stopPropagation(),r.current=d)}),p=a.onFocus,N=U(i=>{if(p?.(i),i.defaultPrevented||!n||!e)return;const{relatedTarget:l}=i,{virtualFocus:d}=e.getState();d?R(i)&&!q(e,l)&&queueMicrotask(S):R(i)&&e.setActiveId(null)}),z=a.onBlurCapture,C=U(i=>{var l;if(z?.(i),i.defaultPrevented||!e)return;const{virtualFocus:d,activeId:f}=e.getState();if(!d)return;const y=(l=A(e,f))==null?void 0:l.element,h=i.relatedTarget,w=q(e,h),m=r.current;r.current=null,R(i)&&w?(h===y?m&&m!==h&&K(m,i):y?K(y,i):m&&K(m,i),i.stopPropagation()):!q(e,i.target)&&y&&K(y,i)}),M=a.onKeyDown,V=he(s),$=U(i=>{var l;if(M?.(i),i.nativeEvent.isComposing||i.defaultPrevented||!e||!R(i))return;const{orientation:d,renderedItems:f,activeId:y}=e.getState(),h=A(e,y);if((l=h?.element)!=null&&l.isConnected)return;const w=d!=="horizontal",m=d!=="vertical",c=Te(f);if((i.key==="ArrowLeft"||i.key==="ArrowRight"||i.key==="Home"||i.key==="End")&&ee(i.currentTarget))return;const J={ArrowUp:(c||w)&&(()=>{if(c){const W=Me(f);return W?.id}return e?.last()}),ArrowRight:(c||m)&&e.first,ArrowDown:(c||w)&&e.first,ArrowLeft:(c||m)&&e.last,Home:e.first,End:e.last,PageUp:e.first,PageDown:e.last}[i.key];if(J){const W=J();if(W!==void 0){if(!V(i))return;i.preventDefault(),e.move(W)}}});a=Pe(a,i=>Le.jsx(X,{value:e,children:i}),[e]),a={"aria-activedescendant":e.useState(i=>{var l;if(e&&n&&i.virtualFocus)return(l=A(e,i.activeId))==null?void 0:l.id}),...a,ref:be(F,H,a.ref),onKeyDownCapture:x,onKeyUpCapture:O,onFocusCapture:T,onFocus:N,onBlurCapture:C,onKeyDown:$};const L=e.useState(i=>n&&(i.virtualFocus||i.activeId===null));return a=fe({focusable:L,...a}),a}),nt=ke(function(e){const n=Ue(e);return Ae(Re,n)}),He={id:null};function P(t,e){return t.find(n=>e?!n.disabled&&n.id!==e:!n.disabled)}function Ne(t,e){return t.filter(n=>e?!n.disabled&&n.id!==e:!n.disabled)}function Z(t,e){return t.filter(n=>n.rowId===e)}function Oe(t,e,n=!1){const u=t.findIndex(s=>s.id===e);return[...t.slice(u+1),...n?[He]:[],...t.slice(0,u)]}function ne(t){const e=[];for(const n of t){const u=e.find(s=>{var a;return((a=s[0])==null?void 0:a.rowId)===n.rowId});u?u.push(n):e.push([n])}return e}function re(t){let e=0;for(const{length:n}of t)n>e&&(e=n);return e}function Ve(t){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:t}}function $e(t,e,n){const u=re(t);for(const s of t)for(let a=0;a<u;a+=1){const o=s[a];if(!o||n&&o.disabled){const r=a===0&&n?P(s):s[a-1];s[a]=r&&e!==r.id&&n?r:Ve(r?.rowId)}}return t}function je(t){const e=ne(t),n=re(e),u=[];for(let s=0;s<n;s+=1)for(const a of e){const o=a[s];o&&u.push({...o,rowId:o.rowId?`${s}`:void 0})}return u}function qe(t={}){var e;const n=(e=t.store)==null?void 0:e.getState(),u=De(t),s=I(t.activeId,n?.activeId,t.defaultActiveId),a={...u.getState(),id:I(t.id,n?.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:s,baseElement:I(n?.baseElement,null),includesBaseElement:I(t.includesBaseElement,n?.includesBaseElement,s===null),moves:I(n?.moves,0),orientation:I(t.orientation,n?.orientation,"both"),rtl:I(t.rtl,n?.rtl,!1),virtualFocus:I(t.virtualFocus,n?.virtualFocus,!1),focusLoop:I(t.focusLoop,n?.focusLoop,!1),focusWrap:I(t.focusWrap,n?.focusWrap,!1),focusShift:I(t.focusShift,n?.focusShift,!1)},o=ve(a,u,t.store);me(o,()=>Ie(o,["renderedItems","activeId"],r=>{o.setState("activeId",S=>{var g;return S!==void 0?S:(g=P(r.renderedItems))==null?void 0:g.id})}));const F=(r="next",S={})=>{var g,H;const E=o.getState(),{skip:_=0,activeId:x=E.activeId,focusShift:O=E.focusShift,focusLoop:B=E.focusLoop,focusWrap:T=E.focusWrap,includesBaseElement:p=E.includesBaseElement,renderedItems:N=E.renderedItems,rtl:z=E.rtl}=S,C=r==="up"||r==="down",M=r==="next"||r==="down",V=M?z&&!C:!z||C,$=O&&!_;let v=C?te($e(ne(N),x,$)):N;if(v=V?G(v):v,v=C?je(v):v,x==null)return(g=P(v))==null?void 0:g.id;const L=v.find(c=>c.id===x);if(!L)return(H=P(v))==null?void 0:H.id;const i=v.some(c=>c.rowId),l=v.indexOf(L),d=v.slice(l+1),f=Z(d,L.rowId);if(_){const c=Ne(f,x),D=c.slice(_)[0]||c[c.length-1];return D?.id}const y=B&&(C?B!=="horizontal":B!=="vertical"),h=i&&T&&(C?T!=="horizontal":T!=="vertical"),w=M?(!i||C)&&y&&p:C?p:!1;if(y){const c=h&&!w?v:Z(v,L.rowId),D=Oe(c,x,w),j=P(D,x);return j?.id}if(h){const c=P(w?f:d,x);return w?c?.id||null:c?.id}const m=P(f,x);return!m&&w?null:m?.id};return{...u,...o,setBaseElement:r=>o.setState("baseElement",r),setActiveId:r=>o.setState("activeId",r),move:r=>{r!==void 0&&(o.setState("activeId",r),o.setState("moves",S=>S+1))},first:()=>{var r;return(r=P(o.getState().renderedItems))==null?void 0:r.id},last:()=>{var r;return(r=P(G(o.getState().renderedItems)))==null?void 0:r.id},next:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),F("next",r)),previous:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),F("previous",r)),down:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),F("down",r)),up:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),F("up",r))}}function Ge(t){return{id:_e(t.id),...t}}function Je(t,e,n){return t=Ke(t,e,n),k(t,n,"activeId","setActiveId"),k(t,n,"includesBaseElement"),k(t,n,"virtualFocus"),k(t,n,"orientation"),k(t,n,"rtl"),k(t,n,"focusLoop"),k(t,n,"focusWrap"),k(t,n,"focusShift"),t}function rt(t={}){t=Ge(t);const[e,n]=Se(qe,t);return Je(e,n,t)}b.createContext(void 0);var ie=Be([Ee,X],[ge,le]),it=ie.useContext,at=ie.useProviderContext;b.createContext(void 0);b.createContext(!1);export{nt as C,Ue as a,it as b,qe as c,Je as d,at as e,rt as u};

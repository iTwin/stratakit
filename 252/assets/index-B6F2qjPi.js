import{w as j}from"./~utils-ChHMGsjo.js";import{a as m,n as c}from"./chunk-K6AXKMTT-BHCV6zel.js";import{d as R}from"./~utils-Dr6CrNqc.js";import{a as _}from"./index-B0znaqTz.js";import{I as k}from"./Icon-Bc7nfctV.js";import{I as M}from"./IconButton-DgH2I0mn.js";import{T,a as A,b as D,c as F,d as P}from"./Tree-QHv75h3Z.js";import{p as W}from"./placeholder-B6KDXZIl.js";import{u as $}from"./lock-unlocked-Cpw6t3T2.js";import{s as B}from"./visibility-show-BetXSY-0.js";import"./index-DeGJKKUv.js";import"./XL7CSKGW-DWaBDxUb.js";import"./Button-DInBeQfG.js";import"./KUU7WJ55-BzS6MnHA.js";import"./LVA2YJMS-BjFMiyma.js";import"./VisuallyHidden-BP9HqvzW.js";import"./Tooltip-CxwinZ33.js";import"./BYC7LY2E-DBPNoNeE.js";import"./YV4JVR4I-I4X5ERHE.js";import"./VGCJ63VH-B3pkzvNN.js";import"./MTZPJQMC-JL08V7FT.js";import"./P2CTZE2T-DAWgHJTO.js";import"./ListItem-KFIqU5yd.js";import"./ITI7HKP4-CHaTCS48.js";function S(i,l,e){let s=e.initialDeps??[],t;return()=>{var n,o,r,a;let d;e.key&&((n=e.debug)!=null&&n.call(e))&&(d=Date.now());const h=i();if(!(h.length!==s.length||h.some((p,u)=>s[u]!==p)))return t;s=h;let f;if(e.key&&((o=e.debug)!=null&&o.call(e))&&(f=Date.now()),t=l(...h),e.key&&((r=e.debug)!=null&&r.call(e))){const p=Math.round((Date.now()-d)*100)/100,u=Math.round((Date.now()-f)*100)/100,v=u/16,I=(g,E)=>{for(g=String(g);g.length<E;)g=" "+g;return g};console.info(`%câ± ${I(u,5)} /${I(p,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*v,120))}deg 100% 31%);`,e==null?void 0:e.key)}return(a=e==null?void 0:e.onChange)==null||a.call(e,t),t}}function w(i,l){if(i===void 0)throw new Error("Unexpected undefined");return i}const V=(i,l)=>Math.abs(i-l)<1,L=(i,l,e)=>{let s;return function(...t){i.clearTimeout(s),s=i.setTimeout(()=>l.apply(this,t),e)}},N=i=>i,U=i=>{const l=Math.max(i.startIndex-i.overscan,0),e=Math.min(i.endIndex+i.overscan,i.count-1),s=[];for(let t=l;t<=e;t++)s.push(t);return s},K=(i,l)=>{const e=i.scrollElement;if(!e)return;const s=i.targetWindow;if(!s)return;const t=o=>{const{width:r,height:a}=o;l({width:Math.round(r),height:Math.round(a)})};if(t(e.getBoundingClientRect()),!s.ResizeObserver)return()=>{};const n=new s.ResizeObserver(o=>{const r=o[0];if(r!=null&&r.borderBoxSize){const a=r.borderBoxSize[0];if(a){t({width:a.inlineSize,height:a.blockSize});return}}t(e.getBoundingClientRect())});return n.observe(e,{box:"border-box"}),()=>{n.unobserve(e)}},z={passive:!0},H=typeof window>"u"?!0:"onscrollend"in window,q=(i,l)=>{const e=i.scrollElement;if(!e)return;const s=i.targetWindow;if(!s)return;let t=0;const n=i.options.useScrollendEvent&&H?()=>{}:L(s,()=>{l(t,!1)},i.options.isScrollingResetDelay),o=d=>()=>{const{horizontal:h,isRtl:x}=i.options;t=h?e.scrollLeft*(x&&-1||1):e.scrollTop,n(),l(t,d)},r=o(!0),a=o(!1);return a(),e.addEventListener("scroll",r,z),e.addEventListener("scrollend",a,z),()=>{e.removeEventListener("scroll",r),e.removeEventListener("scrollend",a)}},Y=(i,l,e)=>{if(l!=null&&l.borderBoxSize){const s=l.borderBoxSize[0];if(s)return Math.round(s[e.options.horizontal?"inlineSize":"blockSize"])}return Math.round(i.getBoundingClientRect()[e.options.horizontal?"width":"height"])},G=(i,{adjustments:l=0,behavior:e},s)=>{var t,n;const o=i+l;(n=(t=s.scrollElement)==null?void 0:t.scrollTo)==null||n.call(t,{[s.options.horizontal?"left":"top"]:o,behavior:e})};class J{constructor(l){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const s=()=>e||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:e=new this.targetWindow.ResizeObserver(t=>{t.forEach(n=>{this._measureElement(n.target,n)})}));return{disconnect:()=>{var t;(t=s())==null||t.disconnect(),e=null},observe:t=>{var n;return(n=s())==null?void 0:n.observe(t,{box:"border-box"})},unobserve:t=>{var n;return(n=s())==null?void 0:n.unobserve(t)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([s,t])=>{typeof t>"u"&&delete e[s]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:N,rangeExtractor:U,onChange:()=>{},measureElement:Y,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!0,...e}},this.notify=e=>{var s,t;(t=(s=this.options).onChange)==null||t.call(s,this,e)},this.maybeNotify=S(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const s=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==s){if(this.cleanup(),!s){this.maybeNotify();return}this.scrollElement=s,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((e=this.scrollElement)==null?void 0:e.window)??null,this.elementsCache.forEach(t=>{this.observer.observe(t)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,t=>{this.scrollRect=t,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(t,n)=>{this.scrollAdjustments=0,this.scrollDirection=n?this.getScrollOffset()<t?"forward":"backward":null,this.scrollOffset=t,this.isScrolling=n,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,s)=>{const t=new Map,n=new Map;for(let o=s-1;o>=0;o--){const r=e[o];if(t.has(r.lane))continue;const a=n.get(r.lane);if(a==null||r.end>a.end?n.set(r.lane,r):r.end<a.end&&t.set(r.lane,!0),t.size===this.options.lanes)break}return n.size===this.options.lanes?Array.from(n.values()).sort((o,r)=>o.end===r.end?o.index-r.index:o.end-r.end)[0]:void 0},this.getMeasurementOptions=S(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(e,s,t,n,o)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:s,scrollMargin:t,getItemKey:n,enabled:o}),{key:!1}),this.getMeasurements=S(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:s,scrollMargin:t,getItemKey:n,enabled:o},r)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(h=>{this.itemSizeCache.set(h.key,h.size)}));const a=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const d=this.measurementsCache.slice(0,a);for(let h=a;h<e;h++){const x=n(h),f=this.options.lanes===1?d[h-1]:this.getFurthestMeasurement(d,h),p=f?f.end+this.options.gap:s+t,u=r.get(x),v=typeof u=="number"?u:this.options.estimateSize(h),I=p+v,g=f?f.lane:h%this.options.lanes;d[h]={index:h,start:p,size:v,end:I,key:x,lane:g}}return this.measurementsCache=d,d},{key:!1,debug:()=>this.options.debug}),this.calculateRange=S(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset()],(e,s,t)=>this.range=e.length>0&&s>0?Q({measurements:e,outerSize:s,scrollOffset:t}):null,{key:!1,debug:()=>this.options.debug}),this.getIndexes=S(()=>[this.options.rangeExtractor,this.calculateRange(),this.options.overscan,this.options.count],(e,s,t,n)=>s===null?[]:e({startIndex:s.startIndex,endIndex:s.endIndex,overscan:t,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const s=this.options.indexAttribute,t=e.getAttribute(s);return t?parseInt(t,10):(console.warn(`Missing attribute name '${s}={index}' on measured element.`),-1)},this._measureElement=(e,s)=>{const t=this.indexFromElement(e),n=this.measurementsCache[t];if(!n)return;const o=n.key,r=this.elementsCache.get(o);r!==e&&(r&&this.observer.unobserve(r),this.observer.observe(e),this.elementsCache.set(o,e)),e.isConnected&&this.resizeItem(t,this.options.measureElement(e,s,this))},this.resizeItem=(e,s)=>{const t=this.measurementsCache[e];if(!t)return;const n=this.itemSizeCache.get(t.key)??t.size,o=s-n;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(t,o,this):t.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(t.index),this.itemSizeCache=new Map(this.itemSizeCache.set(t.key,s)),this.notify(!1))},this.measureElement=e=>{if(!e){this.elementsCache.forEach((s,t)=>{s.isConnected||(this.observer.unobserve(s),this.elementsCache.delete(t))});return}this._measureElement(e,void 0)},this.getVirtualItems=S(()=>[this.getIndexes(),this.getMeasurements()],(e,s)=>{const t=[];for(let n=0,o=e.length;n<o;n++){const r=e[n],a=s[r];t.push(a)}return t},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const s=this.getMeasurements();if(s.length!==0)return w(s[O(0,s.length-1,t=>w(s[t]).start,e)])},this.getOffsetForAlignment=(e,s)=>{const t=this.getSize(),n=this.getScrollOffset();s==="auto"&&e>=n+t&&(s="end"),s==="end"&&(e-=t);const o=this.options.horizontal?"scrollWidth":"scrollHeight",a=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[o]:this.scrollElement[o]:0)-t;return Math.max(Math.min(a,e),0)},this.getOffsetForIndex=(e,s="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const t=this.measurementsCache[e];if(!t)return;const n=this.getSize(),o=this.getScrollOffset();if(s==="auto")if(t.end>=o+n-this.options.scrollPaddingEnd)s="end";else if(t.start<=o+this.options.scrollPaddingStart)s="start";else return[o,s];const r=t.start-this.options.scrollPaddingStart+(t.size-n)/2;switch(s){case"center":return[this.getOffsetForAlignment(r,s),s];case"end":return[this.getOffsetForAlignment(t.end+this.options.scrollPaddingEnd,s),s];default:return[this.getOffsetForAlignment(t.start-this.options.scrollPaddingStart,s),s]}},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(e,{align:s="start",behavior:t}={})=>{this.cancelScrollToIndex(),t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,s),{adjustments:void 0,behavior:t})},this.scrollToIndex=(e,{align:s="auto",behavior:t}={})=>{e=Math.max(0,Math.min(e,this.options.count-1)),this.cancelScrollToIndex(),t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const n=this.getOffsetForIndex(e,s);if(!n)return;const[o,r]=n;this._scrollToOffset(o,{adjustments:void 0,behavior:t}),t!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(e))){const[d]=w(this.getOffsetForIndex(e,r));V(d,this.getScrollOffset())||this.scrollToIndex(e,{align:r,behavior:t})}else this.scrollToIndex(e,{align:r,behavior:t})}))},this.scrollBy=(e,{behavior:s}={})=>{this.cancelScrollToIndex(),s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:s})},this.getTotalSize=()=>{var e;const s=this.getMeasurements();let t;return s.length===0?t=this.options.paddingStart:t=this.options.lanes===1?((e=s[s.length-1])==null?void 0:e.end)??0:Math.max(...s.slice(-this.options.lanes).map(n=>n.end)),Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:s,behavior:t})=>{this.options.scrollToFn(e,{behavior:t,adjustments:s},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(l)}}const O=(i,l,e,s)=>{for(;i<=l;){const t=(i+l)/2|0,n=e(t);if(n<s)i=t+1;else if(n>s)l=t-1;else return t}return i>0?i-1:0};function Q({measurements:i,outerSize:l,scrollOffset:e}){const s=i.length-1,n=O(0,s,r=>i[r].start,e);let o=n;for(;o<s&&i[o].end<e+l;)o++;return{startIndex:n,endIndex:o}}const y=typeof document<"u"?m.useLayoutEffect:m.useEffect;function X(i){const l=m.useReducer(()=>({}),{})[1],e={...i,onChange:(t,n)=>{var o;n?_.flushSync(l):l(),(o=i.onChange)==null||o.call(i,t,n)}},[s]=m.useState(()=>new J(e));return s.setOptions(e),y(()=>s._didMount(),[]),y(()=>s._willUpdate()),s}function Z(i){return X({observeElementRect:K,observeElementOffset:q,scrollToFn:G,...i})}const Ce={title:"Tree"},je=j(R(function({overflow:l=!1,selected:e=!1,visibleActions:s=void 0}){const t=s,n=l?" with a super long label that is overflown":"";return c.jsxs(T,{style:{maxInlineSize:l?300:void 0},children:[c.jsxs(b,{label:`Item 1${n}`,selected:!!e,children:[c.jsx(b,{label:"Item 1.1",selected:!!e}),c.jsx(b,{label:"Item 1.2",visibleActions:t,selected:!!e}),c.jsx(b,{label:`Item 1.3${n}`,visibleActions:t,selected:!!e})]}),c.jsx(b,{label:"Item 2",children:c.jsx(b,{label:`Item 2.1${n}`})}),c.jsx(b,{label:"Item 3",visibleActions:t})]})},{virtual:ne}));function b(i){const l=m.Children.count(i.children)>0;return c.jsx(A,{expanded:i.expanded!==void 0?i.expanded:l||void 0,level:i.level,selected:i.selected,style:i.style,content:c.jsxs(c.Fragment,{children:[c.jsx(D,{onClick:i.onExpanded}),c.jsx(k,{href:W}),c.jsx(F,{children:i.label}),c.jsxs(P,{visible:i.visibleActions,children:[c.jsx(M,{icon:$,label:"Unlock",variant:"ghost",style:{position:"relative"}}),c.jsx(M,{icon:B,label:"Show",variant:"ghost",style:{position:"relative"}})]})]}),children:i.children})}function ee(){return m.useMemo(()=>{function i(l,e,s){const t=[];for(let n=0;n<l;n++){const o=s?`${s}-${n}`:`${n}`,r=i(e,e-1,o);t.push({id:o,label:`Item ${o}`,items:r})}return t}return i(10,5)},[])}function te(i){const[l,e]=m.useState(new Set),s=m.useCallback(n=>{e(o=>{const r=new Set(o);return!o.has(n)?r.add(n):r.delete(n),r})},[]);return{tree:m.useMemo(()=>{function n(o){const r=[];for(const a of o){const d=l.has(a.id)?[]:n(a.items);r.push({...a,items:d})}return r}return n(i)},[i,l]),toggleExpanded:s,collapsedItems:l}}function se(i){return m.useMemo(()=>{function l(e,s=0){const t=[];for(const n of e)t.push({id:n.id,data:n,level:s}),t.push(...l(n.items,s+1));return t}return l(i)},[i])}function ne(){const i=ee(),{tree:l,toggleExpanded:e,collapsedItems:s}=te(i),t=se(l),n=m.useRef(null),o=Z({count:t.length,getScrollElement:()=>n.current,estimateSize:()=>24}),r=o.getVirtualItems(),a=m.useMemo(()=>{const d=new Set,h=r.map(f=>t[f.index].data);function x(f){const p=[];for(const u of f){const v=r.find(E=>t[E.index].id===u.id);if(!v||d.has(u.id))continue;d.add(u.id);const I=x(u.items),g=t[v.index];p.push({...u,items:I,virtual:v,flat:g})}return p}return x(h)},[r,t]);return c.jsx(c.Fragment,{children:c.jsx("div",{ref:n,style:{height:400,overflow:"auto"},children:c.jsx(T,{style:{height:o.getTotalSize(),width:"100%",position:"relative"},children:c.jsx(C,{items:a,onExpanded:d=>{e(d)},collapsedItems:s})})})})}function C(i){return c.jsx(c.Fragment,{children:i.items.map(l=>{const e=i.collapsedItems.has(l.id)?!1:void 0;return c.jsx(b,{style:{position:"absolute",top:0,left:0,width:"100%",height:`${l.virtual.size}px`,transform:`translateY(${l.virtual.start}px)`},label:l.label,expanded:e,level:l.flat.level,onExpanded:()=>i.onExpanded(l.id),children:l.items.length===0?void 0:c.jsx(C,{...i,items:l.items})},l.id)})})}export{je as default,Ce as handle};

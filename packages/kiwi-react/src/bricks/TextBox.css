/*---------------------------------------------------------------------------------------------
 * Copyright (c) Bentley Systems, Incorporated. All rights reserved.
 * See LICENSE.md in the project root for license terms and full copyright notice.
 *--------------------------------------------------------------------------------------------*/
.ğŸ¥-text-box {
	--âœ¨bg--default: var(--kiwi-color-bg-surface-primary);
	--âœ¨bg--hover: color-mix(
		in oklch,
		var(--âœ¨bg--default) 100%,
		var(--kiwi-color-glow-hue) var(--kiwi-color-bg-glow-base-hover-\%)
	);
	--âœ¨bg--disabled: var(--kiwi-color-bg-surface-base);
	--âœ¨border--default: var(--kiwi-color-border-neutral-base);
	--âœ¨border--hover: color-mix(
		in oklch,
		var(--âœ¨border--default) 100%,
		var(--kiwi-color-glow-hue) var(--kiwi-color-border-glow-base-hover-\%)
	);
	--âœ¨border--focus: var(--kiwi-color-border-accent-strong);
	--âœ¨border--disabled: var(--kiwi-color-border-glow-on-surface-disabled);
	--âœ¨color--default: var(--kiwi-color-text-neutral-primary);
	--âœ¨color--placeholder: var(--kiwi-color-text-neutral-secondary);
	--âœ¨color--disabled: var(--kiwi-color-text-neutral-disabled);
	--âœ¨height: 1.5rem;
	--âœ¨padding-inline: 8px;
	/* Dynamically adjust the padding to avoid issues with baseline alignment */
	--âœ¨padding-block: max(0px, (var(--âœ¨height) - 2px - 1lh) / 2);
	--âœ¨gap: 4px;
	--âœ¨outline: 2px solid var(--kiwi-color-border-accent-base);
	--âœ¨outline-offset: 1px;

	@layer base {
		cursor: var(--ğŸ¥text-box-cursor);
		font-size: var(--kiwi-font-size-12);
		min-inline-size: 0;

		min-block-size: var(--âœ¨height);
		padding-inline: var(--âœ¨padding-inline);
		border-radius: 4px;

		background-color: var(--ğŸ¥text-box-background-color);
		box-shadow: var(--kiwi-shadow-input-base);
		color: var(--âœ¨color--default);
		transition: all 150ms ease-out;
		transition-property: background-color, border-color;

		--ğŸ¥text-box-cursor: text;
		--ğŸ¥text-box-background-color: var(--ğŸŒ€text-box-state--default, var(--âœ¨bg--default))
			var(--ğŸŒ€text-box-state--hover, var(--âœ¨bg--hover))
			var(--ğŸŒ€text-box-state--disabled, var(--âœ¨bg--disabled));
		--ğŸ¥text-box-border-color: var(--ğŸŒ€text-box-state--default, var(--âœ¨border--default))
			var(--ğŸŒ€text-box-state--hover, var(--âœ¨border--hover))
			var(--ğŸŒ€text-box-state--disabled, var(--âœ¨border--disabled));

		/* Styles specific to wrapper ("root") */
		&:where(:not(input, textarea)) {
			position: relative;
			display: inline-flex;
			align-items: center;
			gap: var(--âœ¨gap);

			/* This pseudo-element is used to place a border which does not occupy space. */
			&::before {
				content: "";
				position: absolute;
				inset: 0;
				border-radius: inherit;
				pointer-events: none;
				border: 1px solid var(--ğŸ¥text-box-border-color);
				transition: border-color 150ms ease-out;
			}
		}

		/* Styles specific to input/textarea (self and nested) */
		&:where(input, textarea),
		:where(input, textarea) {
			appearance: none;
			line-height: 1.3; /* This is a safe value for Inter â€” lower values will be ignored. */
			min-inline-size: 0;
			border: 1px solid var(--ğŸ¥text-box-border-color);
			cursor: var(--ğŸ¥text-box-cursor);
			padding-block: var(--âœ¨padding-block);

			&::placeholder {
				color: var(--âœ¨color--placeholder);
				opacity: 1;
			}
		}

		/* Styles specific to textarea (self and nested) */
		&:where(textarea),
		:where(textarea) {
			resize: vertical;
			resize: block;
		}

		/* Styles specific to input/textarea (nested only, "invisible") */
		:where(input, textarea) {
			border: none;
			background-color: var(--ğŸ¥text-box-background-color);
			outline: unset;
			flex: 999;
			align-self: stretch;
			transition: background-color 150ms ease-out;
		}
	}

	@layer states {
		@media (any-hover: hover) {
			&:where(:hover) {
				--ğŸŒ€text-box-state: var(--ğŸŒ€text-box-state--hover);
			}
		}

		&:where(:has(:is(input, textarea):focus-visible), :is(input, textarea):focus-visible) {
			outline: var(--âœ¨outline);
			outline-offset: var(--âœ¨outline-offset);
			--ğŸ¥text-box-border-color: var(--âœ¨border--focus);
			--ğŸ¥icon-color: var(--kiwi-color-icon-accent-strong);
		}

		@supports not selector(:has(+ *)) {
			&:where(:not(input, textarea):focus-within) {
				outline: var(--âœ¨outline);
				outline-offset: var(--âœ¨outline-offset);
				--ğŸ¥text-box-border-color: var(--âœ¨border--focus);
				--ğŸ¥icon-color: var(--kiwi-color-icon-accent-strong);
			}
		}

		&:where(
				[disabled],
				:disabled,
				[aria-disabled="true"],
				[data-kiwi-disabled="true"],
				:has(:is(input, textarea):disabled)
			) {
			--ğŸŒ€text-box-state: var(--ğŸŒ€text-box-state--disabled);
			box-shadow: none;
			color: var(--âœ¨color--disabled);
			--ğŸ¥text-box-cursor: not-allowed;
		}
	}

	@layer base.ğŸŒ€ {
		/* Cyclic toggles for default/hover/disabled states. See https://kizu.dev/cyclic-toggles/ */
		--ğŸŒ€text-box-state: var(--ğŸŒ€text-box-state--default);
		--ğŸŒ€text-box-state--default: var(--ğŸŒ€text-box-state,);
		--ğŸŒ€text-box-state--hover: var(--ğŸŒ€text-box-state,);
		--ğŸŒ€text-box-state--disabled: var(--ğŸŒ€text-box-state,);
	}
}

.ğŸ¥-text-box-decoration {
	@layer base {
		flex-shrink: 0;
	}
}

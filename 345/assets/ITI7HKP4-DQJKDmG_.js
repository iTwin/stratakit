import{t as me,c as J,s as j,i as Ie,e as te,u as ie,a as R,b as ve}from"./YV4JVR4I-xwnP9gdF.js";import{q as F,s as q,t as M,T as Se,x as ge,y as Ee,v as pe,G as ye,b as Q,d as we,c as be,_ as ue,h as xe,U as he,V as ne,W as O,X as _e,m as H,l as Fe,C as Pe,g as Ce,u as Ae,e as ke,A as z,Y as Re,z as oe}from"./~utils-BuKH_XhK.js";import{i as Be,j as T,s as Ke,k as X,a as Le,l as Te,m as Me}from"./P2CTZE2T-BbbD4CJc.js";import{f as De,a as Oe,u as ze}from"./LVA2YJMS-BcAd7OG7.js";import{a as W,n as We}from"./chunk-K6AXKMTT-B_QCnNdX.js";function Ue(e){var r;const n=e.find(c=>!!c.element),t=[...e].reverse().find(c=>!!c.element);let u=(r=n==null?void 0:n.element)==null?void 0:r.parentElement;for(;u&&(t!=null&&t.element);){if(t&&u.contains(t.element))return u;u=u.parentElement}return ge(u).body}function Ve(e){return e==null?void 0:e.__unstablePrivateStore}function ae(e={}){var r;me(e,e.store);const n=(r=e.store)==null?void 0:r.getState(),t=F(e.items,n==null?void 0:n.items,e.defaultItems,[]),u=new Map(t.map(o=>[o.id,o])),c={items:t,renderedItems:F(n==null?void 0:n.renderedItems,[])},l=Ve(e.store),a=J({items:t,renderedItems:c.renderedItems},l),s=J(c,e.store),h=o=>{const f=Ee(o,m=>m.element);a.setState("renderedItems",f),s.setState("renderedItems",f)};j(s,()=>Ie(a)),j(a,()=>te(a,["items"],o=>{s.setState("items",o.items)})),j(a,()=>te(a,["renderedItems"],o=>{let f=!0,m=requestAnimationFrame(()=>{const{renderedItems:g}=s.getState();o.renderedItems!==g&&h(o.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(m);const w=()=>{if(f){f=!1;return}cancelAnimationFrame(m),m=requestAnimationFrame(()=>h(o.renderedItems))},K=Ue(o.renderedItems),S=new IntersectionObserver(w,{root:K});for(const g of o.renderedItems)g.element&&S.observe(g.element);return()=>{cancelAnimationFrame(m),S.disconnect()}}));const v=(o,f,m=!1)=>{let w;return f(S=>{const g=S.findIndex(({id:b})=>b===o.id),P=S.slice();if(g!==-1){w=S[g];const b=M(M({},w),o);P[g]=b,u.set(o.id,b)}else P.push(o),u.set(o.id,o);return P}),()=>{f(S=>{if(!w)return m&&u.delete(o.id),S.filter(({id:b})=>b!==o.id);const g=S.findIndex(({id:b})=>b===o.id);if(g===-1)return S;const P=S.slice();return P[g]=w,u.set(o.id,w),P})}},L=o=>v(o,f=>a.setState("items",f),!0);return q(M({},s),{registerItem:L,renderItem:o=>Se(L(o),v(o,f=>a.setState("renderedItems",f))),item:o=>{if(!o)return null;let f=u.get(o);if(!f){const{items:m}=a.getState();f=m.find(w=>w.id===o),f&&u.set(o,f)}return f||null},__unstablePrivateStore:a})}function ce(e,r,n){return pe(r,[n.store]),R(e,n,"items","setItems"),e}function mt(e={}){const[r,n]=ie(ae,e);return ce(r,n,e)}function le(e){const r=[];for(const n of e)r.push(...n);return r}function Z(e){return e.slice().reverse()}var He={id:null};function B(e,r){return e.find(n=>r?!n.disabled&&n.id!==r:!n.disabled)}function $e(e,r){return e.filter(n=>r?!n.disabled&&n.id!==r:!n.disabled)}function re(e,r){return e.filter(n=>n.rowId===r)}function Ne(e,r,n=!1){const t=e.findIndex(u=>u.id===r);return[...e.slice(t+1),...n?[He]:[],...e.slice(0,t)]}function de(e){const r=[];for(const n of e){const t=r.find(u=>{var c;return((c=u[0])==null?void 0:c.rowId)===n.rowId});t?t.push(n):r.push([n])}return r}function fe(e){let r=0;for(const{length:n}of e)n>r&&(r=n);return r}function je(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function qe(e,r,n){const t=fe(e);for(const u of e)for(let c=0;c<t;c+=1){const l=u[c];if(!l||n&&l.disabled){const s=c===0&&n?B(u):u[c-1];u[c]=s&&r!==s.id&&n?s:je(s==null?void 0:s.rowId)}}return e}function Ge(e){const r=de(e),n=fe(r),t=[];for(let u=0;u<n;u+=1)for(const c of r){const l=c[u];l&&t.push(q(M({},l),{rowId:l.rowId?`${u}`:void 0}))}return t}function Ye(e={}){var r;const n=(r=e.store)==null?void 0:r.getState(),t=ae(e),u=F(e.activeId,n==null?void 0:n.activeId,e.defaultActiveId),c=q(M({},t.getState()),{id:F(e.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:u,baseElement:F(n==null?void 0:n.baseElement,null),includesBaseElement:F(e.includesBaseElement,n==null?void 0:n.includesBaseElement,u===null),moves:F(n==null?void 0:n.moves,0),orientation:F(e.orientation,n==null?void 0:n.orientation,"both"),rtl:F(e.rtl,n==null?void 0:n.rtl,!1),virtualFocus:F(e.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:F(e.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:F(e.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:F(e.focusShift,n==null?void 0:n.focusShift,!1)}),l=J(c,t,e.store);j(l,()=>ve(l,["renderedItems","activeId"],s=>{l.setState("activeId",h=>{var v;return h!==void 0?h:(v=B(s.renderedItems))==null?void 0:v.id})}));const a=(s="next",h={})=>{var v,L;const o=l.getState(),{skip:f=0,activeId:m=o.activeId,focusShift:w=o.focusShift,focusLoop:K=o.focusLoop,focusWrap:S=o.focusWrap,includesBaseElement:g=o.includesBaseElement,renderedItems:P=o.renderedItems,rtl:b=o.rtl}=h,C=s==="up"||s==="down",U=s==="next"||s==="down",G=U?b&&!C:!b||C,$=w&&!f;let E=C?le(qe(de(P),m,$)):P;if(E=G?Z(E):E,E=C?Ge(E):E,m==null)return(v=B(E))==null?void 0:v.id;const D=E.find(I=>I.id===m);if(!D)return(L=B(E))==null?void 0:L.id;const N=E.some(I=>I.rowId),Y=E.indexOf(D),i=E.slice(Y+1),d=re(i,D.rowId);if(f){const I=$e(d,m),x=I.slice(f)[0]||I[I.length-1];return x==null?void 0:x.id}const p=K&&(C?K!=="horizontal":K!=="vertical"),y=N&&S&&(C?S!=="horizontal":S!=="vertical"),_=U?(!N||C)&&p&&g:C?g:!1;if(p){const I=y&&!_?E:re(E,D.rowId),x=Ne(I,m,_),k=B(x,m);return k==null?void 0:k.id}if(y){const I=B(_?d:i,m);return _?(I==null?void 0:I.id)||null:I==null?void 0:I.id}const A=B(d,m);return!A&&_?null:A==null?void 0:A.id};return q(M(M({},t),l),{setBaseElement:s=>l.setState("baseElement",s),setActiveId:s=>l.setState("activeId",s),move:s=>{s!==void 0&&(l.setState("activeId",s),l.setState("moves",h=>h+1))},first:()=>{var s;return(s=B(l.getState().renderedItems))==null?void 0:s.id},last:()=>{var s;return(s=B(Z(l.getState().renderedItems)))==null?void 0:s.id},next:s=>(s!==void 0&&typeof s=="number"&&(s={skip:s}),a("next",s)),previous:s=>(s!==void 0&&typeof s=="number"&&(s={skip:s}),a("previous",s)),down:s=>(s!==void 0&&typeof s=="number"&&(s={skip:s}),a("down",s)),up:s=>(s!==void 0&&typeof s=="number"&&(s={skip:s}),a("up",s))})}function Xe(e){const r=ye(e.id);return Q({id:r},e)}function Je(e,r,n){return e=ce(e,r,n),R(e,n,"activeId","setActiveId"),R(e,n,"includesBaseElement"),R(e,n,"virtualFocus"),R(e,n,"orientation"),R(e,n,"rtl"),R(e,n,"focusLoop"),R(e,n,"focusWrap"),R(e,n,"focusShift"),e}function It(e={}){e=Xe(e);const[r,n]=ie(Ye,e);return Je(r,n,e)}var Qe="div";function Ze(e){return e.some(r=>!!r.rowId)}function et(e){const r=e.target;return r&&!oe(r)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function tt(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function se(e,r,n){return H(t=>{var u;if(r==null||r(t),t.defaultPrevented||t.isPropagationStopped()||!z(t)||tt(t)||et(t))return;const c=e.getState(),l=(u=T(e,c.activeId))==null?void 0:u.element;if(!l)return;const a=t,s=ue(a,["view"]),h=n==null?void 0:n.current;l!==h&&l.focus(),Re(l,t.type,s)||t.preventDefault(),t.currentTarget.contains(l)&&t.stopPropagation()})}function nt(e){return Te(le(Z(Me(e))))}function rt(e){const[r,n]=W.useState(!1),t=W.useCallback(()=>n(!0),[]),u=e.useState(c=>T(e,c.activeId));return W.useEffect(()=>{const c=u==null?void 0:u.element;r&&c&&(n(!1),c.focus({preventScroll:!0}))},[u,r]),t}var st=be(function(r){var n=r,{store:t,composite:u=!0,focusOnMove:c=u,moveOnKeyPress:l=!0}=n,a=ue(n,["store","composite","focusOnMove","moveOnKeyPress"]);const s=Be();t=t||s,xe(t,!1);const h=W.useRef(null),v=W.useRef(null),L=rt(t),o=t.useState("moves"),[,f]=he(u?t.setBaseElement:null);W.useEffect(()=>{var i;if(!t||!o||!u||!c)return;const{activeId:d}=t.getState(),p=(i=T(t,d))==null?void 0:i.element;p&&De(p)},[t,o,u,c]),ne(()=>{if(!t||!o||!u)return;const{baseElement:i,activeId:d}=t.getState();if(!(d===null)||!i)return;const y=v.current;v.current=null,y&&O(y,{relatedTarget:i}),Oe(i)||i.focus()},[t,o,u]);const m=t.useState("activeId"),w=t.useState("virtualFocus");ne(()=>{var i;if(!t||!u||!w)return;const d=v.current;if(v.current=null,!d)return;const y=((i=T(t,m))==null?void 0:i.element)||_e(d);y!==d&&O(d,{relatedTarget:y})},[t,m,w,u]);const K=se(t,a.onKeyDownCapture,v),S=se(t,a.onKeyUpCapture,v),g=a.onFocusCapture,P=H(i=>{if(g==null||g(i),i.defaultPrevented||!t)return;const{virtualFocus:d}=t.getState();if(!d)return;const p=i.relatedTarget,y=Ke(i.currentTarget);z(i)&&y&&(i.stopPropagation(),v.current=p)}),b=a.onFocus,C=H(i=>{if(b==null||b(i),i.defaultPrevented||!u||!t)return;const{relatedTarget:d}=i,{virtualFocus:p}=t.getState();p?z(i)&&!X(t,d)&&queueMicrotask(L):z(i)&&t.setActiveId(null)}),U=a.onBlurCapture,G=H(i=>{var d;if(U==null||U(i),i.defaultPrevented||!t)return;const{virtualFocus:p,activeId:y}=t.getState();if(!p)return;const _=(d=T(t,y))==null?void 0:d.element,A=i.relatedTarget,I=X(t,A),x=v.current;v.current=null,z(i)&&I?(A===_?x&&x!==A&&O(x,i):_?O(_,i):x&&O(x,i),i.stopPropagation()):!X(t,i.target)&&_&&O(_,i)}),$=a.onKeyDown,E=Fe(l),D=H(i=>{var d;if($==null||$(i),i.defaultPrevented||!t||!z(i))return;const{orientation:p,renderedItems:y,activeId:_}=t.getState(),A=T(t,_);if((d=A==null?void 0:A.element)!=null&&d.isConnected)return;const I=p!=="horizontal",x=p!=="vertical",k=Ze(y);if((i.key==="ArrowLeft"||i.key==="ArrowRight"||i.key==="Home"||i.key==="End")&&oe(i.currentTarget))return;const ee={ArrowUp:(k||I)&&(()=>{if(k){const V=nt(y);return V==null?void 0:V.id}return t==null?void 0:t.last()}),ArrowRight:(k||x)&&t.first,ArrowDown:(k||I)&&t.first,ArrowLeft:(k||x)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[i.key];if(ee){const V=ee();if(V!==void 0){if(!E(i))return;i.preventDefault(),t.move(V)}}});a=Pe(a,i=>We.jsx(Le,{value:t,children:i}),[t]);const N=t.useState(i=>{var d;if(t&&u&&i.virtualFocus)return(d=T(t,i.activeId))==null?void 0:d.id});a=Ce(Q({"aria-activedescendant":N},a),{ref:Ae(h,f,a.ref),onKeyDownCapture:K,onKeyUpCapture:S,onFocusCapture:P,onFocus:C,onBlurCapture:G,onKeyDown:D});const Y=t.useState(i=>u&&(i.virtualFocus||i.activeId===null));return a=ze(Q({focusable:Y},a)),a}),vt=we(function(r){const n=st(r);return ke(Qe,n)});export{vt as C,st as a,ae as b,Ye as c,It as d,mt as e,Je as u};

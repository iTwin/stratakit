import{d as ae,g as A,s as ue,i as O,a as Z,e as oe,h as se,C as le}from"./WZWDIE3S-Bd6-9Z81.js";import{l as ce,k as de,u as fe}from"./U6HHPQDW-DvaKGdtW.js";import{A as ve,aa as me,aG as Ie,L as Y,aH as T,a1 as Se,G as H,ae as p,a3 as ge,af as ee,Q as Ee,I as xe,aI as ye,y as Ce,z as we,ac as I,B as he,w as Pe}from"./~utils-CKswT0zA.js";import{a as b,p as be}from"./chunk-JZWAC4HX-ROAaBwzV.js";import{c as Fe,e as ke}from"./GVAFFF2B-Q-CQ45cK.js";import{c as Ae,d as _e,s as Le,b as k,a as Be}from"./Q5W46E73-CspxDxTB.js";import{P as Re,a as Te}from"./JMU4N4M5-B11z4OjE.js";function te(t){const e=[];for(const n of t)e.push(...n);return e}function q(t){return t.slice().reverse()}var pe="div";function Ke(t){return t.some(e=>!!e.rowId)}function De(t){const e=t.target;return e&&!ee(e)?!1:t.key.length===1&&!t.ctrlKey&&!t.metaKey}function ze(t){return t.key==="Shift"||t.key==="Control"||t.key==="Alt"||t.key==="Meta"}function J(t,e,n){return H(u=>{var s;if(e?.(u),u.defaultPrevented||u.isPropagationStopped()||!p(u)||ze(u)||De(u))return;const a=t.getState(),o=(s=A(t,a.activeId))==null?void 0:s.element;if(!o)return;const{view:F,...r}=u,S=n?.current;o!==S&&o.focus(),ye(o,u.type,r)||u.preventDefault(),u.currentTarget.contains(o)&&u.stopPropagation()})}function Me(t){return oe(te(q(se(t))))}function We(t){const[e,n]=b.useState(!1),u=b.useCallback(()=>n(!0),[]),s=t.useState(a=>A(t,a.activeId));return b.useEffect(()=>{const a=s?.element;e&&a&&(n(!1),a.focus({preventScroll:!0}))},[s,e]),u}var He=ve(function({store:e,composite:n=!0,focusOnMove:u=n,moveOnKeyPress:s=!0,...a}){const o=ae();e=e||o,me(e,!1);const F=b.useRef(null),r=b.useRef(null),S=We(e),g=e.useState("moves"),[,N]=Ie(n?e.setBaseElement:null);b.useEffect(()=>{var i;if(!e||!g||!n||!u)return;const{activeId:l}=e.getState(),d=(i=A(e,l))==null?void 0:i.element;d&&ce(d)},[e,g,n,u]),Y(()=>{if(!e||!g||!n)return;const{baseElement:i,activeId:l}=e.getState();if(!(l===null)||!i)return;const f=r.current;r.current=null,f&&T(f,{relatedTarget:i}),de(i)||i.focus()},[e,g,n]);const E=e.useState("activeId"),_=e.useState("virtualFocus");Y(()=>{var i;if(!e||!n||!_)return;const l=r.current;if(r.current=null,!l)return;const f=((i=A(e,E))==null?void 0:i.element)||Se(l);f!==l&&T(l,{relatedTarget:f})},[e,E,_,n]);const x=J(e,a.onKeyDownCapture,r),G=J(e,a.onKeyUpCapture,r),L=a.onFocusCapture,K=H(i=>{if(L?.(i),i.defaultPrevented||!e)return;const{virtualFocus:l}=e.getState();if(!l)return;const d=i.relatedTarget,f=ue(i.currentTarget);p(i)&&f&&(i.stopPropagation(),r.current=d)}),D=a.onFocus,U=H(i=>{if(D?.(i),i.defaultPrevented||!n||!e)return;const{relatedTarget:l}=i,{virtualFocus:d}=e.getState();d?p(i)&&!O(e,l)&&queueMicrotask(S):p(i)&&e.setActiveId(null)}),z=a.onBlurCapture,y=H(i=>{var l;if(z?.(i),i.defaultPrevented||!e)return;const{virtualFocus:d,activeId:f}=e.getState();if(!d)return;const C=(l=A(e,f))==null?void 0:l.element,h=i.relatedTarget,w=O(e,h),m=r.current;r.current=null,p(i)&&w?(h===C?m&&m!==h&&T(m,i):C?T(C,i):m&&T(m,i),i.stopPropagation()):!O(e,i.target)&&C&&T(C,i)}),M=a.onKeyDown,V=ge(s),$=H(i=>{var l;if(M?.(i),i.nativeEvent.isComposing||i.defaultPrevented||!e||!p(i))return;const{orientation:d,renderedItems:f,activeId:C}=e.getState(),h=A(e,C);if((l=h?.element)!=null&&l.isConnected)return;const w=d!=="horizontal",m=d!=="vertical",c=Ke(f);if((i.key==="ArrowLeft"||i.key==="ArrowRight"||i.key==="Home"||i.key==="End")&&ee(i.currentTarget))return;const Q={ArrowUp:(c||w)&&(()=>{if(c){const W=Me(f);return W?.id}return e?.last()}),ArrowRight:(c||m)&&e.first,ArrowDown:(c||w)&&e.first,ArrowLeft:(c||m)&&e.last,Home:e.first,End:e.last,PageUp:e.first,PageDown:e.last}[i.key];if(Q){const W=Q();if(W!==void 0){if(!V(i))return;i.preventDefault(),e.move(W)}}});a=Ee(a,i=>be.jsx(Z,{value:e,children:i}),[e]),a={"aria-activedescendant":e.useState(i=>{var l;if(e&&n&&i.virtualFocus)return(l=A(e,i.activeId))==null?void 0:l.id}),...a,ref:xe(F,N,a.ref),onKeyDownCapture:x,onKeyUpCapture:G,onFocusCapture:K,onFocus:U,onBlurCapture:y,onKeyDown:$};const B=e.useState(i=>n&&(i.virtualFocus||i.activeId===null));return a=fe({focusable:B,...a}),a}),it=Ce(function(e){const n=He(e);return we(pe,n)}),Ne={id:null};function P(t,e){return t.find(n=>e?!n.disabled&&n.id!==e:!n.disabled)}function Ue(t,e){return t.filter(n=>e?!n.disabled&&n.id!==e:!n.disabled)}function X(t,e){return t.filter(n=>n.rowId===e)}function Ge(t,e,n=!1){const u=t.findIndex(s=>s.id===e);return[...t.slice(u+1),...n?[Ne]:[],...t.slice(0,u)]}function ne(t){const e=[];for(const n of t){const u=e.find(s=>{var a;return((a=s[0])==null?void 0:a.rowId)===n.rowId});u?u.push(n):e.push([n])}return e}function re(t){let e=0;for(const{length:n}of t)n>e&&(e=n);return e}function Ve(t){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:t}}function $e(t,e,n){const u=re(t);for(const s of t)for(let a=0;a<u;a+=1){const o=s[a];if(!o||n&&o.disabled){const r=a===0&&n?P(s):s[a-1];s[a]=r&&e!==r.id&&n?r:Ve(r?.rowId)}}return t}function je(t){const e=ne(t),n=re(e),u=[];for(let s=0;s<n;s+=1)for(const a of e){const o=a[s];o&&u.push({...o,rowId:o.rowId?`${s}`:void 0})}return u}function Oe(t={}){var e;const n=(e=t.store)==null?void 0:e.getState(),u=Fe(t),s=I(t.activeId,n?.activeId,t.defaultActiveId),a={...u.getState(),id:I(t.id,n?.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:s,baseElement:I(n?.baseElement,null),includesBaseElement:I(t.includesBaseElement,n?.includesBaseElement,s===null),moves:I(n?.moves,0),orientation:I(t.orientation,n?.orientation,"both"),rtl:I(t.rtl,n?.rtl,!1),virtualFocus:I(t.virtualFocus,n?.virtualFocus,!1),focusLoop:I(t.focusLoop,n?.focusLoop,!1),focusWrap:I(t.focusWrap,n?.focusWrap,!1),focusShift:I(t.focusShift,n?.focusShift,!1)},o=Ae(a,u,t.store);_e(o,()=>Le(o,["renderedItems","activeId"],r=>{o.setState("activeId",S=>{var g;return S!==void 0?S:(g=P(r.renderedItems))==null?void 0:g.id})}));const F=(r="next",S={})=>{var g,N;const E=o.getState(),{skip:_=0,activeId:x=E.activeId,focusShift:G=E.focusShift,focusLoop:L=E.focusLoop,focusWrap:K=E.focusWrap,includesBaseElement:D=E.includesBaseElement,renderedItems:U=E.renderedItems,rtl:z=E.rtl}=S,y=r==="up"||r==="down",M=r==="next"||r==="down",V=M?z&&!y:!z||y,$=G&&!_;let v=y?te($e(ne(U),x,$)):U;if(v=V?q(v):v,v=y?je(v):v,x==null)return(g=P(v))==null?void 0:g.id;const B=v.find(c=>c.id===x);if(!B)return(N=P(v))==null?void 0:N.id;const i=v.some(c=>c.rowId),l=v.indexOf(B),d=v.slice(l+1),f=X(d,B.rowId);if(_){const c=Ue(f,x),R=c.slice(_)[0]||c[c.length-1];return R?.id}const C=L&&(y?L!=="horizontal":L!=="vertical"),h=i&&K&&(y?K!=="horizontal":K!=="vertical"),w=M?(!i||y)&&C&&D:y?D:!1;if(C){const c=h&&!w?v:X(v,B.rowId),R=Ge(c,x,w),j=P(R,x);return j?.id}if(h){const c=P(w?f:d,x);return w?c?.id||null:c?.id}const m=P(f,x);return!m&&w?null:m?.id};return{...u,...o,setBaseElement:r=>o.setState("baseElement",r),setActiveId:r=>o.setState("activeId",r),move:r=>{r!==void 0&&(o.setState("activeId",r),o.setState("moves",S=>S+1))},first:()=>{var r;return(r=P(o.getState().renderedItems))==null?void 0:r.id},last:()=>{var r;return(r=P(q(o.getState().renderedItems)))==null?void 0:r.id},next:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),F("next",r)),previous:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),F("previous",r)),down:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),F("down",r)),up:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),F("up",r))}}function qe(t){return{id:he(t.id),...t}}function Qe(t,e,n){return t=ke(t,e,n),k(t,n,"activeId","setActiveId"),k(t,n,"includesBaseElement"),k(t,n,"virtualFocus"),k(t,n,"orientation"),k(t,n,"rtl"),k(t,n,"focusLoop"),k(t,n,"focusWrap"),k(t,n,"focusShift"),t}function at(t={}){t=qe(t);const[e,n]=Be(Oe,t);return Qe(e,n,t)}b.createContext(void 0);var ie=Pe([Te,Z],[Re,le]),ut=ie.useContext,ot=ie.useProviderContext;b.createContext(void 0);b.createContext(!1);export{it as C,He as a,ut as b,Oe as c,Qe as d,ot as e,at as u};

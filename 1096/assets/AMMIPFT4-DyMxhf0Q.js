import{R as O,W as _,N as w,K as y,o as C,a3 as E,p as M,X as q}from"./VOQWLFSQ-C-BaLyus.js";import{W as D,M as h,N as x,a7 as N,Q as A,S as R,U}from"./~utils-BT-V-paY.js";var S=O(),X=S.useContext,j=S.useProviderContext,z=S.ContextProvider,G=S.ScopedContextProvider;function V(t){var c;const s=t.find(f=>!!f.element),u=[...t].reverse().find(f=>!!f.element);let r=(c=s?.element)==null?void 0:c.parentElement;for(;r&&u?.element;){if(u&&r.contains(u.element))return r;r=r.parentElement}return M(r).body}function W(t){return t?.__unstablePrivateStore}function k(t={}){var c;D(t,t.store);const s=(c=t.store)==null?void 0:c.getState(),u=_(t.items,s?.items,t.defaultItems,[]),r=new Map(u.map(e=>[e.id,e])),f={items:u,renderedItems:_(s?.renderedItems,[])},F=W(t.store),i=h({items:u,renderedItems:f.renderedItems},F),v=h(f,t.store),P=e=>{const n=E(e,l=>l.element);i.setState("renderedItems",n),v.setState("renderedItems",n)};x(v,()=>N(i)),x(i,()=>A(i,["items"],e=>{v.setState("items",e.items)})),x(i,()=>A(i,["renderedItems"],e=>{let n=!0,l=requestAnimationFrame(()=>{const{renderedItems:a}=v.getState();e.renderedItems!==a&&P(e.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(l);const d=()=>{if(n){n=!1;return}cancelAnimationFrame(l),l=requestAnimationFrame(()=>P(e.renderedItems))},b=V(e.renderedItems),o=new IntersectionObserver(d,{root:b});for(const a of e.renderedItems)a.element&&o.observe(a.element);return()=>{cancelAnimationFrame(l),o.disconnect()}}));const g=(e,n,l=!1)=>{let d;return n(o=>{const a=o.findIndex(({id:m})=>m===e.id),I=o.slice();if(a!==-1){d=o[a];const m=C(C({},d),e);I[a]=m,r.set(e.id,m)}else I.push(e),r.set(e.id,e);return I}),()=>{n(o=>{if(!d)return l&&r.delete(e.id),o.filter(({id:m})=>m!==e.id);const a=o.findIndex(({id:m})=>m===e.id);if(a===-1)return o;const I=o.slice();return I[a]=d,r.set(e.id,d),I})}},p=e=>g(e,n=>i.setState("items",n),!0);return w(C({},v),{registerItem:p,renderItem:e=>y(p(e),g(e,n=>i.setState("renderedItems",n))),item:e=>{if(!e)return null;let n=r.get(e);if(!n){const{items:l}=i.getState();n=l.find(d=>d.id===e),n&&r.set(e,n)}return n||null},__unstablePrivateStore:i})}function B(t,c,s){return q(c,[s.store]),U(t,s,"items","setItems"),t}function H(t={}){const[c,s]=R(k,t);return B(c,s,t)}export{G as C,H as a,j as b,k as c,z as d,B as e,X as u};

import{N as E,x as _,y as C,a5 as F,E as h,H as O,J as w}from"./~utils-CG_lKcsS.js";import{P as y,L as M,I as q,d as x,a2 as D,l as V,Q as k,S as B}from"./LMDWO4NN-L4HmYCAu.js";function H(t){var d;const s=t.find(f=>!!f.element),u=[...t].reverse().find(f=>!!f.element);let r=(d=s?.element)==null?void 0:d.parentElement;for(;r&&u?.element;){if(u&&r.contains(u.element))return r;r=r.parentElement}return V(r).body}function J(t){return t?.__unstablePrivateStore}function L(t={}){var d;E(t,t.store);const s=(d=t.store)==null?void 0:d.getState(),u=y(t.items,s?.items,t.defaultItems,[]),r=new Map(u.map(e=>[e.id,e])),f={items:u,renderedItems:y(s?.renderedItems,[])},A=J(t.store),i=_({items:u,renderedItems:f.renderedItems},A),v=_(f,t.store),P=e=>{const n=D(e,l=>l.element);i.setState("renderedItems",n),v.setState("renderedItems",n)};C(v,()=>F(i)),C(i,()=>h(i,["items"],e=>{v.setState("items",e.items)})),C(i,()=>h(i,["renderedItems"],e=>{let n=!0,l=requestAnimationFrame(()=>{const{renderedItems:a}=v.getState();e.renderedItems!==a&&P(e.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(l);const c=()=>{if(n){n=!1;return}cancelAnimationFrame(l),l=requestAnimationFrame(()=>P(e.renderedItems))},p=H(e.renderedItems),o=new IntersectionObserver(c,{root:p});for(const a of e.renderedItems)a.element&&o.observe(a.element);return()=>{cancelAnimationFrame(l),o.disconnect()}}));const g=(e,n,l=!1)=>{let c;return n(o=>{const a=o.findIndex(({id:m})=>m===e.id),I=o.slice();if(a!==-1){c=o[a];const m=x(x({},c),e);I[a]=m,r.set(e.id,m)}else I.push(e),r.set(e.id,e);return I}),()=>{n(o=>{if(!c)return l&&r.delete(e.id),o.filter(({id:m})=>m!==e.id);const a=o.findIndex(({id:m})=>m===e.id);if(a===-1)return o;const I=o.slice();return I[a]=c,r.set(e.id,c),I})}},b=e=>g(e,n=>i.setState("items",n),!0);return M(x({},v),{registerItem:b,renderItem:e=>q(b(e),g(e,n=>i.setState("renderedItems",n))),item:e=>{if(!e)return null;let n=r.get(e);if(!n){const{items:l}=i.getState();n=l.find(c=>c.id===e),n&&r.set(e,n)}return n||null},__unstablePrivateStore:i})}function N(t,d,s){return k(d,[s.store]),w(t,s,"items","setItems"),t}function U(t={}){const[d,s]=O(L,t);return N(d,s,t)}var S=B(),j=S.useContext,z=S.useProviderContext,G=S.ContextProvider,K=S.ScopedContextProvider;export{K as C,j as a,z as b,L as c,N as d,G as e,U as u};

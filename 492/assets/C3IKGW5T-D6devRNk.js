import{az as F,ad as p,af as C,ag as S,ac as O,ae as g,bv as w,ai as h,aj as y,aI as E,aH as M,ak as k,al as q,am as D}from"./~utils-CL41InB6.js";function V(t){var c;const s=t.find(f=>!!f.element),u=[...t].reverse().find(f=>!!f.element);let r=(c=s==null?void 0:s.element)==null?void 0:c.parentElement;for(;r&&(u!=null&&u.element);){if(u&&r.contains(u.element))return r;r=r.parentElement}return M(r).body}function j(t){return t==null?void 0:t.__unstablePrivateStore}function z(t={}){var c;F(t,t.store);const s=(c=t.store)==null?void 0:c.getState(),u=p(t.items,s==null?void 0:s.items,t.defaultItems,[]),r=new Map(u.map(e=>[e.id,e])),f={items:u,renderedItems:p(s==null?void 0:s.renderedItems,[])},A=j(t.store),i=C({items:u,renderedItems:f.renderedItems},A),v=C(f,t.store),b=e=>{const n=E(e,l=>l.element);i.setState("renderedItems",n),v.setState("renderedItems",n)};S(v,()=>w(i)),S(i,()=>h(i,["items"],e=>{v.setState("items",e.items)})),S(i,()=>h(i,["renderedItems"],e=>{let n=!0,l=requestAnimationFrame(()=>{const{renderedItems:o}=v.getState();e.renderedItems!==o&&b(e.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(l);const d=()=>{if(n){n=!1;return}cancelAnimationFrame(l),l=requestAnimationFrame(()=>b(e.renderedItems))},x=V(e.renderedItems),a=new IntersectionObserver(d,{root:x});for(const o of e.renderedItems)o.element&&a.observe(o.element);return()=>{cancelAnimationFrame(l),a.disconnect()}}));const P=(e,n,l=!1)=>{let d;return n(a=>{const o=a.findIndex(({id:m})=>m===e.id),I=a.slice();if(o!==-1){d=a[o];const m=g(g({},d),e);I[o]=m,r.set(e.id,m)}else I.push(e),r.set(e.id,e);return I}),()=>{n(a=>{if(!d)return l&&r.delete(e.id),a.filter(({id:m})=>m!==e.id);const o=a.findIndex(({id:m})=>m===e.id);if(o===-1)return a;const I=a.slice();return I[o]=d,r.set(e.id,d),I})}},_=e=>P(e,n=>i.setState("items",n),!0);return O(g({},v),{registerItem:_,renderItem:e=>y(_(e),P(e,n=>i.setState("renderedItems",n))),item:e=>{if(!e)return null;let n=r.get(e);if(!n){const{items:l}=i.getState();n=l.find(d=>d.id===e),n&&r.set(e,n)}return n||null},__unstablePrivateStore:i})}function B(t,c,s){return q(c,[s.store]),D(t,s,"items","setItems"),t}function R(t={}){const[c,s]=k(z,t);return B(c,s,t)}export{B as a,z as c,R as u};

import{M as F,R as p,G as M,Y as O,l as w,S as y}from"./ILRXHV7V-BQd5kv1w.js";import{W as E,M as _,N as C,a7 as q,Q as h,S as D,U as R}from"./~utils-Dpnu7P7F.js";var S=F(),V=S.useContext,W=S.useProviderContext,Y=S.ContextProvider,j=S.ScopedContextProvider;function U(t){var c;const o=t.find(f=>!!f.element),u=[...t].reverse().find(f=>!!f.element);let r=(c=o?.element)==null?void 0:c.parentElement;for(;r&&u?.element;){if(u&&r.contains(u.element))return r;r=r.parentElement}return w(r).body}function k(t){return t?.__unstablePrivateStore}function B(t={}){var c;E(t,t.store);const o=(c=t.store)==null?void 0:c.getState(),u=p(t.items,o?.items,t.defaultItems,[]),r=new Map(u.map(e=>[e.id,e])),f={items:u,renderedItems:p(o?.renderedItems,[])},A=k(t.store),a=_({items:u,renderedItems:f.renderedItems},A),v=_(f,t.store),x=e=>{const n=O(e,l=>l.element);a.setState("renderedItems",n),v.setState("renderedItems",n)};C(v,()=>q(a)),C(a,()=>h(a,["items"],e=>{v.setState("items",e.items)})),C(a,()=>h(a,["renderedItems"],e=>{let n=!0,l=requestAnimationFrame(()=>{const{renderedItems:i}=v.getState();e.renderedItems!==i&&x(e.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(l);const d=()=>{if(n){n=!1;return}cancelAnimationFrame(l),l=requestAnimationFrame(()=>x(e.renderedItems))},b=U(e.renderedItems),s=new IntersectionObserver(d,{root:b});for(const i of e.renderedItems)i.element&&s.observe(i.element);return()=>{cancelAnimationFrame(l),s.disconnect()}}));const P=(e,n,l=!1)=>{let d;return n(s=>{const i=s.findIndex(({id:m})=>m===e.id),I=s.slice();if(i!==-1){d=s[i];const m={...d,...e};I[i]=m,r.set(e.id,m)}else I.push(e),r.set(e.id,e);return I}),()=>{n(s=>{if(!d)return l&&r.delete(e.id),s.filter(({id:m})=>m!==e.id);const i=s.findIndex(({id:m})=>m===e.id);if(i===-1)return s;const I=s.slice();return I[i]=d,r.set(e.id,d),I})}},g=e=>P(e,n=>a.setState("items",n),!0);return{...v,registerItem:g,renderItem:e=>M(g(e),P(e,n=>a.setState("renderedItems",n))),item:e=>{if(!e)return null;let n=r.get(e);if(!n){const{items:l}=a.getState();n=l.find(d=>d.id===e),n&&r.set(e,n)}return n||null},__unstablePrivateStore:a}}function G(t,c,o){return y(c,[o.store]),R(t,o,"items","setItems"),t}function z(t={}){const[c,o]=D(B,t);return G(c,o,t)}export{j as C,z as a,W as b,B as c,Y as d,G as e,V as u};

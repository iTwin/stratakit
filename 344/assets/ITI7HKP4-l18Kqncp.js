import{$ as oe,o as y,q as Y,s as U,p as ae,K as ce,L as le,v as de,N as fe,b as J,a6 as me,y as _,f as Ie,c as ve,_ as ne,i as ge,a7 as Se,a8 as Z,a9 as k,aa as pe,k as W,j as Ee,E as ye,e as we,u as he,d as be,C as A,ab as xe,B as re}from"./collection-JezXOkgr.js";import{d as Fe,g as P,s as _e,i as G,a as Pe,e as Ce,h as ke}from"./P2CTZE2T-DsJiS6oM.js";import{f as Ae,a as Ke,u as Le}from"./LVA2YJMS-BhSxftNL.js";import{a as K,n as Be}from"./chunk-K6AXKMTT-B_QCnNdX.js";function ue(e){const s=[];for(const n of e)s.push(...n);return s}function Q(e){return e.slice().reverse()}var Re={id:null};function F(e,s){return e.find(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function Te(e,s){return e.filter(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function ee(e,s){return e.filter(n=>n.rowId===s)}function De(e,s,n=!1){const t=e.findIndex(i=>i.id===s);return[...e.slice(t+1),...n?[Re]:[],...e.slice(0,t)]}function se(e){const s=[];for(const n of e){const t=s.find(i=>{var c;return((c=i[0])==null?void 0:c.rowId)===n.rowId});t?t.push(n):s.push([n])}return s}function ie(e){let s=0;for(const{length:n}of e)n>s&&(s=n);return s}function Me(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function ze(e,s,n){const t=ie(e);for(const i of e)for(let c=0;c<t;c+=1){const o=i[c];if(!o||n&&o.disabled){const u=c===0&&n?F(i):i[c-1];i[c]=u&&s!==u.id&&n?u:Me(u==null?void 0:u.rowId)}}return e}function We(e){const s=se(e),n=ie(s),t=[];for(let i=0;i<n;i+=1)for(const c of s){const o=c[i];o&&t.push(Y(U({},o),{rowId:o.rowId?`${i}`:void 0}))}return t}function Oe(e={}){var s;const n=(s=e.store)==null?void 0:s.getState(),t=oe(e),i=y(e.activeId,n==null?void 0:n.activeId,e.defaultActiveId),c=Y(U({},t.getState()),{id:y(e.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:i,baseElement:y(n==null?void 0:n.baseElement,null),includesBaseElement:y(e.includesBaseElement,n==null?void 0:n.includesBaseElement,i===null),moves:y(n==null?void 0:n.moves,0),orientation:y(e.orientation,n==null?void 0:n.orientation,"both"),rtl:y(e.rtl,n==null?void 0:n.rtl,!1),virtualFocus:y(e.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:y(e.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:y(e.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:y(e.focusShift,n==null?void 0:n.focusShift,!1)}),o=ae(c,t,e.store);ce(o,()=>le(o,["renderedItems","activeId"],u=>{o.setState("activeId",w=>{var I;return w!==void 0?w:(I=F(u.renderedItems))==null?void 0:I.id})}));const l=(u="next",w={})=>{var I,O;const p=o.getState(),{skip:L=0,activeId:E=p.activeId,focusShift:$=p.focusShift,focusLoop:B=p.focusLoop,focusWrap:R=p.focusWrap,includesBaseElement:T=p.includesBaseElement,renderedItems:H=p.renderedItems,rtl:D=p.rtl}=w,h=u==="up"||u==="down",M=u==="next"||u==="down",j=M?D&&!h:!D||h,N=$&&!L;let f=h?ue(ze(se(H),E,N)):H;if(f=j?Q(f):f,f=h?We(f):f,E==null)return(I=F(f))==null?void 0:I.id;const C=f.find(d=>d.id===E);if(!C)return(O=F(f))==null?void 0:O.id;const V=f.some(d=>d.rowId),q=f.indexOf(C),r=f.slice(q+1),a=ee(r,C.rowId);if(L){const d=Te(a,E),g=d.slice(L)[0]||d[d.length-1];return g==null?void 0:g.id}const m=B&&(h?B!=="horizontal":B!=="vertical"),v=V&&R&&(h?R!=="horizontal":R!=="vertical"),S=M?(!V||h)&&m&&T:h?T:!1;if(m){const d=v&&!S?f:ee(f,C.rowId),g=De(d,E,S),x=F(g,E);return x==null?void 0:x.id}if(v){const d=F(S?a:r,E);return S?(d==null?void 0:d.id)||null:d==null?void 0:d.id}const b=F(a,E);return!b&&S?null:b==null?void 0:b.id};return Y(U(U({},t),o),{setBaseElement:u=>o.setState("baseElement",u),setActiveId:u=>o.setState("activeId",u),move:u=>{u!==void 0&&(o.setState("activeId",u),o.setState("moves",w=>w+1))},first:()=>{var u;return(u=F(o.getState().renderedItems))==null?void 0:u.id},last:()=>{var u;return(u=F(Q(o.getState().renderedItems)))==null?void 0:u.id},next:u=>(u!==void 0&&typeof u=="number"&&(u={skip:u}),l("next",u)),previous:u=>(u!==void 0&&typeof u=="number"&&(u={skip:u}),l("previous",u)),down:u=>(u!==void 0&&typeof u=="number"&&(u={skip:u}),l("down",u)),up:u=>(u!==void 0&&typeof u=="number"&&(u={skip:u}),l("up",u))})}function $e(e){const s=fe(e.id);return J({id:s},e)}function He(e,s,n){return e=me(e,s,n),_(e,n,"activeId","setActiveId"),_(e,n,"includesBaseElement"),_(e,n,"virtualFocus"),_(e,n,"orientation"),_(e,n,"rtl"),_(e,n,"focusLoop"),_(e,n,"focusWrap"),_(e,n,"focusShift"),e}function rt(e={}){e=$e(e);const[s,n]=de(Oe,e);return He(s,n,e)}var Ne="div";function Ve(e){return e.some(s=>!!s.rowId)}function Ue(e){const s=e.target;return s&&!re(s)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function je(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function te(e,s,n){return W(t=>{var i;if(s==null||s(t),t.defaultPrevented||t.isPropagationStopped()||!A(t)||je(t)||Ue(t))return;const c=e.getState(),o=(i=P(e,c.activeId))==null?void 0:i.element;if(!o)return;const l=t,u=ne(l,["view"]),w=n==null?void 0:n.current;o!==w&&o.focus(),xe(o,t.type,u)||t.preventDefault(),t.currentTarget.contains(o)&&t.stopPropagation()})}function qe(e){return Ce(ue(Q(ke(e))))}function Ge(e){const[s,n]=K.useState(!1),t=K.useCallback(()=>n(!0),[]),i=e.useState(c=>P(e,c.activeId));return K.useEffect(()=>{const c=i==null?void 0:i.element;s&&c&&(n(!1),c.focus({preventScroll:!0}))},[i,s]),t}var Ye=ve(function(s){var n=s,{store:t,composite:i=!0,focusOnMove:c=i,moveOnKeyPress:o=!0}=n,l=ne(n,["store","composite","focusOnMove","moveOnKeyPress"]);const u=Fe();t=t||u,ge(t,!1);const w=K.useRef(null),I=K.useRef(null),O=Ge(t),p=t.useState("moves"),[,L]=Se(i?t.setBaseElement:null);K.useEffect(()=>{var r;if(!t||!p||!i||!c)return;const{activeId:a}=t.getState(),m=(r=P(t,a))==null?void 0:r.element;m&&Ae(m)},[t,p,i,c]),Z(()=>{if(!t||!p||!i)return;const{baseElement:r,activeId:a}=t.getState();if(!(a===null)||!r)return;const v=I.current;I.current=null,v&&k(v,{relatedTarget:r}),Ke(r)||r.focus()},[t,p,i]);const E=t.useState("activeId"),$=t.useState("virtualFocus");Z(()=>{var r;if(!t||!i||!$)return;const a=I.current;if(I.current=null,!a)return;const v=((r=P(t,E))==null?void 0:r.element)||pe(a);v!==a&&k(a,{relatedTarget:v})},[t,E,$,i]);const B=te(t,l.onKeyDownCapture,I),R=te(t,l.onKeyUpCapture,I),T=l.onFocusCapture,H=W(r=>{if(T==null||T(r),r.defaultPrevented||!t)return;const{virtualFocus:a}=t.getState();if(!a)return;const m=r.relatedTarget,v=_e(r.currentTarget);A(r)&&v&&(r.stopPropagation(),I.current=m)}),D=l.onFocus,h=W(r=>{if(D==null||D(r),r.defaultPrevented||!i||!t)return;const{relatedTarget:a}=r,{virtualFocus:m}=t.getState();m?A(r)&&!G(t,a)&&queueMicrotask(O):A(r)&&t.setActiveId(null)}),M=l.onBlurCapture,j=W(r=>{var a;if(M==null||M(r),r.defaultPrevented||!t)return;const{virtualFocus:m,activeId:v}=t.getState();if(!m)return;const S=(a=P(t,v))==null?void 0:a.element,b=r.relatedTarget,d=G(t,b),g=I.current;I.current=null,A(r)&&d?(b===S?g&&g!==b&&k(g,r):S?k(S,r):g&&k(g,r),r.stopPropagation()):!G(t,r.target)&&S&&k(S,r)}),N=l.onKeyDown,f=Ee(o),C=W(r=>{var a;if(N==null||N(r),r.defaultPrevented||!t||!A(r))return;const{orientation:m,renderedItems:v,activeId:S}=t.getState(),b=P(t,S);if((a=b==null?void 0:b.element)!=null&&a.isConnected)return;const d=m!=="horizontal",g=m!=="vertical",x=Ve(v);if((r.key==="ArrowLeft"||r.key==="ArrowRight"||r.key==="Home"||r.key==="End")&&re(r.currentTarget))return;const X={ArrowUp:(x||d)&&(()=>{if(x){const z=qe(v);return z==null?void 0:z.id}return t==null?void 0:t.last()}),ArrowRight:(x||g)&&t.first,ArrowDown:(x||d)&&t.first,ArrowLeft:(x||g)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[r.key];if(X){const z=X();if(z!==void 0){if(!f(r))return;r.preventDefault(),t.move(z)}}});l=ye(l,r=>Be.jsx(Pe,{value:t,children:r}),[t]);const V=t.useState(r=>{var a;if(t&&i&&r.virtualFocus)return(a=P(t,r.activeId))==null?void 0:a.id});l=we(J({"aria-activedescendant":V},l),{ref:he(w,L,l.ref),onKeyDownCapture:B,onKeyUpCapture:R,onFocusCapture:H,onFocus:h,onBlurCapture:j,onKeyDown:C});const q=t.useState(r=>i&&(r.virtualFocus||r.activeId===null));return l=Le(J({focusable:q},l)),l}),ut=Ie(function(s){const n=Ye(s);return be(Ne,n)});export{ut as C,Ye as a,rt as b,Oe as c,He as u};

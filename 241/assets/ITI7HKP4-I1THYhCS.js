import{t as ce,c as J,s as j,i as de,e as ee,b as R,a as fe}from"./YV4JVR4I-4HWP-MUd.js";import{y as _,x as q,M as me,z as T,n as ve,s as Ie,B as ge,c as Se,_ as oe,i as pe,N as Ee,O as te,P as O,Q as ye,j as U,p as z,h as we,o as ie,t as be,d as he,u as xe,a as ne,f as Pe,b as _e,R as Fe}from"./LMDWO4NN-BgR1V2pT.js";import{e as Ce,g as M,s as Ae,i as Y,a as ke,h as Re,j as Be}from"./P2CTZE2T-8JhrgbZX.js";import{f as Ke,a as Le,u as Me}from"./LVA2YJMS-C3tP3Dgo.js";import{a as W,n as Te}from"./chunk-K6AXKMTT-BRQUd1RA.js";function De(e){var o;const n=e.find(l=>!!l.element),t=[...e].reverse().find(l=>!!l.element);let i=(o=n==null?void 0:n.element)==null?void 0:o.parentElement;for(;i&&(t!=null&&t.element);){if(t&&i.contains(t.element))return i;i=i.parentElement}return ve(i).body}function Oe(e){return e==null?void 0:e.__unstablePrivateStore}function ze(e={}){var o;ce(e,e.store);const n=(o=e.store)==null?void 0:o.getState(),t=_(e.items,n==null?void 0:n.items,e.defaultItems,[]),i=new Map(t.map(a=>[a.id,a])),l={items:t,renderedItems:_(n==null?void 0:n.renderedItems,[])},c=Oe(e.store),u=J({items:t,renderedItems:l.renderedItems},c),r=J(l,e.store),x=a=>{const f=Ie(a,m=>m.element);u.setState("renderedItems",f),r.setState("renderedItems",f)};j(r,()=>de(u)),j(u,()=>ee(u,["items"],a=>{r.setState("items",a.items)})),j(u,()=>ee(u,["renderedItems"],a=>{let f=!0,m=requestAnimationFrame(()=>{const{renderedItems:S}=r.getState();a.renderedItems!==S&&x(a.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(m);const w=()=>{if(f){f=!1;return}cancelAnimationFrame(m),m=requestAnimationFrame(()=>x(a.renderedItems))},K=De(a.renderedItems),g=new IntersectionObserver(w,{root:K});for(const S of a.renderedItems)S.element&&g.observe(S.element);return()=>{cancelAnimationFrame(m),g.disconnect()}}));const I=(a,f,m=!1)=>{let w;return f(g=>{const S=g.findIndex(({id:b})=>b===a.id),F=g.slice();if(S!==-1){w=g[S];const b=T(T({},w),a);F[S]=b,i.set(a.id,b)}else F.push(a),i.set(a.id,a);return F}),()=>{f(g=>{if(!w)return m&&i.delete(a.id),g.filter(({id:b})=>b!==a.id);const S=g.findIndex(({id:b})=>b===a.id);if(S===-1)return g;const F=g.slice();return F[S]=w,i.set(a.id,w),F})}},L=a=>I(a,f=>u.setState("items",f),!0);return q(T({},r),{registerItem:L,renderItem:a=>me(L(a),I(a,f=>u.setState("renderedItems",f))),item:a=>{if(!a)return null;let f=i.get(a);if(!f){const{items:m}=u.getState();f=m.find(w=>w.id===a),f&&i.set(a,f)}return f||null},__unstablePrivateStore:u})}function We(e,o,n){return ge(o,[n.store]),R(e,n,"items","setItems"),e}function ae(e){const o=[];for(const n of e)o.push(...n);return o}function X(e){return e.slice().reverse()}var He={id:null};function B(e,o){return e.find(n=>o?!n.disabled&&n.id!==o:!n.disabled)}function Ne(e,o){return e.filter(n=>o?!n.disabled&&n.id!==o:!n.disabled)}function re(e,o){return e.filter(n=>n.rowId===o)}function Ue(e,o,n=!1){const t=e.findIndex(i=>i.id===o);return[...e.slice(t+1),...n?[He]:[],...e.slice(0,t)]}function ue(e){const o=[];for(const n of e){const t=o.find(i=>{var l;return((l=i[0])==null?void 0:l.rowId)===n.rowId});t?t.push(n):o.push([n])}return o}function le(e){let o=0;for(const{length:n}of e)n>o&&(o=n);return o}function Ve(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function $e(e,o,n){const t=le(e);for(const i of e)for(let l=0;l<t;l+=1){const c=i[l];if(!c||n&&c.disabled){const r=l===0&&n?B(i):i[l-1];i[l]=r&&o!==r.id&&n?r:Ve(r==null?void 0:r.rowId)}}return e}function je(e){const o=ue(e),n=le(o),t=[];for(let i=0;i<n;i+=1)for(const l of o){const c=l[i];c&&t.push(q(T({},c),{rowId:c.rowId?`${i}`:void 0}))}return t}function ut(e={}){var o;const n=(o=e.store)==null?void 0:o.getState(),t=ze(e),i=_(e.activeId,n==null?void 0:n.activeId,e.defaultActiveId),l=q(T({},t.getState()),{id:_(e.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:i,baseElement:_(n==null?void 0:n.baseElement,null),includesBaseElement:_(e.includesBaseElement,n==null?void 0:n.includesBaseElement,i===null),moves:_(n==null?void 0:n.moves,0),orientation:_(e.orientation,n==null?void 0:n.orientation,"both"),rtl:_(e.rtl,n==null?void 0:n.rtl,!1),virtualFocus:_(e.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:_(e.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:_(e.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:_(e.focusShift,n==null?void 0:n.focusShift,!1)}),c=J(l,t,e.store);j(c,()=>fe(c,["renderedItems","activeId"],r=>{c.setState("activeId",x=>{var I;return x!==void 0?x:(I=B(r.renderedItems))==null?void 0:I.id})}));const u=(r="next",x={})=>{var I,L;const a=c.getState(),{skip:f=0,activeId:m=a.activeId,focusShift:w=a.focusShift,focusLoop:K=a.focusLoop,focusWrap:g=a.focusWrap,includesBaseElement:S=a.includesBaseElement,renderedItems:F=a.renderedItems,rtl:b=a.rtl}=x,C=r==="up"||r==="down",H=r==="next"||r==="down",G=H?b&&!C:!b||C,V=w&&!f;let p=C?ae($e(ue(F),m,V)):F;if(p=G?X(p):p,p=C?je(p):p,m==null)return(I=B(p))==null?void 0:I.id;const D=p.find(v=>v.id===m);if(!D)return(L=B(p))==null?void 0:L.id;const $=p.some(v=>v.rowId),Q=p.indexOf(D),s=p.slice(Q+1),d=re(s,D.rowId);if(f){const v=Ne(d,m),h=v.slice(f)[0]||v[v.length-1];return h==null?void 0:h.id}const E=K&&(C?K!=="horizontal":K!=="vertical"),y=$&&g&&(C?g!=="horizontal":g!=="vertical"),P=H?(!$||C)&&E&&S:C?S:!1;if(E){const v=y&&!P?p:re(p,D.rowId),h=Ue(v,m,P),k=B(h,m);return k==null?void 0:k.id}if(y){const v=B(P?d:s,m);return P?(v==null?void 0:v.id)||null:v==null?void 0:v.id}const A=B(d,m);return!A&&P?null:A==null?void 0:A.id};return q(T(T({},t),c),{setBaseElement:r=>c.setState("baseElement",r),setActiveId:r=>c.setState("activeId",r),move:r=>{r!==void 0&&(c.setState("activeId",r),c.setState("moves",x=>x+1))},first:()=>{var r;return(r=B(c.getState().renderedItems))==null?void 0:r.id},last:()=>{var r;return(r=B(X(c.getState().renderedItems)))==null?void 0:r.id},next:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("next",r)),previous:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("previous",r)),down:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("down",r)),up:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("up",r))})}function lt(e,o,n){return e=We(e,o,n),R(e,n,"activeId","setActiveId"),R(e,n,"includesBaseElement"),R(e,n,"virtualFocus"),R(e,n,"orientation"),R(e,n,"rtl"),R(e,n,"focusLoop"),R(e,n,"focusWrap"),R(e,n,"focusShift"),e}var qe="div";function Ge(e){return e.some(o=>!!o.rowId)}function Qe(e){const o=e.target;return o&&!ie(o)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function Ye(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function se(e,o,n){return U(t=>{var i;if(o==null||o(t),t.defaultPrevented||t.isPropagationStopped()||!z(t)||Ye(t)||Qe(t))return;const l=e.getState(),c=(i=M(e,l.activeId))==null?void 0:i.element;if(!c)return;const u=t,r=oe(u,["view"]),x=n==null?void 0:n.current;c!==x&&c.focus(),Fe(c,t.type,r)||t.preventDefault(),t.currentTarget.contains(c)&&t.stopPropagation()})}function Je(e){return Re(ae(X(Be(e))))}function Xe(e){const[o,n]=W.useState(!1),t=W.useCallback(()=>n(!0),[]),i=e.useState(l=>M(e,l.activeId));return W.useEffect(()=>{const l=i==null?void 0:i.element;o&&l&&(n(!1),l.focus({preventScroll:!0}))},[i,o]),t}var Ze=Se(function(o){var n=o,{store:t,composite:i=!0,focusOnMove:l=i,moveOnKeyPress:c=!0}=n,u=oe(n,["store","composite","focusOnMove","moveOnKeyPress"]);const r=Ce();t=t||r,pe(t,!1);const x=W.useRef(null),I=W.useRef(null),L=Xe(t),a=t.useState("moves"),[,f]=Ee(i?t.setBaseElement:null);W.useEffect(()=>{var s;if(!t||!a||!i||!l)return;const{activeId:d}=t.getState(),E=(s=M(t,d))==null?void 0:s.element;E&&Ke(E)},[t,a,i,l]),te(()=>{if(!t||!a||!i)return;const{baseElement:s,activeId:d}=t.getState();if(!(d===null)||!s)return;const y=I.current;I.current=null,y&&O(y,{relatedTarget:s}),Le(s)||s.focus()},[t,a,i]);const m=t.useState("activeId"),w=t.useState("virtualFocus");te(()=>{var s;if(!t||!i||!w)return;const d=I.current;if(I.current=null,!d)return;const y=((s=M(t,m))==null?void 0:s.element)||ye(d);y!==d&&O(d,{relatedTarget:y})},[t,m,w,i]);const K=se(t,u.onKeyDownCapture,I),g=se(t,u.onKeyUpCapture,I),S=u.onFocusCapture,F=U(s=>{if(S==null||S(s),s.defaultPrevented||!t)return;const{virtualFocus:d}=t.getState();if(!d)return;const E=s.relatedTarget,y=Ae(s.currentTarget);z(s)&&y&&(s.stopPropagation(),I.current=E)}),b=u.onFocus,C=U(s=>{if(b==null||b(s),s.defaultPrevented||!i||!t)return;const{relatedTarget:d}=s,{virtualFocus:E}=t.getState();E?z(s)&&!Y(t,d)&&queueMicrotask(L):z(s)&&t.setActiveId(null)}),H=u.onBlurCapture,G=U(s=>{var d;if(H==null||H(s),s.defaultPrevented||!t)return;const{virtualFocus:E,activeId:y}=t.getState();if(!E)return;const P=(d=M(t,y))==null?void 0:d.element,A=s.relatedTarget,v=Y(t,A),h=I.current;I.current=null,z(s)&&v?(A===P?h&&h!==A&&O(h,s):P?O(P,s):h&&O(h,s),s.stopPropagation()):!Y(t,s.target)&&P&&O(P,s)}),V=u.onKeyDown,p=we(c),D=U(s=>{var d;if(V==null||V(s),s.defaultPrevented||!t||!z(s))return;const{orientation:E,renderedItems:y,activeId:P}=t.getState(),A=M(t,P);if((d=A==null?void 0:A.element)!=null&&d.isConnected)return;const v=E!=="horizontal",h=E!=="vertical",k=Ge(y);if((s.key==="ArrowLeft"||s.key==="ArrowRight"||s.key==="Home"||s.key==="End")&&ie(s.currentTarget))return;const Z={ArrowUp:(k||v)&&(()=>{if(k){const N=Je(y);return N==null?void 0:N.id}return t==null?void 0:t.last()}),ArrowRight:(k||h)&&t.first,ArrowDown:(k||v)&&t.first,ArrowLeft:(k||h)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[s.key];if(Z){const N=Z();if(N!==void 0){if(!p(s))return;s.preventDefault(),t.move(N)}}});u=be(u,s=>Te.jsx(ke,{value:t,children:s}),[t]);const $=t.useState(s=>{var d;if(t&&i&&s.virtualFocus)return(d=M(t,s.activeId))==null?void 0:d.id});u=he(ne({"aria-activedescendant":$},u),{ref:xe(x,f,u.ref),onKeyDownCapture:K,onKeyUpCapture:g,onFocusCapture:F,onFocus:C,onBlurCapture:G,onKeyDown:D});const Q=t.useState(s=>i&&(s.virtualFocus||s.activeId===null));return u=Me(ne({focusable:Q},u)),u});Pe(function(o){const n=Ze(o);return _e(qe,n)});export{Ze as a,ze as b,ut as c,lt as u};

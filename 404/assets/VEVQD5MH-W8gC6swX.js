import{c as ce,a as le}from"./C3IKGW5T-DvasUfDp.js";import{c as de,s as fe,a as ve,d as me,e as F}from"./YV4JVR4I-DscRzu5f.js";import{J as x,I as J,K as U,v as Ie,o as Y,l as pe,m as Se,n as ge,_ as re,O as Ee,ap as xe,aq as ye,a3 as Z,ar as A,ai as we,as as Ce,B as O,a9 as K,ah as Pe,a8 as ne,P as be,D as he,E as Fe,S as _e,at as ke,r as Ae}from"./~utils-CVrIWKd_.js";import{d as Ke,g as _,s as Be,i as G,a as oe,e as Le,h as Re,C as Te}from"./P2CTZE2T-Wt7VrJxp.js";import{b as h,p as De}from"./index-DDCMeoDP.js";import{P as Me,a as ze}from"./MTZPJQMC-BF1USmkC.js";function se(e){const s=[];for(const r of e)s.push(...r);return s}function Q(e){return e.slice().reverse()}var Oe={id:null};function b(e,s){return e.find(r=>s?!r.disabled&&r.id!==s:!r.disabled)}function We(e,s){return e.filter(r=>s?!r.disabled&&r.id!==s:!r.disabled)}function ee(e,s){return e.filter(r=>r.rowId===s)}function He(e,s,r=!1){const t=e.findIndex(i=>i.id===s);return[...e.slice(t+1),...r?[Oe]:[],...e.slice(0,t)]}function ie(e){const s=[];for(const r of e){const t=s.find(i=>{var c;return((c=i[0])==null?void 0:c.rowId)===r.rowId});t?t.push(r):s.push([r])}return s}function ae(e){let s=0;for(const{length:r}of e)r>s&&(s=r);return s}function Ve(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function $e(e,s,r){const t=ae(e);for(const i of e)for(let c=0;c<t;c+=1){const a=i[c];if(!a||r&&a.disabled){const o=c===0&&r?b(i):i[c-1];i[c]=o&&s!==o.id&&r?o:Ve(o==null?void 0:o.rowId)}}return e}function Ne(e){const s=ie(e),r=ae(s),t=[];for(let i=0;i<r;i+=1)for(const c of s){const a=c[i];a&&t.push(J(U({},a),{rowId:a.rowId?`${i}`:void 0}))}return t}function Ue(e={}){var s;const r=(s=e.store)==null?void 0:s.getState(),t=ce(e),i=x(e.activeId,r==null?void 0:r.activeId,e.defaultActiveId),c=J(U({},t.getState()),{id:x(e.id,r==null?void 0:r.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:i,baseElement:x(r==null?void 0:r.baseElement,null),includesBaseElement:x(e.includesBaseElement,r==null?void 0:r.includesBaseElement,i===null),moves:x(r==null?void 0:r.moves,0),orientation:x(e.orientation,r==null?void 0:r.orientation,"both"),rtl:x(e.rtl,r==null?void 0:r.rtl,!1),virtualFocus:x(e.virtualFocus,r==null?void 0:r.virtualFocus,!1),focusLoop:x(e.focusLoop,r==null?void 0:r.focusLoop,!1),focusWrap:x(e.focusWrap,r==null?void 0:r.focusWrap,!1),focusShift:x(e.focusShift,r==null?void 0:r.focusShift,!1)}),a=de(c,t,e.store);fe(a,()=>ve(a,["renderedItems","activeId"],o=>{a.setState("activeId",y=>{var f;return y!==void 0?y:(f=b(o.renderedItems))==null?void 0:f.id})}));const l=(o="next",y={})=>{var f,W;const g=a.getState(),{skip:B=0,activeId:E=g.activeId,focusShift:H=g.focusShift,focusLoop:L=g.focusLoop,focusWrap:R=g.focusWrap,includesBaseElement:T=g.includesBaseElement,renderedItems:V=g.renderedItems,rtl:D=g.rtl}=y,w=o==="up"||o==="down",M=o==="next"||o==="down",j=M?D&&!w:!D||w,$=H&&!B;let v=w?se($e(ie(V),E,$)):V;if(v=j?Q(v):v,v=w?Ne(v):v,E==null)return(f=b(v))==null?void 0:f.id;const k=v.find(d=>d.id===E);if(!k)return(W=b(v))==null?void 0:W.id;const N=v.some(d=>d.rowId),q=v.indexOf(k),n=v.slice(q+1),u=ee(n,k.rowId);if(B){const d=We(u,E),p=d.slice(B)[0]||d[d.length-1];return p==null?void 0:p.id}const m=L&&(w?L!=="horizontal":L!=="vertical"),I=N&&R&&(w?R!=="horizontal":R!=="vertical"),S=M?(!N||w)&&m&&T:w?T:!1;if(m){const d=I&&!S?v:ee(v,k.rowId),p=He(d,E,S),P=b(p,E);return P==null?void 0:P.id}if(I){const d=b(S?u:n,E);return S?(d==null?void 0:d.id)||null:d==null?void 0:d.id}const C=b(u,E);return!C&&S?null:C==null?void 0:C.id};return J(U(U({},t),a),{setBaseElement:o=>a.setState("baseElement",o),setActiveId:o=>a.setState("activeId",o),move:o=>{o!==void 0&&(a.setState("activeId",o),a.setState("moves",y=>y+1))},first:()=>{var o;return(o=b(a.getState().renderedItems))==null?void 0:o.id},last:()=>{var o;return(o=b(Q(a.getState().renderedItems)))==null?void 0:o.id},next:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("next",o)),previous:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("previous",o)),down:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("down",o)),up:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("up",o))})}function je(e){const s=Ie(e.id);return Y({id:s},e)}function qe(e,s,r){return e=le(e,s,r),F(e,r,"activeId","setActiveId"),F(e,r,"includesBaseElement"),F(e,r,"virtualFocus"),F(e,r,"orientation"),F(e,r,"rtl"),F(e,r,"focusLoop"),F(e,r,"focusWrap"),F(e,r,"focusShift"),e}function lt(e={}){e=je(e);const[s,r]=me(Ue,e);return qe(s,r,e)}var Ge="div";function Je(e){return e.some(s=>!!s.rowId)}function Ye(e){const s=e.target;return s&&!ne(s)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function Qe(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function te(e,s,r){return O(t=>{var i;if(s==null||s(t),t.defaultPrevented||t.isPropagationStopped()||!K(t)||Qe(t)||Ye(t))return;const c=e.getState(),a=(i=_(e,c.activeId))==null?void 0:i.element;if(!a)return;const l=t,{view:o}=l,y=re(l,["view"]),f=r==null?void 0:r.current;a!==f&&a.focus(),ke(a,t.type,y)||t.preventDefault(),t.currentTarget.contains(a)&&t.stopPropagation()})}function Xe(e){return Le(se(Q(Re(e))))}function Ze(e){const[s,r]=h.useState(!1),t=h.useCallback(()=>r(!0),[]),i=e.useState(c=>_(e,c.activeId));return h.useEffect(()=>{const c=i==null?void 0:i.element;s&&c&&(r(!1),c.focus({preventScroll:!0}))},[i,s]),t}var et=Se(function(s){var r=s,{store:t,composite:i=!0,focusOnMove:c=i,moveOnKeyPress:a=!0}=r,l=re(r,["store","composite","focusOnMove","moveOnKeyPress"]);const o=Ke();t=t||o,Ee(t,!1);const y=h.useRef(null),f=h.useRef(null),W=Ze(t),g=t.useState("moves"),[,B]=xe(i?t.setBaseElement:null);h.useEffect(()=>{var n;if(!t||!g||!i||!c)return;const{activeId:u}=t.getState(),m=(n=_(t,u))==null?void 0:n.element;m&&ye(m)},[t,g,i,c]),Z(()=>{if(!t||!g||!i)return;const{baseElement:n,activeId:u}=t.getState();if(!(u===null)||!n)return;const I=f.current;f.current=null,I&&A(I,{relatedTarget:n}),we(n)||n.focus()},[t,g,i]);const E=t.useState("activeId"),H=t.useState("virtualFocus");Z(()=>{var n;if(!t||!i||!H)return;const u=f.current;if(f.current=null,!u)return;const I=((n=_(t,E))==null?void 0:n.element)||Ce(u);I!==u&&A(u,{relatedTarget:I})},[t,E,H,i]);const L=te(t,l.onKeyDownCapture,f),R=te(t,l.onKeyUpCapture,f),T=l.onFocusCapture,V=O(n=>{if(T==null||T(n),n.defaultPrevented||!t)return;const{virtualFocus:u}=t.getState();if(!u)return;const m=n.relatedTarget,I=Be(n.currentTarget);K(n)&&I&&(n.stopPropagation(),f.current=m)}),D=l.onFocus,w=O(n=>{if(D==null||D(n),n.defaultPrevented||!i||!t)return;const{relatedTarget:u}=n,{virtualFocus:m}=t.getState();m?K(n)&&!G(t,u)&&queueMicrotask(W):K(n)&&t.setActiveId(null)}),M=l.onBlurCapture,j=O(n=>{var u;if(M==null||M(n),n.defaultPrevented||!t)return;const{virtualFocus:m,activeId:I}=t.getState();if(!m)return;const S=(u=_(t,I))==null?void 0:u.element,C=n.relatedTarget,d=G(t,C),p=f.current;f.current=null,K(n)&&d?(C===S?p&&p!==C&&A(p,n):S?A(S,n):p&&A(p,n),n.stopPropagation()):!G(t,n.target)&&S&&A(S,n)}),$=l.onKeyDown,v=Pe(a),k=O(n=>{var u;if($==null||$(n),n.defaultPrevented||!t||!K(n))return;const{orientation:m,renderedItems:I,activeId:S}=t.getState(),C=_(t,S);if((u=C==null?void 0:C.element)!=null&&u.isConnected)return;const d=m!=="horizontal",p=m!=="vertical",P=Je(I);if((n.key==="ArrowLeft"||n.key==="ArrowRight"||n.key==="Home"||n.key==="End")&&ne(n.currentTarget))return;const X={ArrowUp:(P||d)&&(()=>{if(P){const z=Xe(I);return z==null?void 0:z.id}return t==null?void 0:t.last()}),ArrowRight:(P||p)&&t.first,ArrowDown:(P||d)&&t.first,ArrowLeft:(P||p)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[n.key];if(X){const z=X();if(z!==void 0){if(!v(n))return;n.preventDefault(),t.move(z)}}});l=be(l,n=>De.jsx(oe,{value:t,children:n}),[t]);const N=t.useState(n=>{var u;if(t&&i&&n.virtualFocus)return(u=_(t,n.activeId))==null?void 0:u.id});l=he(Y({"aria-activedescendant":N},l),{ref:Fe(y,B,l.ref),onKeyDownCapture:L,onKeyUpCapture:R,onFocusCapture:V,onFocus:w,onBlurCapture:j,onKeyDown:k});const q=t.useState(n=>i&&(n.virtualFocus||n.activeId===null));return l=_e(Y({focusable:q},l)),l}),dt=pe(function(s){const r=et(s);return ge(Ge,r)});h.createContext(void 0);var ue=Ae([ze,oe],[Me,Te]),ft=ue.useContext,vt=ue.useProviderContext;h.createContext(void 0);h.createContext(!1);export{dt as C,qe as a,et as b,Ue as c,vt as d,lt as e,ft as u};

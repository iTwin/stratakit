import{t as ce,c as J,s as j,i as de,e as ee,b as B,d as fe}from"./YV4JVR4I-BV4I9HSm.js";import{y as _,z as q,T as me,A as D,C as Ie,D as ve,B as ge,c as Se,_ as ie,p as pe,U as Ee,V as te,W as O,X as ye,l as V,F as z,t as we,E as ue,H as be,m as he,n as xe,b as ne,d as Fe,e as _e,Y as Pe}from"./~utils-xLD3FaGQ.js";import{e as Ce,g as T,s as Ae,i as X,a as ke,h as Be,j as Re}from"./P2CTZE2T-B8wURyrt.js";import{f as Ke,a as Le,u as Te}from"./LVA2YJMS-_xrT3fTV.js";import{a as W,n as De}from"./chunk-K6AXKMTT-B_QCnNdX.js";function Me(e){var i;const n=e.find(l=>!!l.element),t=[...e].reverse().find(l=>!!l.element);let u=(i=n==null?void 0:n.element)==null?void 0:i.parentElement;for(;u&&(t!=null&&t.element);){if(t&&u.contains(t.element))return u;u=u.parentElement}return Ie(u).body}function Oe(e){return e==null?void 0:e.__unstablePrivateStore}function ze(e={}){var i;ce(e,e.store);const n=(i=e.store)==null?void 0:i.getState(),t=_(e.items,n==null?void 0:n.items,e.defaultItems,[]),u=new Map(t.map(o=>[o.id,o])),l={items:t,renderedItems:_(n==null?void 0:n.renderedItems,[])},c=Oe(e.store),a=J({items:t,renderedItems:l.renderedItems},c),r=J(l,e.store),x=o=>{const f=ve(o,m=>m.element);a.setState("renderedItems",f),r.setState("renderedItems",f)};j(r,()=>de(a)),j(a,()=>ee(a,["items"],o=>{r.setState("items",o.items)})),j(a,()=>ee(a,["renderedItems"],o=>{let f=!0,m=requestAnimationFrame(()=>{const{renderedItems:S}=r.getState();o.renderedItems!==S&&x(o.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(m);const w=()=>{if(f){f=!1;return}cancelAnimationFrame(m),m=requestAnimationFrame(()=>x(o.renderedItems))},K=Me(o.renderedItems),g=new IntersectionObserver(w,{root:K});for(const S of o.renderedItems)S.element&&g.observe(S.element);return()=>{cancelAnimationFrame(m),g.disconnect()}}));const v=(o,f,m=!1)=>{let w;return f(g=>{const S=g.findIndex(({id:b})=>b===o.id),P=g.slice();if(S!==-1){w=g[S];const b=D(D({},w),o);P[S]=b,u.set(o.id,b)}else P.push(o),u.set(o.id,o);return P}),()=>{f(g=>{if(!w)return m&&u.delete(o.id),g.filter(({id:b})=>b!==o.id);const S=g.findIndex(({id:b})=>b===o.id);if(S===-1)return g;const P=g.slice();return P[S]=w,u.set(o.id,w),P})}},L=o=>v(o,f=>a.setState("items",f),!0);return q(D({},r),{registerItem:L,renderItem:o=>me(L(o),v(o,f=>a.setState("renderedItems",f))),item:o=>{if(!o)return null;let f=u.get(o);if(!f){const{items:m}=a.getState();f=m.find(w=>w.id===o),f&&u.set(o,f)}return f||null},__unstablePrivateStore:a})}function We(e,i,n){return ge(i,[n.store]),B(e,n,"items","setItems"),e}function oe(e){const i=[];for(const n of e)i.push(...n);return i}function Q(e){return e.slice().reverse()}var He={id:null};function R(e,i){return e.find(n=>i?!n.disabled&&n.id!==i:!n.disabled)}function Ue(e,i){return e.filter(n=>i?!n.disabled&&n.id!==i:!n.disabled)}function re(e,i){return e.filter(n=>n.rowId===i)}function Ve(e,i,n=!1){const t=e.findIndex(u=>u.id===i);return[...e.slice(t+1),...n?[He]:[],...e.slice(0,t)]}function ae(e){const i=[];for(const n of e){const t=i.find(u=>{var l;return((l=u[0])==null?void 0:l.rowId)===n.rowId});t?t.push(n):i.push([n])}return i}function le(e){let i=0;for(const{length:n}of e)n>i&&(i=n);return i}function $e(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function Ne(e,i,n){const t=le(e);for(const u of e)for(let l=0;l<t;l+=1){const c=u[l];if(!c||n&&c.disabled){const r=l===0&&n?R(u):u[l-1];u[l]=r&&i!==r.id&&n?r:$e(r==null?void 0:r.rowId)}}return e}function je(e){const i=ae(e),n=le(i),t=[];for(let u=0;u<n;u+=1)for(const l of i){const c=l[u];c&&t.push(q(D({},c),{rowId:c.rowId?`${u}`:void 0}))}return t}function at(e={}){var i;const n=(i=e.store)==null?void 0:i.getState(),t=ze(e),u=_(e.activeId,n==null?void 0:n.activeId,e.defaultActiveId),l=q(D({},t.getState()),{id:_(e.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:u,baseElement:_(n==null?void 0:n.baseElement,null),includesBaseElement:_(e.includesBaseElement,n==null?void 0:n.includesBaseElement,u===null),moves:_(n==null?void 0:n.moves,0),orientation:_(e.orientation,n==null?void 0:n.orientation,"both"),rtl:_(e.rtl,n==null?void 0:n.rtl,!1),virtualFocus:_(e.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:_(e.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:_(e.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:_(e.focusShift,n==null?void 0:n.focusShift,!1)}),c=J(l,t,e.store);j(c,()=>fe(c,["renderedItems","activeId"],r=>{c.setState("activeId",x=>{var v;return x!==void 0?x:(v=R(r.renderedItems))==null?void 0:v.id})}));const a=(r="next",x={})=>{var v,L;const o=c.getState(),{skip:f=0,activeId:m=o.activeId,focusShift:w=o.focusShift,focusLoop:K=o.focusLoop,focusWrap:g=o.focusWrap,includesBaseElement:S=o.includesBaseElement,renderedItems:P=o.renderedItems,rtl:b=o.rtl}=x,C=r==="up"||r==="down",H=r==="next"||r==="down",G=H?b&&!C:!b||C,$=w&&!f;let p=C?oe(Ne(ae(P),m,$)):P;if(p=G?Q(p):p,p=C?je(p):p,m==null)return(v=R(p))==null?void 0:v.id;const M=p.find(I=>I.id===m);if(!M)return(L=R(p))==null?void 0:L.id;const N=p.some(I=>I.rowId),Y=p.indexOf(M),s=p.slice(Y+1),d=re(s,M.rowId);if(f){const I=Ue(d,m),h=I.slice(f)[0]||I[I.length-1];return h==null?void 0:h.id}const E=K&&(C?K!=="horizontal":K!=="vertical"),y=N&&g&&(C?g!=="horizontal":g!=="vertical"),F=H?(!N||C)&&E&&S:C?S:!1;if(E){const I=y&&!F?p:re(p,M.rowId),h=Ve(I,m,F),k=R(h,m);return k==null?void 0:k.id}if(y){const I=R(F?d:s,m);return F?(I==null?void 0:I.id)||null:I==null?void 0:I.id}const A=R(d,m);return!A&&F?null:A==null?void 0:A.id};return q(D(D({},t),c),{setBaseElement:r=>c.setState("baseElement",r),setActiveId:r=>c.setState("activeId",r),move:r=>{r!==void 0&&(c.setState("activeId",r),c.setState("moves",x=>x+1))},first:()=>{var r;return(r=R(c.getState().renderedItems))==null?void 0:r.id},last:()=>{var r;return(r=R(Q(c.getState().renderedItems)))==null?void 0:r.id},next:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("next",r)),previous:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("previous",r)),down:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("down",r)),up:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("up",r))})}function lt(e,i,n){return e=We(e,i,n),B(e,n,"activeId","setActiveId"),B(e,n,"includesBaseElement"),B(e,n,"virtualFocus"),B(e,n,"orientation"),B(e,n,"rtl"),B(e,n,"focusLoop"),B(e,n,"focusWrap"),B(e,n,"focusShift"),e}var qe="div";function Ge(e){return e.some(i=>!!i.rowId)}function Ye(e){const i=e.target;return i&&!ue(i)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function Xe(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function se(e,i,n){return V(t=>{var u;if(i==null||i(t),t.defaultPrevented||t.isPropagationStopped()||!z(t)||Xe(t)||Ye(t))return;const l=e.getState(),c=(u=T(e,l.activeId))==null?void 0:u.element;if(!c)return;const a=t,r=ie(a,["view"]),x=n==null?void 0:n.current;c!==x&&c.focus(),Pe(c,t.type,r)||t.preventDefault(),t.currentTarget.contains(c)&&t.stopPropagation()})}function Je(e){return Be(oe(Q(Re(e))))}function Qe(e){const[i,n]=W.useState(!1),t=W.useCallback(()=>n(!0),[]),u=e.useState(l=>T(e,l.activeId));return W.useEffect(()=>{const l=u==null?void 0:u.element;i&&l&&(n(!1),l.focus({preventScroll:!0}))},[u,i]),t}var Ze=Se(function(i){var n=i,{store:t,composite:u=!0,focusOnMove:l=u,moveOnKeyPress:c=!0}=n,a=ie(n,["store","composite","focusOnMove","moveOnKeyPress"]);const r=Ce();t=t||r,pe(t,!1);const x=W.useRef(null),v=W.useRef(null),L=Qe(t),o=t.useState("moves"),[,f]=Ee(u?t.setBaseElement:null);W.useEffect(()=>{var s;if(!t||!o||!u||!l)return;const{activeId:d}=t.getState(),E=(s=T(t,d))==null?void 0:s.element;E&&Ke(E)},[t,o,u,l]),te(()=>{if(!t||!o||!u)return;const{baseElement:s,activeId:d}=t.getState();if(!(d===null)||!s)return;const y=v.current;v.current=null,y&&O(y,{relatedTarget:s}),Le(s)||s.focus()},[t,o,u]);const m=t.useState("activeId"),w=t.useState("virtualFocus");te(()=>{var s;if(!t||!u||!w)return;const d=v.current;if(v.current=null,!d)return;const y=((s=T(t,m))==null?void 0:s.element)||ye(d);y!==d&&O(d,{relatedTarget:y})},[t,m,w,u]);const K=se(t,a.onKeyDownCapture,v),g=se(t,a.onKeyUpCapture,v),S=a.onFocusCapture,P=V(s=>{if(S==null||S(s),s.defaultPrevented||!t)return;const{virtualFocus:d}=t.getState();if(!d)return;const E=s.relatedTarget,y=Ae(s.currentTarget);z(s)&&y&&(s.stopPropagation(),v.current=E)}),b=a.onFocus,C=V(s=>{if(b==null||b(s),s.defaultPrevented||!u||!t)return;const{relatedTarget:d}=s,{virtualFocus:E}=t.getState();E?z(s)&&!X(t,d)&&queueMicrotask(L):z(s)&&t.setActiveId(null)}),H=a.onBlurCapture,G=V(s=>{var d;if(H==null||H(s),s.defaultPrevented||!t)return;const{virtualFocus:E,activeId:y}=t.getState();if(!E)return;const F=(d=T(t,y))==null?void 0:d.element,A=s.relatedTarget,I=X(t,A),h=v.current;v.current=null,z(s)&&I?(A===F?h&&h!==A&&O(h,s):F?O(F,s):h&&O(h,s),s.stopPropagation()):!X(t,s.target)&&F&&O(F,s)}),$=a.onKeyDown,p=we(c),M=V(s=>{var d;if($==null||$(s),s.defaultPrevented||!t||!z(s))return;const{orientation:E,renderedItems:y,activeId:F}=t.getState(),A=T(t,F);if((d=A==null?void 0:A.element)!=null&&d.isConnected)return;const I=E!=="horizontal",h=E!=="vertical",k=Ge(y);if((s.key==="ArrowLeft"||s.key==="ArrowRight"||s.key==="Home"||s.key==="End")&&ue(s.currentTarget))return;const Z={ArrowUp:(k||I)&&(()=>{if(k){const U=Je(y);return U==null?void 0:U.id}return t==null?void 0:t.last()}),ArrowRight:(k||h)&&t.first,ArrowDown:(k||I)&&t.first,ArrowLeft:(k||h)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[s.key];if(Z){const U=Z();if(U!==void 0){if(!p(s))return;s.preventDefault(),t.move(U)}}});a=be(a,s=>De.jsx(ke,{value:t,children:s}),[t]);const N=t.useState(s=>{var d;if(t&&u&&s.virtualFocus)return(d=T(t,s.activeId))==null?void 0:d.id});a=he(ne({"aria-activedescendant":N},a),{ref:xe(x,f,a.ref),onKeyDownCapture:K,onKeyUpCapture:g,onFocusCapture:P,onFocus:C,onBlurCapture:G,onKeyDown:M});const Y=t.useState(s=>u&&(s.virtualFocus||s.activeId===null));return a=Te(ne({focusable:Y},a)),a});Fe(function(i){const n=Ze(i);return _e(qe,n)});export{Ze as a,ze as b,at as c,lt as u};

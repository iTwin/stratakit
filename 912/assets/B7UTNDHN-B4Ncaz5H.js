import{d as ue,g as P,s as ae,i as G,b as ce,e as le,h as de}from"./SBSPVDDI-aiTSAaoE.js";import{a6 as fe,Z as ve,s as me,z as Ie,E as ge,H as pe,K as Ee,L as _}from"./~utils-D37QAmXJ.js";import{c as Se,f as ye,j as ne,E as we,ab as he,k as X,ac as k,g as be,q as W,w as A,Y as xe,B as re,m as Fe,_ as _e,u as Pe,b as Y,a as Ce,ad as ke,V as y,L as Z,d as N,U as Ae}from"./VOQWLFSQ-Cetahfkh.js";import{a as L,p as Le}from"./chunk-ZYFC6VSF-BlW5IQuq.js";import{c as Ke,d as Be}from"./AMMIPFT4-BQEi3Uji.js";function oe(e){const s=[];for(const n of e)s.push(...n);return s}function J(e){return e.slice().reverse()}var Re="div";function Te(e){return e.some(s=>!!s.rowId)}function De(e){const s=e.target;return s&&!re(s)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function Me(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function ee(e,s,n){return W(t=>{var i;if(s?.(t),t.defaultPrevented||t.isPropagationStopped()||!A(t)||Me(t)||De(t))return;const c=e.getState(),u=(i=P(e,c.activeId))==null?void 0:i.element;if(!u)return;const l=t,{view:o}=l,w=ne(l,["view"]),f=n?.current;u!==f&&u.focus(),ke(u,t.type,w)||t.preventDefault(),t.currentTarget.contains(u)&&t.stopPropagation()})}function ze(e){return le(oe(J(de(e))))}function We(e){const[s,n]=L.useState(!1),t=L.useCallback(()=>n(!0),[]),i=e.useState(c=>P(e,c.activeId));return L.useEffect(()=>{const c=i?.element;s&&c&&(n(!1),c.focus({preventScroll:!0}))},[i,s]),t}var He=Se(function(s){var n=s,{store:t,composite:i=!0,focusOnMove:c=i,moveOnKeyPress:u=!0}=n,l=ne(n,["store","composite","focusOnMove","moveOnKeyPress"]);const o=ue();t=t||o,we(t,!1);const w=L.useRef(null),f=L.useRef(null),H=We(t),E=t.useState("moves"),[,K]=he(i?t.setBaseElement:null);L.useEffect(()=>{var r;if(!t||!E||!i||!c)return;const{activeId:a}=t.getState(),m=(r=P(t,a))==null?void 0:r.element;m&&fe(m)},[t,E,i,c]),X(()=>{if(!t||!E||!i)return;const{baseElement:r,activeId:a}=t.getState();if(!(a===null)||!r)return;const I=f.current;f.current=null,I&&k(I,{relatedTarget:r}),ve(r)||r.focus()},[t,E,i]);const S=t.useState("activeId"),O=t.useState("virtualFocus");X(()=>{var r;if(!t||!i||!O)return;const a=f.current;if(f.current=null,!a)return;const I=((r=P(t,S))==null?void 0:r.element)||be(a);I!==a&&k(a,{relatedTarget:I})},[t,S,O,i]);const B=ee(t,l.onKeyDownCapture,f),R=ee(t,l.onKeyUpCapture,f),T=l.onFocusCapture,V=W(r=>{if(T?.(r),r.defaultPrevented||!t)return;const{virtualFocus:a}=t.getState();if(!a)return;const m=r.relatedTarget,I=ae(r.currentTarget);A(r)&&I&&(r.stopPropagation(),f.current=m)}),D=l.onFocus,h=W(r=>{if(D?.(r),r.defaultPrevented||!i||!t)return;const{relatedTarget:a}=r,{virtualFocus:m}=t.getState();m?A(r)&&!G(t,a)&&queueMicrotask(H):A(r)&&t.setActiveId(null)}),M=l.onBlurCapture,j=W(r=>{var a;if(M?.(r),r.defaultPrevented||!t)return;const{virtualFocus:m,activeId:I}=t.getState();if(!m)return;const p=(a=P(t,I))==null?void 0:a.element,b=r.relatedTarget,d=G(t,b),g=f.current;f.current=null,A(r)&&d?(b===p?g&&g!==b&&k(g,r):p?k(p,r):g&&k(g,r),r.stopPropagation()):!G(t,r.target)&&p&&k(p,r)}),U=l.onKeyDown,v=xe(u),C=W(r=>{var a;if(U?.(r),r.nativeEvent.isComposing||r.defaultPrevented||!t||!A(r))return;const{orientation:m,renderedItems:I,activeId:p}=t.getState(),b=P(t,p);if((a=b?.element)!=null&&a.isConnected)return;const d=m!=="horizontal",g=m!=="vertical",x=Te(I);if((r.key==="ArrowLeft"||r.key==="ArrowRight"||r.key==="Home"||r.key==="End")&&re(r.currentTarget))return;const Q={ArrowUp:(x||d)&&(()=>{if(x){const z=ze(I);return z?.id}return t?.last()}),ArrowRight:(x||g)&&t.first,ArrowDown:(x||d)&&t.first,ArrowLeft:(x||g)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[r.key];if(Q){const z=Q();if(z!==void 0){if(!v(r))return;r.preventDefault(),t.move(z)}}});l=Fe(l,r=>Le.jsx(ce,{value:t,children:r}),[t]);const $=t.useState(r=>{var a;if(t&&i&&r.virtualFocus)return(a=P(t,r.activeId))==null?void 0:a.id});l=_e(Y({"aria-activedescendant":$},l),{ref:Pe(w,K,l.ref),onKeyDownCapture:B,onKeyUpCapture:R,onFocusCapture:V,onFocus:h,onBlurCapture:j,onKeyDown:C});const q=t.useState(r=>i&&(r.virtualFocus||r.activeId===null));return l=me(Y({focusable:q},l)),l}),ot=ye(function(s){const n=He(s);return Ce(Re,n)}),Oe={id:null};function F(e,s){return e.find(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function Ve(e,s){return e.filter(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function te(e,s){return e.filter(n=>n.rowId===s)}function Ue(e,s,n=!1){const t=e.findIndex(i=>i.id===s);return[...e.slice(t+1),...n?[Oe]:[],...e.slice(0,t)]}function se(e){const s=[];for(const n of e){const t=s.find(i=>{var c;return((c=i[0])==null?void 0:c.rowId)===n.rowId});t?t.push(n):s.push([n])}return s}function ie(e){let s=0;for(const{length:n}of e)n>s&&(s=n);return s}function $e(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function Ne(e,s,n){const t=ie(e);for(const i of e)for(let c=0;c<t;c+=1){const u=i[c];if(!u||n&&u.disabled){const o=c===0&&n?F(i):i[c-1];i[c]=o&&s!==o.id&&n?o:$e(o?.rowId)}}return e}function je(e){const s=se(e),n=ie(s),t=[];for(let i=0;i<n;i+=1)for(const c of s){const u=c[i];u&&t.push(Z(N({},u),{rowId:u.rowId?`${i}`:void 0}))}return t}function qe(e={}){var s;const n=(s=e.store)==null?void 0:s.getState(),t=Ke(e),i=y(e.activeId,n?.activeId,e.defaultActiveId),c=Z(N({},t.getState()),{id:y(e.id,n?.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:i,baseElement:y(n?.baseElement,null),includesBaseElement:y(e.includesBaseElement,n?.includesBaseElement,i===null),moves:y(n?.moves,0),orientation:y(e.orientation,n?.orientation,"both"),rtl:y(e.rtl,n?.rtl,!1),virtualFocus:y(e.virtualFocus,n?.virtualFocus,!1),focusLoop:y(e.focusLoop,n?.focusLoop,!1),focusWrap:y(e.focusWrap,n?.focusWrap,!1),focusShift:y(e.focusShift,n?.focusShift,!1)}),u=Ie(c,t,e.store);ge(u,()=>pe(u,["renderedItems","activeId"],o=>{u.setState("activeId",w=>{var f;return w!==void 0?w:(f=F(o.renderedItems))==null?void 0:f.id})}));const l=(o="next",w={})=>{var f,H;const E=u.getState(),{skip:K=0,activeId:S=E.activeId,focusShift:O=E.focusShift,focusLoop:B=E.focusLoop,focusWrap:R=E.focusWrap,includesBaseElement:T=E.includesBaseElement,renderedItems:V=E.renderedItems,rtl:D=E.rtl}=w,h=o==="up"||o==="down",M=o==="next"||o==="down",j=M?D&&!h:!D||h,U=O&&!K;let v=h?oe(Ne(se(V),S,U)):V;if(v=j?J(v):v,v=h?je(v):v,S==null)return(f=F(v))==null?void 0:f.id;const C=v.find(d=>d.id===S);if(!C)return(H=F(v))==null?void 0:H.id;const $=v.some(d=>d.rowId),q=v.indexOf(C),r=v.slice(q+1),a=te(r,C.rowId);if(K){const d=Ve(a,S),g=d.slice(K)[0]||d[d.length-1];return g?.id}const m=B&&(h?B!=="horizontal":B!=="vertical"),I=$&&R&&(h?R!=="horizontal":R!=="vertical"),p=M?(!$||h)&&m&&T:h?T:!1;if(m){const d=I&&!p?v:te(v,C.rowId),g=Ue(d,S,p),x=F(g,S);return x?.id}if(I){const d=F(p?a:r,S);return p?d?.id||null:d?.id}const b=F(a,S);return!b&&p?null:b?.id};return Z(N(N({},t),u),{setBaseElement:o=>u.setState("baseElement",o),setActiveId:o=>u.setState("activeId",o),move:o=>{o!==void 0&&(u.setState("activeId",o),u.setState("moves",w=>w+1))},first:()=>{var o;return(o=F(u.getState().renderedItems))==null?void 0:o.id},last:()=>{var o;return(o=F(J(u.getState().renderedItems)))==null?void 0:o.id},next:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("next",o)),previous:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("previous",o)),down:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("down",o)),up:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),l("up",o))})}function Ge(e){const s=Ae(e.id);return Y({id:s},e)}function Ye(e,s,n){return e=Be(e,s,n),_(e,n,"activeId","setActiveId"),_(e,n,"includesBaseElement"),_(e,n,"virtualFocus"),_(e,n,"orientation"),_(e,n,"rtl"),_(e,n,"focusLoop"),_(e,n,"focusWrap"),_(e,n,"focusShift"),e}function st(e={}){e=Ge(e);const[s,n]=Ee(qe,e);return Ye(s,n,e)}export{ot as C,He as a,Ye as b,qe as c,st as u};

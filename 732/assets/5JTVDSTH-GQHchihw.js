import{d as ue,f as ae}from"./RZ4GPYOB-C4RGqy4H.js";import{p as le,q as ce,r as de,v as fe,w as _}from"./sun-BmR9Byeo.js";import{K as y,L as Y,s as N,u as ve,l as J,f as me,b as Ie,d as pe,_ as ne,T as ge,ad as Se,v as Z,ae as k,p as Ee,i as W,C as A,V as ye,H as re,n as we,j as he,k as xe,af as be}from"./LMDWO4NN-BAMnrgMQ.js";import{d as Fe,g as C,s as _e,i as G,a as Ce,e as Pe,h as ke}from"./6VRAQV3D-CCVGjHDx.js";import{U as Ae,M as Ke,r as Le}from"./~utils-PjSj799t.js";import{a as K,o as Re}from"./chunk-DQRVZFIR-DEPAh8lq.js";function oe(e){const s=[];for(const n of e)s.push(...n);return s}function Q(e){return e.slice().reverse()}var Te={id:null};function F(e,s){return e.find(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function Be(e,s){return e.filter(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function ee(e,s){return e.filter(n=>n.rowId===s)}function Me(e,s,n=!1){const t=e.findIndex(i=>i.id===s);return[...e.slice(t+1),...n?[Te]:[],...e.slice(0,t)]}function se(e){const s=[];for(const n of e){const t=s.find(i=>{var l;return((l=i[0])==null?void 0:l.rowId)===n.rowId});t?t.push(n):s.push([n])}return s}function ie(e){let s=0;for(const{length:n}of e)n>s&&(s=n);return s}function De(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function ze(e,s,n){const t=ie(e);for(const i of e)for(let l=0;l<t;l+=1){const u=i[l];if(!u||n&&u.disabled){const o=l===0&&n?F(i):i[l-1];i[l]=o&&s!==o.id&&n?o:De(o==null?void 0:o.rowId)}}return e}function We(e){const s=se(e),n=ie(s),t=[];for(let i=0;i<n;i+=1)for(const l of s){const u=l[i];u&&t.push(Y(N({},u),{rowId:u.rowId?`${i}`:void 0}))}return t}function He(e={}){var s;const n=(s=e.store)==null?void 0:s.getState(),t=ue(e),i=y(e.activeId,n==null?void 0:n.activeId,e.defaultActiveId),l=Y(N({},t.getState()),{id:y(e.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:i,baseElement:y(n==null?void 0:n.baseElement,null),includesBaseElement:y(e.includesBaseElement,n==null?void 0:n.includesBaseElement,i===null),moves:y(n==null?void 0:n.moves,0),orientation:y(e.orientation,n==null?void 0:n.orientation,"both"),rtl:y(e.rtl,n==null?void 0:n.rtl,!1),virtualFocus:y(e.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:y(e.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:y(e.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:y(e.focusShift,n==null?void 0:n.focusShift,!1)}),u=le(l,t,e.store);ce(u,()=>de(u,["renderedItems","activeId"],o=>{u.setState("activeId",w=>{var f;return w!==void 0?w:(f=F(o.renderedItems))==null?void 0:f.id})}));const c=(o="next",w={})=>{var f,H;const S=u.getState(),{skip:L=0,activeId:E=S.activeId,focusShift:O=S.focusShift,focusLoop:R=S.focusLoop,focusWrap:T=S.focusWrap,includesBaseElement:B=S.includesBaseElement,renderedItems:V=S.renderedItems,rtl:M=S.rtl}=w,h=o==="up"||o==="down",D=o==="next"||o==="down",j=D?M&&!h:!M||h,U=O&&!L;let v=h?oe(ze(se(V),E,U)):V;if(v=j?Q(v):v,v=h?We(v):v,E==null)return(f=F(v))==null?void 0:f.id;const P=v.find(d=>d.id===E);if(!P)return(H=F(v))==null?void 0:H.id;const $=v.some(d=>d.rowId),q=v.indexOf(P),r=v.slice(q+1),a=ee(r,P.rowId);if(L){const d=Be(a,E),p=d.slice(L)[0]||d[d.length-1];return p==null?void 0:p.id}const m=R&&(h?R!=="horizontal":R!=="vertical"),I=$&&T&&(h?T!=="horizontal":T!=="vertical"),g=D?(!$||h)&&m&&B:h?B:!1;if(m){const d=I&&!g?v:ee(v,P.rowId),p=Me(d,E,g),b=F(p,E);return b==null?void 0:b.id}if(I){const d=F(g?a:r,E);return g?(d==null?void 0:d.id)||null:d==null?void 0:d.id}const x=F(a,E);return!x&&g?null:x==null?void 0:x.id};return Y(N(N({},t),u),{setBaseElement:o=>u.setState("baseElement",o),setActiveId:o=>u.setState("activeId",o),move:o=>{o!==void 0&&(u.setState("activeId",o),u.setState("moves",w=>w+1))},first:()=>{var o;return(o=F(u.getState().renderedItems))==null?void 0:o.id},last:()=>{var o;return(o=F(Q(u.getState().renderedItems)))==null?void 0:o.id},next:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),c("next",o)),previous:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),c("previous",o)),down:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),c("down",o)),up:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),c("up",o))})}function Oe(e){const s=ve(e.id);return J({id:s},e)}function Ve(e,s,n){return e=ae(e,s,n),_(e,n,"activeId","setActiveId"),_(e,n,"includesBaseElement"),_(e,n,"virtualFocus"),_(e,n,"orientation"),_(e,n,"rtl"),_(e,n,"focusLoop"),_(e,n,"focusWrap"),_(e,n,"focusShift"),e}function st(e={}){e=Oe(e);const[s,n]=fe(He,e);return Ve(s,n,e)}var Ue="div";function $e(e){return e.some(s=>!!s.rowId)}function Ne(e){const s=e.target;return s&&!re(s)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function je(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function te(e,s,n){return W(t=>{var i;if(s==null||s(t),t.defaultPrevented||t.isPropagationStopped()||!A(t)||je(t)||Ne(t))return;const l=e.getState(),u=(i=C(e,l.activeId))==null?void 0:i.element;if(!u)return;const c=t,{view:o}=c,w=ne(c,["view"]),f=n==null?void 0:n.current;u!==f&&u.focus(),be(u,t.type,w)||t.preventDefault(),t.currentTarget.contains(u)&&t.stopPropagation()})}function qe(e){return Pe(oe(Q(ke(e))))}function Ge(e){const[s,n]=K.useState(!1),t=K.useCallback(()=>n(!0),[]),i=e.useState(l=>C(e,l.activeId));return K.useEffect(()=>{const l=i==null?void 0:i.element;s&&l&&(n(!1),l.focus({preventScroll:!0}))},[i,s]),t}var Ye=Ie(function(s){var n=s,{store:t,composite:i=!0,focusOnMove:l=i,moveOnKeyPress:u=!0}=n,c=ne(n,["store","composite","focusOnMove","moveOnKeyPress"]);const o=Fe();t=t||o,ge(t,!1);const w=K.useRef(null),f=K.useRef(null),H=Ge(t),S=t.useState("moves"),[,L]=Se(i?t.setBaseElement:null);K.useEffect(()=>{var r;if(!t||!S||!i||!l)return;const{activeId:a}=t.getState(),m=(r=C(t,a))==null?void 0:r.element;m&&Ae(m)},[t,S,i,l]),Z(()=>{if(!t||!S||!i)return;const{baseElement:r,activeId:a}=t.getState();if(!(a===null)||!r)return;const I=f.current;f.current=null,I&&k(I,{relatedTarget:r}),Ke(r)||r.focus()},[t,S,i]);const E=t.useState("activeId"),O=t.useState("virtualFocus");Z(()=>{var r;if(!t||!i||!O)return;const a=f.current;if(f.current=null,!a)return;const I=((r=C(t,E))==null?void 0:r.element)||Ee(a);I!==a&&k(a,{relatedTarget:I})},[t,E,O,i]);const R=te(t,c.onKeyDownCapture,f),T=te(t,c.onKeyUpCapture,f),B=c.onFocusCapture,V=W(r=>{if(B==null||B(r),r.defaultPrevented||!t)return;const{virtualFocus:a}=t.getState();if(!a)return;const m=r.relatedTarget,I=_e(r.currentTarget);A(r)&&I&&(r.stopPropagation(),f.current=m)}),M=c.onFocus,h=W(r=>{if(M==null||M(r),r.defaultPrevented||!i||!t)return;const{relatedTarget:a}=r,{virtualFocus:m}=t.getState();m?A(r)&&!G(t,a)&&queueMicrotask(H):A(r)&&t.setActiveId(null)}),D=c.onBlurCapture,j=W(r=>{var a;if(D==null||D(r),r.defaultPrevented||!t)return;const{virtualFocus:m,activeId:I}=t.getState();if(!m)return;const g=(a=C(t,I))==null?void 0:a.element,x=r.relatedTarget,d=G(t,x),p=f.current;f.current=null,A(r)&&d?(x===g?p&&p!==x&&k(p,r):g?k(g,r):p&&k(p,r),r.stopPropagation()):!G(t,r.target)&&g&&k(g,r)}),U=c.onKeyDown,v=ye(u),P=W(r=>{var a;if(U==null||U(r),r.nativeEvent.isComposing||r.defaultPrevented||!t||!A(r))return;const{orientation:m,renderedItems:I,activeId:g}=t.getState(),x=C(t,g);if((a=x==null?void 0:x.element)!=null&&a.isConnected)return;const d=m!=="horizontal",p=m!=="vertical",b=$e(I);if((r.key==="ArrowLeft"||r.key==="ArrowRight"||r.key==="Home"||r.key==="End")&&re(r.currentTarget))return;const X={ArrowUp:(b||d)&&(()=>{if(b){const z=qe(I);return z==null?void 0:z.id}return t==null?void 0:t.last()}),ArrowRight:(b||p)&&t.first,ArrowDown:(b||d)&&t.first,ArrowLeft:(b||p)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[r.key];if(X){const z=X();if(z!==void 0){if(!v(r))return;r.preventDefault(),t.move(z)}}});c=we(c,r=>Re.jsx(Ce,{value:t,children:r}),[t]);const $=t.useState(r=>{var a;if(t&&i&&r.virtualFocus)return(a=C(t,r.activeId))==null?void 0:a.id});c=he(J({"aria-activedescendant":$},c),{ref:xe(w,L,c.ref),onKeyDownCapture:R,onKeyUpCapture:T,onFocusCapture:V,onFocus:h,onBlurCapture:j,onKeyDown:P});const q=t.useState(r=>i&&(r.virtualFocus||r.activeId===null));return c=Le(J({focusable:q},c)),c}),it=me(function(s){const n=Ye(s);return pe(Ue,n)});export{it as C,Ve as a,Ye as b,He as c,st as u};

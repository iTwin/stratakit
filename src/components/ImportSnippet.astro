---
// Displays an import code snippet for a given component.

import { Code } from "@astrojs/starlight/components";
import type { CollectionEntry } from "astro:content";

interface Props {
	package: CollectionEntry<"packages">;
	api: CollectionEntry<"packages">["data"]["apis"][number];
}

const { package: pkg, api } = Astro.props;
const components = [...(api.convenience ? [api.convenience] : []), ...api.composition];

function getBarrelImport(component: (typeof api)["composition"][number]) {
	const fullBarrelName = component.barrelName;
	const barrelNameParts = fullBarrelName?.split(".") ?? [];
	if (barrelNameParts.length === 0) return undefined;

	// import { Anchor } from "@stratakit/bricks";
	if (barrelNameParts.length === 1) {
		return `import { ${fullBarrelName} } from "@stratakit/${pkg.data.name}";`;
	}

	// import { unstable_Dialog as Dialog } from "@stratakit/structures";
	if (barrelNameParts[0].startsWith("unstable_")) {
		const localName = barrelNameParts[0].replace("unstable_", "");
		return `import { ${barrelNameParts[0]} as ${localName} } from "@stratakit/${pkg.data.name}";`;
	}

	// import { DropdownMenu } from "@stratakit/structures";
	return `import { ${barrelNameParts[0]} } from "@stratakit/${pkg.data.name}";`;
}

const barrelImport = components
	.map((component) => getBarrelImport(component))
	.find((importStr) => !!importStr);

// import * as Anchor from "@stratakit/bricks/Anchor";
const moduleImport = api.exportName
	? `import * as ${api.name} from "@stratakit/${pkg.data.name}/${api.exportName}";`
	: undefined;

// import { Anchor } from "@stratakit/bricks";
//
// OR
// import * as Anchor from "@stratakit/bricks/Anchor";
const importCode = [barrelImport, moduleImport].filter(Boolean).join("\n// OR\n");
---

<Code code={importCode} lang="tsx" />

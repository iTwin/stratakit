/*---------------------------------------------------------------------------------------------
 * Copyright (c) Bentley Systems, Incorporated. All rights reserved.
 * See LICENSE.md in the project root for license terms and full copyright notice.
 *--------------------------------------------------------------------------------------------*/

.ğŸ¥-accordion-item {
	--ğŸ¥accordion-item-gap: var(--stratakit-space-x3);
	--ğŸ¥accordion-item-padding: var(--stratakit-space-x3);

	@layer base {
		contain: paint;
		display: grid;
		/* biome-ignore format: improve readability */
		grid-template-columns:
			[marker-before-start] auto [marker-before-end
			decoration-before-start] auto [decoration-before-end
			header-content-start body-content-start] minmax(0, 1fr) [header-content-end
			decoration-after-start] auto [decoration-after-end
			marker-after-start] auto [marker-after-end body-content-end];
		grid-template-rows: [header-start] auto [header-end content-start] auto [content-end];
		border-block-end: 1px solid var(--stratakit-color-border-neutral-muted);
	}

	@layer states {
		&:where([data-kiwi-open="true"]) {
			--ğŸ¥chevron-down-rotate: -0.5turn;
		}
	}
}

.ğŸ¥-accordion-item-header {
	--âœ¨header-bg--hover: var(--stratakit-color-bg-glow-on-surface-neutral-hover);
	--âœ¨header-bg--pressed: var(--stratakit-color-bg-glow-on-surface-neutral-pressed);
	--âœ¨header-bg--default: transparent;

	@layer base {
		grid-row: header;
		grid-column: marker-before-start / marker-after-end;

		background-color: var(--ğŸ¥accordion-item-header-background-color);
		transition: background-color 150ms ease-out;
		position: relative;
		display: grid;
		align-items: center;
		padding: var(--ğŸ¥accordion-item-padding);

		--ğŸ¥accordion-item-header-background-color: var(
				--ğŸŒ€accordion-item-header-state--default,
				var(--âœ¨header-bg--default)
			)
			var(--ğŸŒ€accordion-item-header-state--hover, var(--âœ¨header-bg--hover))
			var(--ğŸŒ€accordion-item-header-state--pressed, var(--âœ¨header-bg--pressed));

		/* TODO: improve the layout for the fallback (i.e. content doesnâ€™t align with the label if thereâ€™s a decoration) */
		grid-template-columns: inherit;

		@supports (grid-template-columns: subgrid) {
			grid-template-columns: subgrid;
		}
	}

	@layer states {
		@media (any-hover: hover) {
			&:where(:hover) {
				--ğŸŒ€accordion-item-header-state: var(--ğŸŒ€accordion-item-header-state--hover);
			}
		}

		&:where(:active) {
			--ğŸŒ€accordion-item-header-state: var(--ğŸŒ€accordion-item-header-state--pressed);
		}
	}

	@layer base.ğŸŒ€ {
		/* Cyclic toggles for default/hover/pressed states. See https://kizu.dev/cyclic-toggles/ */
		--ğŸŒ€accordion-item-header-state: var(--ğŸŒ€accordion-item-header-state--default);
		--ğŸŒ€accordion-item-header-state--default: var(--ğŸŒ€accordion-item-header-state,);
		--ğŸŒ€accordion-item-header-state--hover: var(--ğŸŒ€accordion-item-header-state,);
		--ğŸŒ€accordion-item-header-state--pressed: var(--ğŸŒ€accordion-item-header-state,);
	}
}

.ğŸ¥-accordion-item-marker {
	@layer base {
		grid-row: 1;
		grid-column: marker-before;
		margin-inline-end: var(--ğŸ¥accordion-item-gap);
		/* TODO: We can only use GhostAligner to apply alignment to block or inline, so weâ€™re manually applying it here. */
		margin-inline-start: calc(-1 * var(--ğŸ¥ghost-inline-offset));
		pointer-events: none;

		:where(.ğŸ¥-accordion-item-heading, .ğŸ¥-accordion-item-button) ~ & {
			grid-column: marker-after;
			margin-inline-start: var(--ğŸ¥accordion-item-gap);
			margin-inline-end: calc(-1 * var(--ğŸ¥ghost-inline-offset));
		}
	}
}

.ğŸ¥-accordion-item-label:is(.ğŸ¥-text) {
	@layer base {
		display: inline-block;
		hyphens: auto;
		overflow-wrap: break-word;
		text-box: cap alphabetic;
		font-weight: 500;
	}
}

.ğŸ¥-accordion-item-button {
	@layer base {
		grid-column: header-content;
		cursor: pointer;
		border-radius: var(--stratakit-space-x3);
		--ğŸ¥focus-outline-offset: calc(var(--stratakit-space-x1) * -1);

		&::after {
			content: "";
			position: absolute;
			inset: 0;
			border-radius: inherit;
		}
	}

	@layer states {
		&:focus-visible {
			outline: 0;

			&::after {
				outline: var(--ğŸ¥focus-outline);
				outline-offset: var(--ğŸ¥focus-outline-offset);
			}
		}
	}
}

.ğŸ¥-accordion-item-content {
	@layer base {
		grid-row: content;
		grid-column: body-content;
		padding-block: var(--ğŸ¥accordion-item-padding);
		text-box: cap alphabetic;
		color: var(--stratakit-color-text-neutral-secondary);
	}
}

.ğŸ¥-accordion-item-decoration {
	@layer base {
		grid-column: decoration-before;
		margin-inline-end: var(--ğŸ¥accordion-item-gap);
		display: flex;
		align-items: center;
		gap: 0.25rem;

		:where(.ğŸ¥-accordion-item-heading, .ğŸ¥-accordion-item-button) ~ & {
			grid-column: decoration-after;
			margin-inline-start: var(--ğŸ¥accordion-item-gap);
			margin-inline-end: 0;
		}
	}
}

.ğŸ¥-accordion-item-heading {
	@layer base {
		grid-column: header-content;
		margin-block: 0;
		text-box: cap alphabetic;
	}
}

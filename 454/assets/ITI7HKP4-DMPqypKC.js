import{c as ae,a as ue}from"./C3IKGW5T-DYVtXOw5.js";import{F as b,J,K as j,G as le,a1 as ce,a2 as de,L as fe,al as ve,a5 as Y,N as _,aj as me,a7 as Ie,ak as ge,a8 as ne,bj as Se,aa as pe,bk as Ee,bl as P,bm as be,bn as Z,bo as k,aB as ye,bp as we,ab as W,bq as he,ag as A,br as q,aA as xe,af as re,an as Fe,S as _e,a4 as Pe,ap as Ce,a$ as ke,bs as Ae,bt as Ke,bu as Le}from"./~utils-B21z9VD2.js";import{b as K,p as Be}from"./index-DDCMeoDP.js";function oe(e){const s=[];for(const n of e)s.push(...n);return s}function Q(e){return e.slice().reverse()}var Re={id:null};function F(e,s){return e.find(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function Te(e,s){return e.filter(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function ee(e,s){return e.filter(n=>n.rowId===s)}function De(e,s,n=!1){const t=e.findIndex(i=>i.id===s);return[...e.slice(t+1),...n?[Re]:[],...e.slice(0,t)]}function se(e){const s=[];for(const n of e){const t=s.find(i=>{var l;return((l=i[0])==null?void 0:l.rowId)===n.rowId});t?t.push(n):s.push([n])}return s}function ie(e){let s=0;for(const{length:n}of e)n>s&&(s=n);return s}function Me(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function ze(e,s,n){const t=ie(e);for(const i of e)for(let l=0;l<t;l+=1){const a=i[l];if(!a||n&&a.disabled){const o=l===0&&n?F(i):i[l-1];i[l]=o&&s!==o.id&&n?o:Me(o==null?void 0:o.rowId)}}return e}function We(e){const s=se(e),n=ie(s),t=[];for(let i=0;i<n;i+=1)for(const l of s){const a=l[i];a&&t.push(J(j({},a),{rowId:a.rowId?`${i}`:void 0}))}return t}function Oe(e={}){var s;const n=(s=e.store)==null?void 0:s.getState(),t=ae(e),i=b(e.activeId,n==null?void 0:n.activeId,e.defaultActiveId),l=J(j({},t.getState()),{id:b(e.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:i,baseElement:b(n==null?void 0:n.baseElement,null),includesBaseElement:b(e.includesBaseElement,n==null?void 0:n.includesBaseElement,i===null),moves:b(n==null?void 0:n.moves,0),orientation:b(e.orientation,n==null?void 0:n.orientation,"both"),rtl:b(e.rtl,n==null?void 0:n.rtl,!1),virtualFocus:b(e.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:b(e.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:b(e.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:b(e.focusShift,n==null?void 0:n.focusShift,!1)}),a=le(l,t,e.store);ce(a,()=>de(a,["renderedItems","activeId"],o=>{a.setState("activeId",y=>{var f;return y!==void 0?y:(f=F(o.renderedItems))==null?void 0:f.id})}));const c=(o="next",y={})=>{var f,O;const p=a.getState(),{skip:L=0,activeId:E=p.activeId,focusShift:$=p.focusShift,focusLoop:B=p.focusLoop,focusWrap:R=p.focusWrap,includesBaseElement:T=p.includesBaseElement,renderedItems:H=p.renderedItems,rtl:D=p.rtl}=y,w=o==="up"||o==="down",M=o==="next"||o==="down",U=M?D&&!w:!D||w,N=$&&!L;let v=w?oe(ze(se(H),E,N)):H;if(v=U?Q(v):v,v=w?We(v):v,E==null)return(f=F(v))==null?void 0:f.id;const C=v.find(d=>d.id===E);if(!C)return(O=F(v))==null?void 0:O.id;const V=v.some(d=>d.rowId),G=v.indexOf(C),r=v.slice(G+1),u=ee(r,C.rowId);if(L){const d=Te(u,E),g=d.slice(L)[0]||d[d.length-1];return g==null?void 0:g.id}const m=B&&(w?B!=="horizontal":B!=="vertical"),I=V&&R&&(w?R!=="horizontal":R!=="vertical"),S=M?(!V||w)&&m&&T:w?T:!1;if(m){const d=I&&!S?v:ee(v,C.rowId),g=De(d,E,S),x=F(g,E);return x==null?void 0:x.id}if(I){const d=F(S?u:r,E);return S?(d==null?void 0:d.id)||null:d==null?void 0:d.id}const h=F(u,E);return!h&&S?null:h==null?void 0:h.id};return J(j(j({},t),a),{setBaseElement:o=>a.setState("baseElement",o),setActiveId:o=>a.setState("activeId",o),move:o=>{o!==void 0&&(a.setState("activeId",o),a.setState("moves",y=>y+1))},first:()=>{var o;return(o=F(a.getState().renderedItems))==null?void 0:o.id},last:()=>{var o;return(o=F(Q(a.getState().renderedItems)))==null?void 0:o.id},next:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),c("next",o)),previous:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),c("previous",o)),down:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),c("down",o)),up:o=>(o!==void 0&&typeof o=="number"&&(o={skip:o}),c("up",o))})}function $e(e){const s=ve(e.id);return Y({id:s},e)}function He(e,s,n){return e=ue(e,s,n),_(e,n,"activeId","setActiveId"),_(e,n,"includesBaseElement"),_(e,n,"virtualFocus"),_(e,n,"orientation"),_(e,n,"rtl"),_(e,n,"focusLoop"),_(e,n,"focusWrap"),_(e,n,"focusShift"),e}function nt(e={}){e=$e(e);const[s,n]=fe(Oe,e);return He(s,n,e)}var Ne="div";function Ve(e){return e.some(s=>!!s.rowId)}function je(e){const s=e.target;return s&&!re(s)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function Ue(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function te(e,s,n){return W(t=>{var i;if(s==null||s(t),t.defaultPrevented||t.isPropagationStopped()||!A(t)||Ue(t)||je(t))return;const l=e.getState(),a=(i=P(e,l.activeId))==null?void 0:i.element;if(!a)return;const c=t,{view:o}=c,y=ne(c,["view"]),f=n==null?void 0:n.current;a!==f&&a.focus(),Ae(a,t.type,y)||t.preventDefault(),t.currentTarget.contains(a)&&t.stopPropagation()})}function Ge(e){return Ke(oe(Q(Le(e))))}function qe(e){const[s,n]=K.useState(!1),t=K.useCallback(()=>n(!0),[]),i=e.useState(l=>P(e,l.activeId));return K.useEffect(()=>{const l=i==null?void 0:i.element;s&&l&&(n(!1),l.focus({preventScroll:!0}))},[i,s]),t}var Je=Ie(function(s){var n=s,{store:t,composite:i=!0,focusOnMove:l=i,moveOnKeyPress:a=!0}=n,c=ne(n,["store","composite","focusOnMove","moveOnKeyPress"]);const o=Se();t=t||o,pe(t,!1);const y=K.useRef(null),f=K.useRef(null),O=qe(t),p=t.useState("moves"),[,L]=Ee(i?t.setBaseElement:null);K.useEffect(()=>{var r;if(!t||!p||!i||!l)return;const{activeId:u}=t.getState(),m=(r=P(t,u))==null?void 0:r.element;m&&be(m)},[t,p,i,l]),Z(()=>{if(!t||!p||!i)return;const{baseElement:r,activeId:u}=t.getState();if(!(u===null)||!r)return;const I=f.current;f.current=null,I&&k(I,{relatedTarget:r}),ye(r)||r.focus()},[t,p,i]);const E=t.useState("activeId"),$=t.useState("virtualFocus");Z(()=>{var r;if(!t||!i||!$)return;const u=f.current;if(f.current=null,!u)return;const I=((r=P(t,E))==null?void 0:r.element)||we(u);I!==u&&k(u,{relatedTarget:I})},[t,E,$,i]);const B=te(t,c.onKeyDownCapture,f),R=te(t,c.onKeyUpCapture,f),T=c.onFocusCapture,H=W(r=>{if(T==null||T(r),r.defaultPrevented||!t)return;const{virtualFocus:u}=t.getState();if(!u)return;const m=r.relatedTarget,I=he(r.currentTarget);A(r)&&I&&(r.stopPropagation(),f.current=m)}),D=c.onFocus,w=W(r=>{if(D==null||D(r),r.defaultPrevented||!i||!t)return;const{relatedTarget:u}=r,{virtualFocus:m}=t.getState();m?A(r)&&!q(t,u)&&queueMicrotask(O):A(r)&&t.setActiveId(null)}),M=c.onBlurCapture,U=W(r=>{var u;if(M==null||M(r),r.defaultPrevented||!t)return;const{virtualFocus:m,activeId:I}=t.getState();if(!m)return;const S=(u=P(t,I))==null?void 0:u.element,h=r.relatedTarget,d=q(t,h),g=f.current;f.current=null,A(r)&&d?(h===S?g&&g!==h&&k(g,r):S?k(S,r):g&&k(g,r),r.stopPropagation()):!q(t,r.target)&&S&&k(S,r)}),N=c.onKeyDown,v=xe(a),C=W(r=>{var u;if(N==null||N(r),r.defaultPrevented||!t||!A(r))return;const{orientation:m,renderedItems:I,activeId:S}=t.getState(),h=P(t,S);if((u=h==null?void 0:h.element)!=null&&u.isConnected)return;const d=m!=="horizontal",g=m!=="vertical",x=Ve(I);if((r.key==="ArrowLeft"||r.key==="ArrowRight"||r.key==="Home"||r.key==="End")&&re(r.currentTarget))return;const X={ArrowUp:(x||d)&&(()=>{if(x){const z=Ge(I);return z==null?void 0:z.id}return t==null?void 0:t.last()}),ArrowRight:(x||g)&&t.first,ArrowDown:(x||d)&&t.first,ArrowLeft:(x||g)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[r.key];if(X){const z=X();if(z!==void 0){if(!v(r))return;r.preventDefault(),t.move(z)}}});c=Fe(c,r=>Be.jsx(_e,{value:t,children:r}),[t]);const V=t.useState(r=>{var u;if(t&&i&&r.virtualFocus)return(u=P(t,r.activeId))==null?void 0:u.id});c=Pe(Y({"aria-activedescendant":V},c),{ref:Ce(y,L,c.ref),onKeyDownCapture:B,onKeyUpCapture:R,onFocusCapture:H,onFocus:w,onBlurCapture:U,onKeyDown:C});const G=t.useState(r=>i&&(r.virtualFocus||r.activeId===null));return c=ke(Y({focusable:G},c)),c}),rt=me(function(s){const n=Je(s);return ge(Ne,n)});export{rt as C,Je as a,nt as b,Oe as c,He as u};

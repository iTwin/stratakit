import{t as ce,c as Q,s as j,i as de,e as ee,d as R,a as fe}from"./YV4JVR4I-6SGpg5TS.js";import{G as _,F as q,R as me,H as M,z as ve,A as Ie,J as ge,c as Se,_ as oe,q as pe,S as Ee,T as te,U as O,V as ye,l as V,C as z,v as we,B as ie,p as be,m as he,n as xe,b as ne,d as Fe,e as _e,W as Pe}from"./~utils-Nk7RK8VV.js";import{e as Ce,g as T,s as Ae,i as Y,a as ke,h as Re,j as Be}from"./P2CTZE2T-Ss-gfVQs.js";import{f as Ke,a as Le,u as Te}from"./LVA2YJMS-BYwzXMg7.js";import{a as W,n as Me}from"./chunk-K6AXKMTT-BHCV6zel.js";function De(e){var o;const n=e.find(l=>!!l.element),t=[...e].reverse().find(l=>!!l.element);let i=(o=n==null?void 0:n.element)==null?void 0:o.parentElement;for(;i&&(t!=null&&t.element);){if(t&&i.contains(t.element))return i;i=i.parentElement}return ve(i).body}function Oe(e){return e==null?void 0:e.__unstablePrivateStore}function ze(e={}){var o;ce(e,e.store);const n=(o=e.store)==null?void 0:o.getState(),t=_(e.items,n==null?void 0:n.items,e.defaultItems,[]),i=new Map(t.map(a=>[a.id,a])),l={items:t,renderedItems:_(n==null?void 0:n.renderedItems,[])},c=Oe(e.store),u=Q({items:t,renderedItems:l.renderedItems},c),r=Q(l,e.store),x=a=>{const f=Ie(a,m=>m.element);u.setState("renderedItems",f),r.setState("renderedItems",f)};j(r,()=>de(u)),j(u,()=>ee(u,["items"],a=>{r.setState("items",a.items)})),j(u,()=>ee(u,["renderedItems"],a=>{let f=!0,m=requestAnimationFrame(()=>{const{renderedItems:S}=r.getState();a.renderedItems!==S&&x(a.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(m);const w=()=>{if(f){f=!1;return}cancelAnimationFrame(m),m=requestAnimationFrame(()=>x(a.renderedItems))},K=De(a.renderedItems),g=new IntersectionObserver(w,{root:K});for(const S of a.renderedItems)S.element&&g.observe(S.element);return()=>{cancelAnimationFrame(m),g.disconnect()}}));const I=(a,f,m=!1)=>{let w;return f(g=>{const S=g.findIndex(({id:b})=>b===a.id),P=g.slice();if(S!==-1){w=g[S];const b=M(M({},w),a);P[S]=b,i.set(a.id,b)}else P.push(a),i.set(a.id,a);return P}),()=>{f(g=>{if(!w)return m&&i.delete(a.id),g.filter(({id:b})=>b!==a.id);const S=g.findIndex(({id:b})=>b===a.id);if(S===-1)return g;const P=g.slice();return P[S]=w,i.set(a.id,w),P})}},L=a=>I(a,f=>u.setState("items",f),!0);return q(M({},r),{registerItem:L,renderItem:a=>me(L(a),I(a,f=>u.setState("renderedItems",f))),item:a=>{if(!a)return null;let f=i.get(a);if(!f){const{items:m}=u.getState();f=m.find(w=>w.id===a),f&&i.set(a,f)}return f||null},__unstablePrivateStore:u})}function We(e,o,n){return ge(o,[n.store]),R(e,n,"items","setItems"),e}function ae(e){const o=[];for(const n of e)o.push(...n);return o}function X(e){return e.slice().reverse()}var He={id:null};function B(e,o){return e.find(n=>o?!n.disabled&&n.id!==o:!n.disabled)}function Ue(e,o){return e.filter(n=>o?!n.disabled&&n.id!==o:!n.disabled)}function re(e,o){return e.filter(n=>n.rowId===o)}function Ve(e,o,n=!1){const t=e.findIndex(i=>i.id===o);return[...e.slice(t+1),...n?[He]:[],...e.slice(0,t)]}function ue(e){const o=[];for(const n of e){const t=o.find(i=>{var l;return((l=i[0])==null?void 0:l.rowId)===n.rowId});t?t.push(n):o.push([n])}return o}function le(e){let o=0;for(const{length:n}of e)n>o&&(o=n);return o}function $e(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function Ne(e,o,n){const t=le(e);for(const i of e)for(let l=0;l<t;l+=1){const c=i[l];if(!c||n&&c.disabled){const r=l===0&&n?B(i):i[l-1];i[l]=r&&o!==r.id&&n?r:$e(r==null?void 0:r.rowId)}}return e}function je(e){const o=ue(e),n=le(o),t=[];for(let i=0;i<n;i+=1)for(const l of o){const c=l[i];c&&t.push(q(M({},c),{rowId:c.rowId?`${i}`:void 0}))}return t}function ut(e={}){var o;const n=(o=e.store)==null?void 0:o.getState(),t=ze(e),i=_(e.activeId,n==null?void 0:n.activeId,e.defaultActiveId),l=q(M({},t.getState()),{id:_(e.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:i,baseElement:_(n==null?void 0:n.baseElement,null),includesBaseElement:_(e.includesBaseElement,n==null?void 0:n.includesBaseElement,i===null),moves:_(n==null?void 0:n.moves,0),orientation:_(e.orientation,n==null?void 0:n.orientation,"both"),rtl:_(e.rtl,n==null?void 0:n.rtl,!1),virtualFocus:_(e.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:_(e.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:_(e.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:_(e.focusShift,n==null?void 0:n.focusShift,!1)}),c=Q(l,t,e.store);j(c,()=>fe(c,["renderedItems","activeId"],r=>{c.setState("activeId",x=>{var I;return x!==void 0?x:(I=B(r.renderedItems))==null?void 0:I.id})}));const u=(r="next",x={})=>{var I,L;const a=c.getState(),{skip:f=0,activeId:m=a.activeId,focusShift:w=a.focusShift,focusLoop:K=a.focusLoop,focusWrap:g=a.focusWrap,includesBaseElement:S=a.includesBaseElement,renderedItems:P=a.renderedItems,rtl:b=a.rtl}=x,C=r==="up"||r==="down",H=r==="next"||r==="down",G=H?b&&!C:!b||C,$=w&&!f;let p=C?ae(Ne(ue(P),m,$)):P;if(p=G?X(p):p,p=C?je(p):p,m==null)return(I=B(p))==null?void 0:I.id;const D=p.find(v=>v.id===m);if(!D)return(L=B(p))==null?void 0:L.id;const N=p.some(v=>v.rowId),J=p.indexOf(D),s=p.slice(J+1),d=re(s,D.rowId);if(f){const v=Ue(d,m),h=v.slice(f)[0]||v[v.length-1];return h==null?void 0:h.id}const E=K&&(C?K!=="horizontal":K!=="vertical"),y=N&&g&&(C?g!=="horizontal":g!=="vertical"),F=H?(!N||C)&&E&&S:C?S:!1;if(E){const v=y&&!F?p:re(p,D.rowId),h=Ve(v,m,F),k=B(h,m);return k==null?void 0:k.id}if(y){const v=B(F?d:s,m);return F?(v==null?void 0:v.id)||null:v==null?void 0:v.id}const A=B(d,m);return!A&&F?null:A==null?void 0:A.id};return q(M(M({},t),c),{setBaseElement:r=>c.setState("baseElement",r),setActiveId:r=>c.setState("activeId",r),move:r=>{r!==void 0&&(c.setState("activeId",r),c.setState("moves",x=>x+1))},first:()=>{var r;return(r=B(c.getState().renderedItems))==null?void 0:r.id},last:()=>{var r;return(r=B(X(c.getState().renderedItems)))==null?void 0:r.id},next:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("next",r)),previous:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("previous",r)),down:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("down",r)),up:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),u("up",r))})}function lt(e,o,n){return e=We(e,o,n),R(e,n,"activeId","setActiveId"),R(e,n,"includesBaseElement"),R(e,n,"virtualFocus"),R(e,n,"orientation"),R(e,n,"rtl"),R(e,n,"focusLoop"),R(e,n,"focusWrap"),R(e,n,"focusShift"),e}var qe="div";function Ge(e){return e.some(o=>!!o.rowId)}function Je(e){const o=e.target;return o&&!ie(o)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function Ye(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function se(e,o,n){return V(t=>{var i;if(o==null||o(t),t.defaultPrevented||t.isPropagationStopped()||!z(t)||Ye(t)||Je(t))return;const l=e.getState(),c=(i=T(e,l.activeId))==null?void 0:i.element;if(!c)return;const u=t,r=oe(u,["view"]),x=n==null?void 0:n.current;c!==x&&c.focus(),Pe(c,t.type,r)||t.preventDefault(),t.currentTarget.contains(c)&&t.stopPropagation()})}function Qe(e){return Re(ae(X(Be(e))))}function Xe(e){const[o,n]=W.useState(!1),t=W.useCallback(()=>n(!0),[]),i=e.useState(l=>T(e,l.activeId));return W.useEffect(()=>{const l=i==null?void 0:i.element;o&&l&&(n(!1),l.focus({preventScroll:!0}))},[i,o]),t}var Ze=Se(function(o){var n=o,{store:t,composite:i=!0,focusOnMove:l=i,moveOnKeyPress:c=!0}=n,u=oe(n,["store","composite","focusOnMove","moveOnKeyPress"]);const r=Ce();t=t||r,pe(t,!1);const x=W.useRef(null),I=W.useRef(null),L=Xe(t),a=t.useState("moves"),[,f]=Ee(i?t.setBaseElement:null);W.useEffect(()=>{var s;if(!t||!a||!i||!l)return;const{activeId:d}=t.getState(),E=(s=T(t,d))==null?void 0:s.element;E&&Ke(E)},[t,a,i,l]),te(()=>{if(!t||!a||!i)return;const{baseElement:s,activeId:d}=t.getState();if(!(d===null)||!s)return;const y=I.current;I.current=null,y&&O(y,{relatedTarget:s}),Le(s)||s.focus()},[t,a,i]);const m=t.useState("activeId"),w=t.useState("virtualFocus");te(()=>{var s;if(!t||!i||!w)return;const d=I.current;if(I.current=null,!d)return;const y=((s=T(t,m))==null?void 0:s.element)||ye(d);y!==d&&O(d,{relatedTarget:y})},[t,m,w,i]);const K=se(t,u.onKeyDownCapture,I),g=se(t,u.onKeyUpCapture,I),S=u.onFocusCapture,P=V(s=>{if(S==null||S(s),s.defaultPrevented||!t)return;const{virtualFocus:d}=t.getState();if(!d)return;const E=s.relatedTarget,y=Ae(s.currentTarget);z(s)&&y&&(s.stopPropagation(),I.current=E)}),b=u.onFocus,C=V(s=>{if(b==null||b(s),s.defaultPrevented||!i||!t)return;const{relatedTarget:d}=s,{virtualFocus:E}=t.getState();E?z(s)&&!Y(t,d)&&queueMicrotask(L):z(s)&&t.setActiveId(null)}),H=u.onBlurCapture,G=V(s=>{var d;if(H==null||H(s),s.defaultPrevented||!t)return;const{virtualFocus:E,activeId:y}=t.getState();if(!E)return;const F=(d=T(t,y))==null?void 0:d.element,A=s.relatedTarget,v=Y(t,A),h=I.current;I.current=null,z(s)&&v?(A===F?h&&h!==A&&O(h,s):F?O(F,s):h&&O(h,s),s.stopPropagation()):!Y(t,s.target)&&F&&O(F,s)}),$=u.onKeyDown,p=we(c),D=V(s=>{var d;if($==null||$(s),s.defaultPrevented||!t||!z(s))return;const{orientation:E,renderedItems:y,activeId:F}=t.getState(),A=T(t,F);if((d=A==null?void 0:A.element)!=null&&d.isConnected)return;const v=E!=="horizontal",h=E!=="vertical",k=Ge(y);if((s.key==="ArrowLeft"||s.key==="ArrowRight"||s.key==="Home"||s.key==="End")&&ie(s.currentTarget))return;const Z={ArrowUp:(k||v)&&(()=>{if(k){const U=Qe(y);return U==null?void 0:U.id}return t==null?void 0:t.last()}),ArrowRight:(k||h)&&t.first,ArrowDown:(k||v)&&t.first,ArrowLeft:(k||h)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[s.key];if(Z){const U=Z();if(U!==void 0){if(!p(s))return;s.preventDefault(),t.move(U)}}});u=be(u,s=>Me.jsx(ke,{value:t,children:s}),[t]);const N=t.useState(s=>{var d;if(t&&i&&s.virtualFocus)return(d=T(t,s.activeId))==null?void 0:d.id});u=he(ne({"aria-activedescendant":N},u),{ref:xe(x,f,u.ref),onKeyDownCapture:K,onKeyUpCapture:g,onFocusCapture:P,onFocus:C,onBlurCapture:G,onKeyDown:D});const J=t.useState(s=>i&&(s.virtualFocus||s.activeId===null));return u=Te(ne({focusable:J},u)),u});Fe(function(o){const n=Ze(o);return _e(qe,n)});export{Ze as a,ze as b,ut as c,lt as u};

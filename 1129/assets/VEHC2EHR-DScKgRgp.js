import{d as ie,g as k,s as re,i as G,a as ue,e as ae,h as oe}from"./FIT2LC3L-DmqYf1H1.js";import{ae as se,a4 as le,E as ce,O as de,Q as fe,S as ve,X as P,W as me}from"./~utils-C1urJCcZ.js";import{g as Ie,a1 as ge,aB as Se,v as Q,aC as R,J as Ee,n as H,U as T,ah as ye,Z,O as we,o as he,aD as xe,e as Fe,h as Ce,ae as I,i as be}from"./sun-BJKUai8C.js";import{a as D,p as Pe}from"./chunk-4WY6JWTD-BeTiufY7.js";import{c as ke,e as Ae}from"./QHXYX2YB-CH-GorIV.js";function ee(t){const e=[];for(const n of t)e.push(...n);return e}function q(t){return t.slice().reverse()}var _e="div";function Be(t){return t.some(e=>!!e.rowId)}function Le(t){const e=t.target;return e&&!Z(e)?!1:t.key.length===1&&!t.ctrlKey&&!t.metaKey}function Re(t){return t.key==="Shift"||t.key==="Control"||t.key==="Alt"||t.key==="Meta"}function X(t,e,n){return H(a=>{var s;if(e?.(a),a.defaultPrevented||a.isPropagationStopped()||!T(a)||Re(a)||Le(a))return;const u=t.getState(),o=(s=k(t,u.activeId))==null?void 0:s.element;if(!o)return;const{view:b,...i}=a,g=n?.current;o!==g&&o.focus(),xe(o,a.type,i)||a.preventDefault(),a.currentTarget.contains(o)&&a.stopPropagation()})}function Te(t){return ae(ee(q(oe(t))))}function De(t){const[e,n]=D.useState(!1),a=D.useCallback(()=>n(!0),[]),s=t.useState(u=>k(t,u.activeId));return D.useEffect(()=>{const u=s?.element;e&&u&&(n(!1),u.focus({preventScroll:!0}))},[s,e]),a}var Ke=Ie(function({store:e,composite:n=!0,focusOnMove:a=n,moveOnKeyPress:s=!0,...u}){const o=ie();e=e||o,ge(e,!1);const b=D.useRef(null),i=D.useRef(null),g=De(e),S=e.useState("moves"),[,U]=Se(n?e.setBaseElement:null);D.useEffect(()=>{var r;if(!e||!S||!n||!a)return;const{activeId:l}=e.getState(),d=(r=k(e,l))==null?void 0:r.element;d&&se(d)},[e,S,n,a]),Q(()=>{if(!e||!S||!n)return;const{baseElement:r,activeId:l}=e.getState();if(!(l===null)||!r)return;const f=i.current;i.current=null,f&&R(f,{relatedTarget:r}),le(r)||r.focus()},[e,S,n]);const E=e.useState("activeId"),A=e.useState("virtualFocus");Q(()=>{var r;if(!e||!n||!A)return;const l=i.current;if(i.current=null,!l)return;const f=((r=k(e,E))==null?void 0:r.element)||Ee(l);f!==l&&R(l,{relatedTarget:f})},[e,E,A,n]);const y=X(e,u.onKeyDownCapture,i),O=X(e,u.onKeyUpCapture,i),_=u.onFocusCapture,K=H(r=>{if(_?.(r),r.defaultPrevented||!e)return;const{virtualFocus:l}=e.getState();if(!l)return;const d=r.relatedTarget,f=re(r.currentTarget);T(r)&&f&&(r.stopPropagation(),i.current=d)}),M=u.onFocus,N=H(r=>{if(M?.(r),r.defaultPrevented||!n||!e)return;const{relatedTarget:l}=r,{virtualFocus:d}=e.getState();d?T(r)&&!G(e,l)&&queueMicrotask(g):T(r)&&e.setActiveId(null)}),z=u.onBlurCapture,w=H(r=>{var l;if(z?.(r),r.defaultPrevented||!e)return;const{virtualFocus:d,activeId:f}=e.getState();if(!d)return;const h=(l=k(e,f))==null?void 0:l.element,F=r.relatedTarget,x=G(e,F),m=i.current;i.current=null,T(r)&&x?(F===h?m&&m!==F&&R(m,r):h?R(h,r):m&&R(m,r),r.stopPropagation()):!G(e,r.target)&&h&&R(h,r)}),W=u.onKeyDown,V=ye(s),$=H(r=>{var l;if(W?.(r),r.nativeEvent.isComposing||r.defaultPrevented||!e||!T(r))return;const{orientation:d,renderedItems:f,activeId:h}=e.getState(),F=k(e,h);if((l=F?.element)!=null&&l.isConnected)return;const x=d!=="horizontal",m=d!=="vertical",c=Be(f);if((r.key==="ArrowLeft"||r.key==="ArrowRight"||r.key==="Home"||r.key==="End")&&Z(r.currentTarget))return;const J={ArrowUp:(c||x)&&(()=>{if(c){const p=Te(f);return p?.id}return e?.last()}),ArrowRight:(c||m)&&e.first,ArrowDown:(c||x)&&e.first,ArrowLeft:(c||m)&&e.last,Home:e.first,End:e.last,PageUp:e.first,PageDown:e.last}[r.key];if(J){const p=J();if(p!==void 0){if(!V(r))return;r.preventDefault(),e.move(p)}}});u=we(u,r=>Pe.jsx(ue,{value:e,children:r}),[e]),u={"aria-activedescendant":e.useState(r=>{var l;if(e&&n&&r.virtualFocus)return(l=k(e,r.activeId))==null?void 0:l.id}),...u,ref:he(b,U,u.ref),onKeyDownCapture:y,onKeyUpCapture:O,onFocusCapture:K,onFocus:N,onBlurCapture:w,onKeyDown:$};const B=e.useState(r=>n&&(r.virtualFocus||r.activeId===null));return u=ce({focusable:B,...u}),u}),Xe=Fe(function(e){const n=Ke(e);return Ce(_e,n)}),Me={id:null};function C(t,e){return t.find(n=>e?!n.disabled&&n.id!==e:!n.disabled)}function ze(t,e){return t.filter(n=>e?!n.disabled&&n.id!==e:!n.disabled)}function Y(t,e){return t.filter(n=>n.rowId===e)}function We(t,e,n=!1){const a=t.findIndex(s=>s.id===e);return[...t.slice(a+1),...n?[Me]:[],...t.slice(0,a)]}function te(t){const e=[];for(const n of t){const a=e.find(s=>{var u;return((u=s[0])==null?void 0:u.rowId)===n.rowId});a?a.push(n):e.push([n])}return e}function ne(t){let e=0;for(const{length:n}of t)n>e&&(e=n);return e}function pe(t){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:t}}function He(t,e,n){const a=ne(t);for(const s of t)for(let u=0;u<a;u+=1){const o=s[u];if(!o||n&&o.disabled){const i=u===0&&n?C(s):s[u-1];s[u]=i&&e!==i.id&&n?i:pe(i?.rowId)}}return t}function Ue(t){const e=te(t),n=ne(e),a=[];for(let s=0;s<n;s+=1)for(const u of e){const o=u[s];o&&a.push({...o,rowId:o.rowId?`${s}`:void 0})}return a}function Ne(t={}){var e;const n=(e=t.store)==null?void 0:e.getState(),a=ke(t),s=I(t.activeId,n?.activeId,t.defaultActiveId),u={...a.getState(),id:I(t.id,n?.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:s,baseElement:I(n?.baseElement,null),includesBaseElement:I(t.includesBaseElement,n?.includesBaseElement,s===null),moves:I(n?.moves,0),orientation:I(t.orientation,n?.orientation,"both"),rtl:I(t.rtl,n?.rtl,!1),virtualFocus:I(t.virtualFocus,n?.virtualFocus,!1),focusLoop:I(t.focusLoop,n?.focusLoop,!1),focusWrap:I(t.focusWrap,n?.focusWrap,!1),focusShift:I(t.focusShift,n?.focusShift,!1)},o=de(u,a,t.store);fe(o,()=>ve(o,["renderedItems","activeId"],i=>{o.setState("activeId",g=>{var S;return g!==void 0?g:(S=C(i.renderedItems))==null?void 0:S.id})}));const b=(i="next",g={})=>{var S,U;const E=o.getState(),{skip:A=0,activeId:y=E.activeId,focusShift:O=E.focusShift,focusLoop:_=E.focusLoop,focusWrap:K=E.focusWrap,includesBaseElement:M=E.includesBaseElement,renderedItems:N=E.renderedItems,rtl:z=E.rtl}=g,w=i==="up"||i==="down",W=i==="next"||i==="down",V=W?z&&!w:!z||w,$=O&&!A;let v=w?ee(He(te(N),y,$)):N;if(v=V?q(v):v,v=w?Ue(v):v,y==null)return(S=C(v))==null?void 0:S.id;const B=v.find(c=>c.id===y);if(!B)return(U=C(v))==null?void 0:U.id;const r=v.some(c=>c.rowId),l=v.indexOf(B),d=v.slice(l+1),f=Y(d,B.rowId);if(A){const c=ze(f,y),L=c.slice(A)[0]||c[c.length-1];return L?.id}const h=_&&(w?_!=="horizontal":_!=="vertical"),F=r&&K&&(w?K!=="horizontal":K!=="vertical"),x=W?(!r||w)&&h&&M:w?M:!1;if(h){const c=F&&!x?v:Y(v,B.rowId),L=We(c,y,x),j=C(L,y);return j?.id}if(F){const c=C(x?f:d,y);return x?c?.id||null:c?.id}const m=C(f,y);return!m&&x?null:m?.id};return{...a,...o,setBaseElement:i=>o.setState("baseElement",i),setActiveId:i=>o.setState("activeId",i),move:i=>{i!==void 0&&(o.setState("activeId",i),o.setState("moves",g=>g+1))},first:()=>{var i;return(i=C(o.getState().renderedItems))==null?void 0:i.id},last:()=>{var i;return(i=C(q(o.getState().renderedItems)))==null?void 0:i.id},next:i=>(i!==void 0&&typeof i=="number"&&(i={skip:i}),b("next",i)),previous:i=>(i!==void 0&&typeof i=="number"&&(i={skip:i}),b("previous",i)),down:i=>(i!==void 0&&typeof i=="number"&&(i={skip:i}),b("down",i)),up:i=>(i!==void 0&&typeof i=="number"&&(i={skip:i}),b("up",i))}}function Oe(t){return{id:be(t.id),...t}}function Ve(t,e,n){return t=Ae(t,e,n),P(t,n,"activeId","setActiveId"),P(t,n,"includesBaseElement"),P(t,n,"virtualFocus"),P(t,n,"orientation"),P(t,n,"rtl"),P(t,n,"focusLoop"),P(t,n,"focusWrap"),P(t,n,"focusShift"),t}function Ye(t={}){t=Oe(t);const[e,n]=me(Ne,t);return Ve(e,n,t)}export{Xe as C,Ke as a,Ve as b,Ne as c,Ye as u};

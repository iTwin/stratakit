import{B as A,p as _,q as C,E as F,t as E,v as O,w as q}from"./sun-6ZcqRjWt.js";import{p as h,o as y,s as M,q as x,a4 as B,E as D,t as V,c as k}from"./LMDWO4NN-CHu43Obk.js";function R(t){var l;const s=t.find(f=>!!f.element),u=[...t].reverse().find(f=>!!f.element);let r=(l=s==null?void 0:s.element)==null?void 0:l.parentElement;for(;r&&(u!=null&&u.element);){if(u&&r.contains(u.element))return r;r=r.parentElement}return D(r).body}function U(t){return t==null?void 0:t.__unstablePrivateStore}function j(t={}){var l;A(t,t.store);const s=(l=t.store)==null?void 0:l.getState(),u=h(t.items,s==null?void 0:s.items,t.defaultItems,[]),r=new Map(u.map(e=>[e.id,e])),f={items:u,renderedItems:h(s==null?void 0:s.renderedItems,[])},w=U(t.store),i=_({items:u,renderedItems:f.renderedItems},w),I=_(f,t.store),P=e=>{const n=B(e,c=>c.element);i.setState("renderedItems",n),I.setState("renderedItems",n)};C(I,()=>F(i)),C(i,()=>E(i,["items"],e=>{I.setState("items",e.items)})),C(i,()=>E(i,["renderedItems"],e=>{let n=!0,c=requestAnimationFrame(()=>{const{renderedItems:a}=I.getState();e.renderedItems!==a&&P(e.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(c);const d=()=>{if(n){n=!1;return}cancelAnimationFrame(c),c=requestAnimationFrame(()=>P(e.renderedItems))},b=R(e.renderedItems),o=new IntersectionObserver(d,{root:b});for(const a of e.renderedItems)a.element&&o.observe(a.element);return()=>{cancelAnimationFrame(c),o.disconnect()}}));const g=(e,n,c=!1)=>{let d;return n(o=>{const a=o.findIndex(({id:m})=>m===e.id),v=o.slice();if(a!==-1){d=o[a];const m=x(x({},d),e);v[a]=m,r.set(e.id,m)}else v.push(e),r.set(e.id,e);return v}),()=>{n(o=>{if(!d)return c&&r.delete(e.id),o.filter(({id:m})=>m!==e.id);const a=o.findIndex(({id:m})=>m===e.id);if(a===-1)return o;const v=o.slice();return v[a]=d,r.set(e.id,d),v})}},p=e=>g(e,n=>i.setState("items",n),!0);return y(x({},I),{registerItem:p,renderItem:e=>M(p(e),g(e,n=>i.setState("renderedItems",n))),item:e=>{if(!e)return null;let n=r.get(e);if(!n){const{items:c}=i.getState();n=c.find(d=>d.id===e),n&&r.set(e,n)}return n||null},__unstablePrivateStore:i})}function z(t,l,s){return V(l,[s.store]),q(t,s,"items","setItems"),t}function J(t={}){const[l,s]=O(j,t);return z(l,s,t)}var S=k(),K=S.useContext,L=S.useProviderContext,N=S.ContextProvider,Q=S.ScopedContextProvider;export{Q as C,K as a,L as b,j as c,z as d,N as e,J as u};

import{t as le,c as J,s as N,i as de,e as te,a as R,b as fe,u as me}from"./YV4JVR4I-BKme92S4.js";import{o as F,p as q,Q as Ie,q as M,t as ve,v as Se,s as ge,E as Ee,b as X,f as pe,c as ye,_ as ie,i as we,R as be,S as ne,T as O,U as xe,k as H,j as he,A as _e,e as Fe,u as Pe,d as Ce,y as z,V as Ae,x as ue}from"./LMDWO4NN-CGa36ewg.js";import{e as ke,g as T,s as Re,i as Y,a as Be,h as Ke,j as Le}from"./P2CTZE2T-B6kAQkog.js";import{f as Te,a as Me,u as De}from"./LVA2YJMS-B5IZNvlr.js";import{a as W,n as Oe}from"./chunk-K6AXKMTT-B_QCnNdX.js";function ze(e){var s;const n=e.find(c=>!!c.element),t=[...e].reverse().find(c=>!!c.element);let u=(s=n==null?void 0:n.element)==null?void 0:s.parentElement;for(;u&&(t!=null&&t.element);){if(t&&u.contains(t.element))return u;u=u.parentElement}return ve(u).body}function We(e){return e==null?void 0:e.__unstablePrivateStore}function Ue(e={}){var s;le(e,e.store);const n=(s=e.store)==null?void 0:s.getState(),t=F(e.items,n==null?void 0:n.items,e.defaultItems,[]),u=new Map(t.map(o=>[o.id,o])),c={items:t,renderedItems:F(n==null?void 0:n.renderedItems,[])},l=We(e.store),a=J({items:t,renderedItems:c.renderedItems},l),r=J(c,e.store),h=o=>{const f=Se(o,m=>m.element);a.setState("renderedItems",f),r.setState("renderedItems",f)};N(r,()=>de(a)),N(a,()=>te(a,["items"],o=>{r.setState("items",o.items)})),N(a,()=>te(a,["renderedItems"],o=>{let f=!0,m=requestAnimationFrame(()=>{const{renderedItems:g}=r.getState();o.renderedItems!==g&&h(o.renderedItems)});if(typeof IntersectionObserver!="function")return()=>cancelAnimationFrame(m);const w=()=>{if(f){f=!1;return}cancelAnimationFrame(m),m=requestAnimationFrame(()=>h(o.renderedItems))},K=ze(o.renderedItems),S=new IntersectionObserver(w,{root:K});for(const g of o.renderedItems)g.element&&S.observe(g.element);return()=>{cancelAnimationFrame(m),S.disconnect()}}));const v=(o,f,m=!1)=>{let w;return f(S=>{const g=S.findIndex(({id:b})=>b===o.id),P=S.slice();if(g!==-1){w=S[g];const b=M(M({},w),o);P[g]=b,u.set(o.id,b)}else P.push(o),u.set(o.id,o);return P}),()=>{f(S=>{if(!w)return m&&u.delete(o.id),S.filter(({id:b})=>b!==o.id);const g=S.findIndex(({id:b})=>b===o.id);if(g===-1)return S;const P=S.slice();return P[g]=w,u.set(o.id,w),P})}},L=o=>v(o,f=>a.setState("items",f),!0);return q(M({},r),{registerItem:L,renderItem:o=>Ie(L(o),v(o,f=>a.setState("renderedItems",f))),item:o=>{if(!o)return null;let f=u.get(o);if(!f){const{items:m}=a.getState();f=m.find(w=>w.id===o),f&&u.set(o,f)}return f||null},__unstablePrivateStore:a})}function Ve(e,s,n){return ge(s,[n.store]),R(e,n,"items","setItems"),e}function oe(e){const s=[];for(const n of e)s.push(...n);return s}function Z(e){return e.slice().reverse()}var He={id:null};function B(e,s){return e.find(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function $e(e,s){return e.filter(n=>s?!n.disabled&&n.id!==s:!n.disabled)}function re(e,s){return e.filter(n=>n.rowId===s)}function je(e,s,n=!1){const t=e.findIndex(u=>u.id===s);return[...e.slice(t+1),...n?[He]:[],...e.slice(0,t)]}function ae(e){const s=[];for(const n of e){const t=s.find(u=>{var c;return((c=u[0])==null?void 0:c.rowId)===n.rowId});t?t.push(n):s.push([n])}return s}function ce(e){let s=0;for(const{length:n}of e)n>s&&(s=n);return s}function Ne(e){return{id:"__EMPTY_ITEM__",disabled:!0,rowId:e}}function qe(e,s,n){const t=ce(e);for(const u of e)for(let c=0;c<t;c+=1){const l=u[c];if(!l||n&&l.disabled){const r=c===0&&n?B(u):u[c-1];u[c]=r&&s!==r.id&&n?r:Ne(r==null?void 0:r.rowId)}}return e}function Ge(e){const s=ae(e),n=ce(s),t=[];for(let u=0;u<n;u+=1)for(const c of s){const l=c[u];l&&t.push(q(M({},l),{rowId:l.rowId?`${u}`:void 0}))}return t}function Qe(e={}){var s;const n=(s=e.store)==null?void 0:s.getState(),t=Ue(e),u=F(e.activeId,n==null?void 0:n.activeId,e.defaultActiveId),c=q(M({},t.getState()),{id:F(e.id,n==null?void 0:n.id,`id-${Math.random().toString(36).slice(2,8)}`),activeId:u,baseElement:F(n==null?void 0:n.baseElement,null),includesBaseElement:F(e.includesBaseElement,n==null?void 0:n.includesBaseElement,u===null),moves:F(n==null?void 0:n.moves,0),orientation:F(e.orientation,n==null?void 0:n.orientation,"both"),rtl:F(e.rtl,n==null?void 0:n.rtl,!1),virtualFocus:F(e.virtualFocus,n==null?void 0:n.virtualFocus,!1),focusLoop:F(e.focusLoop,n==null?void 0:n.focusLoop,!1),focusWrap:F(e.focusWrap,n==null?void 0:n.focusWrap,!1),focusShift:F(e.focusShift,n==null?void 0:n.focusShift,!1)}),l=J(c,t,e.store);N(l,()=>fe(l,["renderedItems","activeId"],r=>{l.setState("activeId",h=>{var v;return h!==void 0?h:(v=B(r.renderedItems))==null?void 0:v.id})}));const a=(r="next",h={})=>{var v,L;const o=l.getState(),{skip:f=0,activeId:m=o.activeId,focusShift:w=o.focusShift,focusLoop:K=o.focusLoop,focusWrap:S=o.focusWrap,includesBaseElement:g=o.includesBaseElement,renderedItems:P=o.renderedItems,rtl:b=o.rtl}=h,C=r==="up"||r==="down",U=r==="next"||r==="down",G=U?b&&!C:!b||C,$=w&&!f;let E=C?oe(qe(ae(P),m,$)):P;if(E=G?Z(E):E,E=C?Ge(E):E,m==null)return(v=B(E))==null?void 0:v.id;const D=E.find(I=>I.id===m);if(!D)return(L=B(E))==null?void 0:L.id;const j=E.some(I=>I.rowId),Q=E.indexOf(D),i=E.slice(Q+1),d=re(i,D.rowId);if(f){const I=$e(d,m),x=I.slice(f)[0]||I[I.length-1];return x==null?void 0:x.id}const p=K&&(C?K!=="horizontal":K!=="vertical"),y=j&&S&&(C?S!=="horizontal":S!=="vertical"),_=U?(!j||C)&&p&&g:C?g:!1;if(p){const I=y&&!_?E:re(E,D.rowId),x=je(I,m,_),k=B(x,m);return k==null?void 0:k.id}if(y){const I=B(_?d:i,m);return _?(I==null?void 0:I.id)||null:I==null?void 0:I.id}const A=B(d,m);return!A&&_?null:A==null?void 0:A.id};return q(M(M({},t),l),{setBaseElement:r=>l.setState("baseElement",r),setActiveId:r=>l.setState("activeId",r),move:r=>{r!==void 0&&(l.setState("activeId",r),l.setState("moves",h=>h+1))},first:()=>{var r;return(r=B(l.getState().renderedItems))==null?void 0:r.id},last:()=>{var r;return(r=B(Z(l.getState().renderedItems)))==null?void 0:r.id},next:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("next",r)),previous:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("previous",r)),down:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("down",r)),up:r=>(r!==void 0&&typeof r=="number"&&(r={skip:r}),a("up",r))})}function Ye(e){const s=Ee(e.id);return X({id:s},e)}function Je(e,s,n){return e=Ve(e,s,n),R(e,n,"activeId","setActiveId"),R(e,n,"includesBaseElement"),R(e,n,"virtualFocus"),R(e,n,"orientation"),R(e,n,"rtl"),R(e,n,"focusLoop"),R(e,n,"focusWrap"),R(e,n,"focusShift"),e}function mt(e={}){e=Ye(e);const[s,n]=me(Qe,e);return Je(s,n,e)}var Xe="div";function Ze(e){return e.some(s=>!!s.rowId)}function et(e){const s=e.target;return s&&!ue(s)?!1:e.key.length===1&&!e.ctrlKey&&!e.metaKey}function tt(e){return e.key==="Shift"||e.key==="Control"||e.key==="Alt"||e.key==="Meta"}function se(e,s,n){return H(t=>{var u;if(s==null||s(t),t.defaultPrevented||t.isPropagationStopped()||!z(t)||tt(t)||et(t))return;const c=e.getState(),l=(u=T(e,c.activeId))==null?void 0:u.element;if(!l)return;const a=t,r=ie(a,["view"]),h=n==null?void 0:n.current;l!==h&&l.focus(),Ae(l,t.type,r)||t.preventDefault(),t.currentTarget.contains(l)&&t.stopPropagation()})}function nt(e){return Ke(oe(Z(Le(e))))}function rt(e){const[s,n]=W.useState(!1),t=W.useCallback(()=>n(!0),[]),u=e.useState(c=>T(e,c.activeId));return W.useEffect(()=>{const c=u==null?void 0:u.element;s&&c&&(n(!1),c.focus({preventScroll:!0}))},[u,s]),t}var st=ye(function(s){var n=s,{store:t,composite:u=!0,focusOnMove:c=u,moveOnKeyPress:l=!0}=n,a=ie(n,["store","composite","focusOnMove","moveOnKeyPress"]);const r=ke();t=t||r,we(t,!1);const h=W.useRef(null),v=W.useRef(null),L=rt(t),o=t.useState("moves"),[,f]=be(u?t.setBaseElement:null);W.useEffect(()=>{var i;if(!t||!o||!u||!c)return;const{activeId:d}=t.getState(),p=(i=T(t,d))==null?void 0:i.element;p&&Te(p)},[t,o,u,c]),ne(()=>{if(!t||!o||!u)return;const{baseElement:i,activeId:d}=t.getState();if(!(d===null)||!i)return;const y=v.current;v.current=null,y&&O(y,{relatedTarget:i}),Me(i)||i.focus()},[t,o,u]);const m=t.useState("activeId"),w=t.useState("virtualFocus");ne(()=>{var i;if(!t||!u||!w)return;const d=v.current;if(v.current=null,!d)return;const y=((i=T(t,m))==null?void 0:i.element)||xe(d);y!==d&&O(d,{relatedTarget:y})},[t,m,w,u]);const K=se(t,a.onKeyDownCapture,v),S=se(t,a.onKeyUpCapture,v),g=a.onFocusCapture,P=H(i=>{if(g==null||g(i),i.defaultPrevented||!t)return;const{virtualFocus:d}=t.getState();if(!d)return;const p=i.relatedTarget,y=Re(i.currentTarget);z(i)&&y&&(i.stopPropagation(),v.current=p)}),b=a.onFocus,C=H(i=>{if(b==null||b(i),i.defaultPrevented||!u||!t)return;const{relatedTarget:d}=i,{virtualFocus:p}=t.getState();p?z(i)&&!Y(t,d)&&queueMicrotask(L):z(i)&&t.setActiveId(null)}),U=a.onBlurCapture,G=H(i=>{var d;if(U==null||U(i),i.defaultPrevented||!t)return;const{virtualFocus:p,activeId:y}=t.getState();if(!p)return;const _=(d=T(t,y))==null?void 0:d.element,A=i.relatedTarget,I=Y(t,A),x=v.current;v.current=null,z(i)&&I?(A===_?x&&x!==A&&O(x,i):_?O(_,i):x&&O(x,i),i.stopPropagation()):!Y(t,i.target)&&_&&O(_,i)}),$=a.onKeyDown,E=he(l),D=H(i=>{var d;if($==null||$(i),i.defaultPrevented||!t||!z(i))return;const{orientation:p,renderedItems:y,activeId:_}=t.getState(),A=T(t,_);if((d=A==null?void 0:A.element)!=null&&d.isConnected)return;const I=p!=="horizontal",x=p!=="vertical",k=Ze(y);if((i.key==="ArrowLeft"||i.key==="ArrowRight"||i.key==="Home"||i.key==="End")&&ue(i.currentTarget))return;const ee={ArrowUp:(k||I)&&(()=>{if(k){const V=nt(y);return V==null?void 0:V.id}return t==null?void 0:t.last()}),ArrowRight:(k||x)&&t.first,ArrowDown:(k||I)&&t.first,ArrowLeft:(k||x)&&t.last,Home:t.first,End:t.last,PageUp:t.first,PageDown:t.last}[i.key];if(ee){const V=ee();if(V!==void 0){if(!E(i))return;i.preventDefault(),t.move(V)}}});a=_e(a,i=>Oe.jsx(Be,{value:t,children:i}),[t]);const j=t.useState(i=>{var d;if(t&&u&&i.virtualFocus)return(d=T(t,i.activeId))==null?void 0:d.id});a=Fe(X({"aria-activedescendant":j},a),{ref:Pe(h,f,a.ref),onKeyDownCapture:K,onKeyUpCapture:S,onFocusCapture:P,onFocus:C,onBlurCapture:G,onKeyDown:D});const Q=t.useState(i=>u&&(i.virtualFocus||i.activeId===null));return a=De(X({focusable:Q},a)),a}),It=pe(function(s){const n=st(s);return Ce(Xe,n)});export{It as C,st as a,Ue as b,Qe as c,mt as d,Je as u};
